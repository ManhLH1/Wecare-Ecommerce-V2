# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  SO_báo giá:
    Properties:
      Fill: =RGBA(237, 237, 237, 1)
      OnHidden: =Set(is_Screen_SOBG,false);
      OnVisible: |+
        =Set(is_Screen_SOBG,true);
        UpdateContext({reset_control: true});
        Reset(cb_san_pham_SOBG);
        Reset(dp_Don_vi_SOBG);
        Reset(txt_So_luong_SOBG);
        Reset(txt_Gia_SOBG);
        Reset(dp_VAT_SOBG);
        Reset(dp_ngay_giao_SOBG);
        Reset(dp_ngay_giao_NM_SOBG);
        Reset(cb_khach_hang_SOBG);
        Reset(dp_MaDH_SOBG);
    Children:
      - cb_khach_hang_SOBG:
          Control: Classic/ComboBox@2.4.0
          Group: Group5
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DisplayFields: =["crdfd_name"]
            Font: =Font.Arial
            InputTextPlaceholder: ="Khách hàng"
            Items: |-
              =Sort(
                  Filter(
                      Customers,
                      Status = 'Status (Customers)'.Active,
                      'Loại đối tượng' = 'Loại đối tượng - KH'.'Khách hàng',
                      //'Local ' = "Quy Nhơn",
                      'Trạng thái KH' = 'Trạng thái KH (Customers)'.'Khách hàng chính thức' Or 'Trạng thái KH' = 'Trạng thái KH (Customers)'.'Khách hàng tạo mới'
                  ),
                  'Customer name'
              )
            OnChange: |-
              =
              Reset(dp_VAT_SOBG);
              Reset(cb_san_pham_SOBG);
              Reset(dp_Don_vi_SOBG);
              Reset(txt_So_luong_SOBG);
              Reset(txt_Gia_SOBG);
              //Reset(dp_Giam_gia);
              Reset(dp_ngay_giao_SOBG);
              ClearCollect(
                  colCaSOBG,
                  {Ca: "Ca sáng"},
                  {Ca: "Ca chiều"}
              )
            PressedColor: =RGBA(116, 116, 116, 1)
            SearchFields: =["crdfd_name"]
            SelectMultiple: =false
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Width: =400
            X: =11
            Y: =30
      - lbl_Khachhang_SOBG:
          Control: Label@2.5.1
          Group: Group5
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: ="Khách hàng"
            X: =10
      - lbl_Donhang_SOBG:
          Control: Label@2.5.1
          Group: Group5
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: '="Đơn hàng " & dp_MaDH_SOBG.Selected.VAT &" "& var_selected_Checkbox_duyetgia & var_selected_theochietkhau/100 '
            Width: =340
            X: =dp_MaDH_SOBG.X
      - Rectangle1_2:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =10
            Width: =1366
            Y: =81
      - lbl_Thanh_tien_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Align: =Align.Right
            BorderColor: =RGBA(219, 219, 219, 1)
            Fill: =RGBA(241, 244, 249, 1)
            Height: =35
            Size: =11
            Text: |
              =
              Text(Value(txt_So_luong_SOBG.Text) * (Value(lbl_GiaDaGiam_SOBG.Text)),"#,###")
            Width: =100
            X: =864
            Y: =cb_san_pham_SOBG.Y
      - lbl_GTGT_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Align: =Align.Right
            BorderColor: =RGBA(219, 219, 219, 1)
            Fill: =RGBA(241, 244, 249, 1)
            Height: =35
            Size: =11
            Text: |-
              =If(
                  dp_VAT_SOBG.Selected.Value = 0,
                  "0",
                  Text(
                      Value(lbl_Thanh_tien_SOBG.Text) * (dp_VAT_SOBG.Selected.Value / 100),
                      "#,###"
                  )
              )
            Width: =100
            X: =1071
            Y: =cb_san_pham_SOBG.Y
      - lbl_Tong_tien_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Align: =Align.Right
            BorderColor: =RGBA(219, 219, 219, 1)
            Fill: =RGBA(241, 244, 249, 1)
            Height: =35
            Size: =11
            Text: =Text(lbl_Thanh_tien_SOBG.Text + lbl_GTGT_SOBG.Text, "#,###")
            Width: =100
            X: =1205
            Y: =cb_san_pham_SOBG.Y
      - lbl_vat_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            PaddingLeft: =0
            Size: =11
            Text: ="VAT (%)"
            Width: =80
            X: =972
            Y: =lbl_sanpham_SOBG.Y
      - lbl_gtgt_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            PaddingLeft: =0
            Size: =11
            Text: ="GTGT"
            Width: =96
            X: =1071
            Y: =lbl_sanpham_SOBG.Y
      - lbl_tongtien_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            PaddingLeft: =0
            Size: =11
            Text: ="Tổng tiền"
            Width: =96
            X: =1205
            Y: =lbl_sanpham_SOBG.Y
      - lbl_ngaygiao_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =25
            PaddingLeft: =0
            Size: =11
            Text: ="Ngày giao"
            Visible: =If(var_Nganh_nghe = "Shop",true, false)
            Width: =96
            X: =10
            Y: =225
      - lbl_leadtimeSP_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Height: =35
            Size: =12
            Text: |-
              ="Leadtime sp: " & cb_san_pham_SOBG.Selected.'Lead time' &" ngày"
            Visible: =!IsBlank(cb_san_pham_SOBG.Selected.'Mã sản phẩm')
            Width: =172
            X: =11
            Y: =cb_san_pham_SOBG.Y + cb_san_pham_SOBG.Height
      - lbl_tonkhobomua_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Height: =20
            Size: =9
            Text: "=If(\r\n\r\n    IsBlank(Var_ton_kho_lythuyet_inventory_vitrikho) And loai_don_SOBG.Text =\"Không VAT\" And !IsBlank(cb_san_pham_SOBG.Selected)  ,\r\n\r\n    \"Inventory không có tồn kho\",\r\n\r\n    If(\r\n\r\n        loai_don_SOBG.Text =\"Không VAT\"\r\n            && dp_ViTriKho_SOBG.Selected.'Tên kho' = Var_ton_kho_lythuyet_inventory_vitrikho.'Tên kho',\r\n\r\n            \r\n\r\n        \"Tồn kho (inventory): \" & Coalesce(Var_ton_kho_lythuyet_inventory, 0) \r\n\r\n            & \" \" & cb_san_pham_SOBG.Selected.'Đơn vị chuẩn text' ,\r\n\r\n        \"Tồn kho (bỏ mua): \" & Coalesce(Var_ton_kho_lythuyet_bomua, 0) \r\n\r\n            & \" \" & cb_san_pham_SOBG.Selected.'Đơn vị chuẩn text'\r\n\r\n    )\r\n\r\n)\r\n"
            Visible: =!IsBlank(dp_Don_vi_SOBG.SelectedText)
            Width: =232
            X: =179
            Y: =160
      - lbl_sltheokho_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Height: =20
            Size: =9
            Text: |-
              ="SL theo kho: " & Text(txt_So_luong_SOBG.Text * dp_Don_vi_SOBG.Selected.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)', "#,###.##") &" "& cb_san_pham_SOBG.Selected.'Đơn vị chuẩn text'
            Visible: =!IsBlank(txt_So_luong_SOBG.Text)
            Width: =190
            X: =415
            Y: =161
      - lbl_GiaDaGiam_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Align: =Align.Right
            Height: =35
            PaddingLeft: =0
            Size: =12
            Text: |-
              =With(
                  {
                      Gia: If(
                          dp_nhapthucong_theochietkhau_SOBG.Selected.Value = "Theo chiết khấu",
                          gia_theochietkhau,
                          Value(txt_Gia_SOBG.Text)
                      )
                  },
                  Text(
                      If(
                          dp_MaDH_SOBG.Selected.'Loại hóa đơn' ='Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' And dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT',
                      // Nếu có xuất hóa đơn và không VAT → áp thêm 1.5%
                          If(
                              var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And Gia > 0,
                              (Gia - Value_Promotion - Value_Promtion_Muakem) * 1.015,
                              (Gia * (1 - (Value_Promotion + Value_Promtion_Muakem) / 100)) * 1.015
                          ),
                      // Nếu không khớp điều kiện trên → không cộng VAT
                          If(
                              var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And Gia > 0,
                              Gia - Value_Promotion - Value_Promtion_Muakem,
                              Gia * (1 - (Value_Promotion + Value_Promtion_Muakem) / 100)
                          )
                      ),
                      "#,###"
                  )
              )
            Visible: =!IsBlank(var_selected_Promotion) Or dp_nhapthucong_theochietkhau_SOBG.Selected.Value ="Theo chiết khấu"
            Width: =100
            X: =744
            Y: =cb_san_pham_SOBG.Y
      - lbl_giadagiam_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Align: =Align.Center
            Color: =RGBA(77, 77, 77, 1)
            Height: =30
            Size: =12
            Text: ="Giá đã giảm"
            Visible: =!IsBlank(var_selected_Promotion) Or dp_nhapthucong_theochietkhau_SOBG.Selected.Value ="Theo chiết khấu"
            Width: =97
            X: =744
            Y: =lbl_sanpham_SOBG.Y
      - lbl_thanhtien_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            PaddingLeft: =0
            Size: =11
            Text: ="Thành tiền"
            Width: =90
            X: =868
            Y: =lbl_sanpham_SOBG.Y
      - lbl_sanpham_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: |-
              =If(
                  Value(Substitute(Trim(cb_san_pham_SOBG.Selected.GTGT), "%", "")) > 0,
                  "Sản phẩm Có VAT",
                  "Sản phẩm không VAT"
              )
            Width: =186
            X: =10
            Y: =90
      - lbl_donvi_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: ="Đơn vị"
            Width: =90
            X: =345
            Y: =lbl_sanpham_SOBG.Y
      - lbl_soluong_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: ="Số lượng"
            Width: =96
            X: =dp_Don_vi_SOBG.X + dp_Don_vi_SOBG.Width + 10
            Y: =lbl_sanpham_SOBG.Y
      - lbl_gia_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: ="Giá " & dp_nhom_gia_SOBG.Selected.'Nhóm đối tượng text'
            Width: =162
            X: =614
            Y: =lbl_sanpham_SOBG.Y
      - cb_san_pham_SOBG:
          Control: Classic/ComboBox@2.4.0
          Group: Group2
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DisplayFields: =["crdfd_name"]
            DisplayMode: =If(IsBlank(dp_MaDH_SOBG.SelectedItems), DisplayMode.Disabled, DisplayMode.Edit)
            Font: =Font.Arial
            Height: =35
            InputTextPlaceholder: ="Sản phẩm"
            Items: =List_Product
            OnChange: =Reset(dp_VAT_SOBG);
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =true
            SearchFields: =["crdfd_name"]
            SelectMultiple: =false
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Width: =320
            X: =11
            Y: =lbl_sanpham_SOBG.Y + lbl_sanpham_SOBG.Height
      - dp_Don_vi_SOBG:
          Control: Classic/DropDown@2.3.1
          Group: Group2
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DisplayMode: =If(IsBlank(dp_MaDH_SOBG.SelectedItems), DisplayMode.Disabled, DisplayMode.Edit)
            Font: =Font.Arial
            Height: =35
            Items: |-
              =Filter(
                  'Unit conversions',
                  Status = 'Status (Unit conversions)'.Active,
                  'Mã SP' = cb_san_pham_SOBG.Selected.'Mã sản phẩm'
              )
            Items.Value: =crdfd_onvichuyenoitransfome
            OnChange: =
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =true
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Width: =150
            X: =345
            Y: =cb_san_pham_SOBG.Y
      - dp_VAT_SOBG:
          Control: Classic/DropDown@2.3.1
          Group: Group2
          Properties:
            BorderColor: =RGBA(116, 116, 116, 1)
            BorderThickness: =0
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(128, 128, 128, 1)
            Default: |-
              =If(
                  var_selected_VAT_SO = VAT_choice.'Có VAT' And var_selected_SP.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)',
                  Switch(
                      var_selected_SP.GTGT,
                      'GTGT (products)'.'10%',
                      10,
                      'GTGT (products)'.'8%',
                      8,
                      'GTGT (products)'.'5%',
                      5,
                      'GTGT (products)'.'0%',
                      0
                  ),
                  If(
                      var_selected_VAT_SO = VAT_choice.'Có VAT',
                      dp_nhom_gia_SOBG.Selected.GTGT * 100,
                      0
                  )
              )
            DisplayMode: |-
              =If(
                  dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Có VAT',
                  DisplayMode.Edit,
                  DisplayMode.Disabled
              )
            Font: =Font.Arial
            Height: =35
            Items: |-
              =Sort(
                  If(
                      var_selected_VAT_SO = VAT_choice.'Có VAT' And var_selected_SP.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)',
                      Switch(
                          var_selected_SP.GTGT,
                          'GTGT (products)'.'10%',
                          [10],
                          'GTGT (products)'.'8%',
                          [8],
                          'GTGT (products)'.'5%',
                          [5],
                          'GTGT (products)'.'0%',
                          [0]
                      ),
                      If(
                          var_selected_VAT_SO = VAT_choice.'Có VAT',
                          [
                              10,
                              8,
                              0
                          ],
                          [0]
                      )
                  ),
                  Value,
                  SortOrder.Descending
              )
            Items.Value: =Value
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =true
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Width: =80
            X: =972
            Y: =cb_san_pham_SOBG.Y
      - txt_So_luong_SOBG:
          Control: Classic/TextInput@2.3.2
          Group: Group2
          Properties:
            Align: =Align.Right
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =1
            Color: =RGBA(77, 77, 77, 1)
            Default: =If(CountRows(var_duyetgiasup) > 0 And Checkbox_duyetgiasup_SOBG.Value, First(var_duyetgiasup).'Số lượng đáp ứng', 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            DisplayMode: |-
              =If(
                  IsBlank(dp_Don_vi_SOBG.Selected.ID),
                  DisplayMode.Disabled,
                  CountRows(var_duyetgiasup_SOBG) > 0 And Checkbox_duyetgiasup_SOBG.Value,
                  DisplayMode.Disabled,
                  DisplayMode.Edit
              )
            Format: =TextFormat.Number
            Height: =35
            HoverBorderColor: =RGBA(186, 202, 226, 1)
            HoverColor: =RGBA(77, 77, 77, 1)
            HoverFill: =RGBA(0, 0, 0, 0)
            OnChange: |-
              =//UpdateContext({so_luong: txt_So_luong.Text})
            PressedColor: =
            PressedFill: =
            Size: =11
            Width: =100
            X: =lbl_soluong_SOBG.X
            Y: =cb_san_pham_SOBG.Y
      - txt_Gia_SOBG:
          Control: Classic/TextInput@2.3.2
          Group: Group2
          Properties:
            Align: =Align.Right
            BorderColor: =RGBA(219, 219, 219, 1)
            BorderThickness: =1
            Color: =RGBA(77, 77, 77, 1)
            Default: =Text(gia_duyet_SOBG, "#,###")
            DisabledFill: =RGBA(0, 0, 0, 0)
            DisplayMode: '=If(Checkbox_duyetgia_SOBG.Value,DisplayMode.Edit,DisplayMode.View) '
            Format: =TextFormat.Number
            Height: =35
            HoverBorderColor: =RGBA(186, 202, 226, 1)
            HoverFill: =RGBA(0, 0, 0, 0)
            OnChange: |-
              =UpdateContext({so_luong: txt_Gia_SOBG.Text})
            PressedFill: =
            Size: =11
            Width: =100
            X: =lbl_gia_SOBG.X
            Y: =cb_san_pham_SOBG.Y
      - dp_ngay_giao_SOBG:
          Control: Classic/DatePicker@2.6.0
          Group: Group2
          Properties:
            BorderColor: =RGBA(237, 237, 237, 1)
            BorderThickness: =1
            DefaultDate: |-
              =If(
                  !IsBlank(cb_listPromotion_SOBG.Selected) 
                  && !IsBlank(cb_listPromotion_SOBG.Selected.cr1bb_leadtimepromotion)
                  && (IsBlank(cb_listPromotion_SOBG.Selected.cr1bb_phanloaichuongtrinh) 
                      || cb_listPromotion_SOBG.Selected.cr1bb_phanloaichuongtrinh = 'Phân loại promotion'.Hãng 
                      || cb_listPromotion_SOBG.Selected.cr1bb_phanloaichuongtrinh = 'Phân loại promotion'.Hãng),
                  DateAdd(
                      Now(),
                      Value(cb_listPromotion_SOBG.Selected.cr1bb_leadtimepromotion) * 12,
                      TimeUnit.Hours
                  ),
                  ngay_giao
              )
            Format: ="dd/mm/yyyy"
            Height: =25
            IconFill: =RGBA(255, 255, 255, 1)
            OnChange: |-
              =If(
                  DateValue(dp_ngay_giao_SOBG.SelectedDate) < DateValue(ngay_giao_SOBG),
                  Notify("Ngày giao dự kiến không hợp lệ!!!", NotificationType.Warning, 1000);
                  Reset(dp_ngay_giao_SOBG)
              );
            PaddingBottom: =0
            PaddingLeft: =5
            Size: =11
            Visible: =If(var_Nganh_nghe = "Shop", true, false)
            Width: =118
            X: =92
            Y: =225
      - lbl_thongtinchieckhau_SOBG:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =RGBA(255, 0, 0, 1)
            Height: =38
            OnSelect: =//UpdateContext({closePromotion:false})
            Size: =10.5
            Text: |-
              ="Giảm: " & If(
                  cb_listPromotion_SOBG.Selected.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ,
                  Text(
                      Value_Promotion,
                      "#,###"
                  ) & " + " & Value_Promtion_Muakem,
                  Text(Value_Promotion) & "%" & " + " & Value_Promtion_Muakem & "%"
              )
            Visible: =!IsBlank(cb_san_pham_SOBG.SelectedItems) And !IsBlank(txt_Gia_SOBG.Text) And !IsBlank(Value_Promotion)
            Width: =200
            X: =966
            Y: =157
      - Checkbox_duyetgiasup_SOBG:
          Control: Classic/CheckBox@2.1.0
          Group: Group2
          Properties:
            BorderColor: =RGBA(237, 237, 237, 1)
            CheckboxBorderColor: =RGBA(4, 161, 179, 1)
            CheckboxSize: =25
            Color: =RGBA(77, 77, 77, 1)
            Height: =35
            OnSelect: |-
              =If(
                  CountRows(var_duyetgiasup_SOBG) = 0,
                  Reset(Checkbox_duyetgiasup_SOBG);
                  Notify(
                      "Không tìm ra dòng nào đã duyệt của " & cb_khach_hang_SOBG.Selected.'Customer name' & " và sp " & cb_san_pham_SOBG.Selected.'Tên sản phẩm',
                      NotificationType.Error,
                      8080
                  )
              )
            OnUncheck: |-
              =Reset(txt_Gia_SOBG);
              Reset(drd_duyet_gia_SOBG)
            Size: =11
            Text: ="Duyệt giá SUP"
            Width: =132
            X: =1226
            Y: =155
      - Rectangle1_3:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =5
            Width: =1366
            Y: =195
      - NgaygiaoNM_SOBG:
          Control: Label@2.5.1
          Properties:
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Size: =11
            Text: ="Ngày giao NM"
            Visible: =!IsBlank(cb_khach_hang_SOBG.SelectedItems) And var_Nganh_nghe = "Nhà máy"
            Width: =110
            X: =11
            Y: =217
      - dp_ngay_giao_NM_SOBG:
          Control: Classic/DatePicker@2.6.0
          Properties:
            BorderColor: =RGBA(237, 237, 237, 1)
            BorderThickness: =1
            DefaultDate: =ngay_giao
            Format: ="dd/mm/yyyy"
            Height: =30
            IconFill: =RGBA(255, 255, 255, 1)
            OnChange: |-
              =If(
                  dp_ngay_giao_NM_SOBG.SelectedDate < Max(formData_SOBG, 'Ngày giao NM') ||
                  (
                      dp_ngay_giao_NM_SOBG.SelectedDate = Today() &&
                      Hour(Now()) >= 15
                  ),
                  Notify(
                      "Ngày giao dự kiến không hợp lệ",
                      NotificationType.Warning,
                      1000
                  );
                  Reset(dp_ngay_giao_NM_SOBG)
              )
            PaddingBottom: =0
            PaddingLeft: =5
            Size: =11
            Visible: =!IsBlank(cb_khach_hang_SOBG.SelectedItems) And var_Nganh_nghe = "Nhà máy"
            Width: =120
            X: =120
            Y: =211
      - Icon_Luu_SOBG:
          Control: Classic/Icon@2.5.0
          Group: Group3_1
          Properties:
            Color: =RGBA(8, 122, 135, 1)
            Height: =40
            Icon: =Icon.Save
            OnSelect: "=UpdateContext({lookup_donhang_SOBG: dp_MaDH_SOBG.Selected});\n\n    // ============ KIỂM TRA TỒN KHO CHO ĐƠN HÀNG KHÔNG VAT (KHO BÌNH ĐỊNH) ============\n    // Chỉ kiểm tra các dòng mới chưa có ID đơn hàng (ID đơn hàng)\n\n    Set(\n\n        Var_SP_thieu_ton_SOBG,\n\n        If(\n\n            loai_don_SOBG.Text = \"Không VAT\" \n\n                && dp_ViTriKho_SOBG.Selected.'Tên kho' = Var_ton_kho_lythuyet_inventory_vitrikho.'Tên kho',\n\n            First(\n\n                Filter(\n\n                    formData_SOBG As item,\n\n                    // Chỉ kiểm tra các dòng chưa có ID đơn hàng (dòng mới)\n                    IsBlank(item[@'ID đơn hàng']) &&\n\n                    item.'Mã nhóm SP' <> \"NSP-00027\" &&\n\n                    item.'Mã nhóm SP' <> \"NSP-000872\" &&\n                    item.'Mã nhóm SP' <> \"NSP-000409\" &&\n                    item.'Mã nhóm SP' <> \"NSP-000474\" &&\n\n                    With(\n\n                        {\n\n                            ton_kho_inventory: LookUp(\n\n                                'Inventory Weshops',\n\n                                'Mã sản phẩm' = item.'Mã sản phẩm',\n\n                                'Số lượng tồn lý thuyết'\n\n                            )\n\n                        },\n\n                        Value(item[@'Số lượng']) > Coalesce(ton_kho_inventory, 0)\n\n                    )\n\n                )\n\n            ),\n\n            Blank()\n\n        )\n\n    );\n\n    // ============ XỬ LÝ KẾT QUẢ KIỂM TRA ============\n\n    If(\n\n        !IsBlank(Var_SP_thieu_ton_SOBG),\n\n        Notify(\n\n            \"Không đủ tồn kho! SP: \" & Var_SP_thieu_ton_SOBG.'Tên sản phẩm' &\n\n            \" | Tồn còn: \" &\n\n            Text(\n\n                Coalesce(\n\n                    LookUp(\n\n                        'Inventory Weshops',\n\n                        'Mã sản phẩm' = Var_SP_thieu_ton_SOBG.'Mã sản phẩm' And 'Vị trí kho'.'Tên kho' = dp_ViTriKho_SOBG.Selected.'Tên kho',\n\n                        'Số lượng tồn lý thuyết'\n\n                    ),\n\n                    0\n\n                )\n\n        ) & \" \" &\n\n        Coalesce(\n\n            Var_SP_thieu_ton_SOBG.'Đơn vị',\n\n            Var_SP_thieu_ton_SOBG.'Record Đơn vị'.'Đơn vị chuẩn',\n\n            \"\"\n\n        ),\n\n            NotificationType.Error,\n\n            5000\n\n        );\n\n        UpdateContext({showLoading: false}),\n\n        \n\n        // ============ CODE GỐC - CHỈ CHẠY KHI ĐỦ TỒN KHO ============\n\n        If(\n\n            false,//(IsBlank(var_KenhTiepNhan) And !var_kenhtiepnhan_isSelected) && var_selected_khachhang.'Ngành nghề text' = \"5. Shop bán lẻ\" ,\n\n            UpdateContext({show_popup_nhacchonkenhtiepnhan: true}),\n\n            Set(\n\n                khachhang_selected,\n\n                cb_khach_hang_SOBG.Selected\n\n            );\n\n            Set(\n\n                var_check_promotion_SOD,\n\n                IsEmpty(\n\n                    Filter(\n\n                        formData_SOBG,\n\n                        !IsBlank(PromotionRecord)\n\n                    )\n\n                )\n\n            );\n\n            If(\n\n                dp_ViTriKho_SOBG.DisplayMode = DisplayMode.Edit,\n\n                Patch(\n\n                    'SO báo giá',\n\n                    LookUp(\n\n                        'SO báo giá',\n\n                        'Mã đơn hàng' = dp_MaDH_SOBG.Selected.'Mã đơn hàng'\n\n                    ),\n\n                    {'Vị trí kho': dp_ViTriKho_SOBG.Selected}\n\n                )\n\n            );\n\n            If(\n\n                CountRows(formData_SOBG) > 0,\n\n                ForAll(\n\n                    formData_SOBG,\n\n                    With(\n\n                        {\n\n                            existingRecord: LookUp(\n\n                                'SOD báo giá',\n\n                                ID = formData_SOBG[@'ID đơn hàng']\n\n                            ),\n\n                            expectedDeliveryDate: If(\n\n                                cb_khach_hang_SOBG.Selected.'Ngành nghề text' = \"5. Shop bán lẻ\",\n\n                                formData_SOBG[@'Ngày giao'],\n\n                                formData_SOBG[@'Ngày giao NM']\n\n                            ),\n\n                            approvedPriceSUP: If(\n\n                                !IsBlank(formData_SOBG[@id_duyetgiaSUP]),\n\n                                LookUp(\n\n                                    'Duyệt giá',\n\n                                    Status = 'Status (Duyệt giá)'.Active And ID = formData_SOBG[@id_duyetgiaSUP]\n\n                                )\n\n                            ),\n\n                            mappedVAT: LookUp(\n\n                                Table(\n\n                                    {\n\n                                        VAT: 10,\n\n                                        Value: 'Thuế GTGT'.'10%'\n\n                                    },\n\n                                    {\n\n                                        VAT: 8,\n\n                                        Value: 'Thuế GTGT'.'8%'\n\n                                    },\n\n                                    {\n\n                                        VAT: 0,\n\n                                        Value: 'Thuế GTGT'.'0%'\n\n                                    }\n\n                                ),\n\n                                VAT = formData_SOBG[@VAT],\n\n                                Value\n\n                            ),\n\n                            mappedApproval: LookUp(\n\n                                var_table_duyetgia_SOBG,\n\n                                Name = formData_SOBG[@duyet_gia],\n\n                                Value\n\n                            )\n\n                        },\n\n                        Patch(\n\n                            'SOD báo giá',\n\n                            Coalesce(\n\n                                existingRecord,\n\n                                Defaults('SOD báo giá')\n\n                            ),\n\n                            {\n\n                                'Stt đơn': formData_SOBG[@STT],\n\n                                'Mã đơn hàng': lookup_donhang_SOBG,\n\n                                'Sản phẩm': formData_SOBG[@'Record sản phẩm'],\n\n                                'Đơn vị': formData_SOBG[@'Record Đơn vị'],\n\n                                'Số lượng': Value(formData_SOBG[@'Số lượng']),\n\n                                'Đơn giá': If(\n\n                                    var_Nganh_nghe = \"Shop\",\n\n                                    Value(formData_SOBG[@'Giá đã giảm']),\n\n                                    Value(formData_SOBG[@Giá])\n\n                                ),\n\n                                'Giá gốc': Value(formData_SOBG[@Giá]),\n\n                                'Ngày giao dự kiến': expectedDeliveryDate,\n\n                                'Điều chỉnh GTGT': mappedVAT,\n\n                                'Ghi chú': formData_SOBG[@GhiChu],\n\n                                'Duyệt giá': mappedApproval,\n\n                                'Chiết khấu %': formData_SOBG[@Chietkhauphantram],\n\n                                'Chiết khấu VNĐ': formData_SOBG[@Chietkhautien],\n\n                                'Promotion text': formData_SOBG[@promotiontext],\n\n                                Promotion: formData_SOBG[@PromotionRecord],\n\n                                'Duyệt giá sup': approvedPriceSUP,\n\n                                'Chiết khấu 2 (%)': 0,\n\n                                Ca: If(\n\n                                    formData_SOBG[@Ca] = \"Ca sáng\",\n\n                                    'Ca (SOD báo giá)'.'Ca sáng',\n\n                                    'Ca (SOD báo giá)'.'Ca chiều'\n\n                                ),\n\n                                'Phụ phí hoá đơn (%)': formData_SOBG[@'Phụ phí hoá đơn']\n\n                            }\n\n                        )\n\n                    )\n\n                );\n\n                Patch(\n\n                    'SO báo giá',\n\n                    lookup_donhang_SOBG,\n\n                    {\n\n                        'Số đơn chi tiết có Promotion': CountRows(\n\n                            Filter(\n\n                                formData_SOBG,\n\n                                !IsBlank(PromotionRecord) And \"Thanh toán sau khi nhận hàng\" in DKTT\n\n                            )\n\n                        )\n\n                    }\n\n                );\n\n                If(\n\n                    var_Nganh_nghe = \"Shop\" &&\n\n                    CountRows(\n\n                        Filter(\n\n                            formData_SOBG,\n\n                            'Record sản phẩm'.'Cấp 4' = \"Dây điện\" Or 'Record sản phẩm'.'Cấp 4' = \"Cáp điện\"\n\n                        )\n\n                    ) > 0,\n\n                    Patch(\n\n                        'SO báo giá',\n\n                        lookup_donhang_SOBG,\n\n                        { 'Hình thức giao hàng': HT_giaohang.'Giao 1 lần' }\n\n                    )\n\n                );\n\n                /*Patch(\n\n                    'SO báo giá',\n\n                    lookup_donhang_SOBG,\n\n                    {'Kênh tiếp nhận SOBG': dp_kenhtiepnhan_SOBG.Selected.Value}\n\n                );*/\n\n                Notify(\n\n                    \"Tạo đơn bán chi tiết thành công!\",\n\n                    NotificationType.Success,\n\n                    2000\n\n                );\n\n                Set(\n\n                    Total_Order,\n\n                    Sum(\n\n                        formData_SOBG,\n\n                        'Tổng tiền'\n\n                    )\n\n                );\n\n                Set(\n\n                    var_table_SP,\n\n                    Split(\n\n                        Concat(\n\n                            ShowColumns(\n\n                                formData_SOBG,\n\n                                'Mã sản phẩm'\n\n                            ),\n\n                            'Mã sản phẩm',\n\n                            \",\"\n\n                        ),\n\n                        \",\"\n\n                    )\n\n                );\n\n                Set(\n\n                    var_table_NSP,\n\n                    Split(\n\n                        Concat(\n\n                            ShowColumns(\n\n                                formData_SOBG,\n\n                                'Mã nhóm SP'\n\n                            ),\n\n                            'Mã nhóm SP',\n\n                            \",\"\n\n                        ),\n\n                        \",\"\n\n                    )\n\n                );\n\n                Set(\n\n                    var_count_notIn_Promotions,\n\n                    CountRows(\n\n                        Filter(\n\n                            formData_SOBG As item,\n\n                            CountRows(\n\n                                Filter(\n\n                                    ListPromotion_Order As PromotionM,\n\n                                    PromotionM.'Chiết khấu 2' = 'Chiết khấu 2 (Promotion)'.Yes && (item.'Mã sản phẩm' in PromotionM.Ma_SP || item.'Mã nhóm SP' in PromotionM.Ma_NSP)\n\n                                )\n\n                            ) = 0\n\n                        )\n\n                    )\n\n                );\n\n                Set(\n\n                    var_dieukhoanthanhtoan,\n\n                    dp_MaDH_SOBG.Selected.'Điều khoản thanh toán CAL'\n\n                );\n\n                UpdateContext({showLoading: false});\n\n                UpdateContext({Popup_PromotionOrder: true});\n\n                Reset(cb_san_pham_SOBG);\n\n                Reset(dp_Don_vi_SOBG);\n\n                Reset(txt_So_luong_SOBG);\n\n                Reset(txt_Gia_SOBG);\n\n                Reset(dp_VAT_SOBG);\n\n                Clear(formData_SOBG);\n\n                Reset(cb_khach_hang_SOBG);\n\n                Reset(dp_MaDH_SOBG);\n\n                Reset(dp_ngay_giao_NM_SOBG);\n\n                Reset(txt_Ghichu_SOBG);\n\n                Reset(dp_ngay_giao_SOBG);\n\n                Reset(dp_ViTriKho_SOBG);\n\n                Reset(dp_Ca_SOBG),\n\n                Notify(\n\n                    \"Không có data để tạo đơn báo giá chi tiết !!\",\n\n                    NotificationType.Error,\n\n                    2000\n\n                )\n\n            )\n\n        )\n\n    )\n\n"
            Width: =40
            X: =1226
            Y: =213
      - Icon_Reset_SOBG:
          Control: Classic/Icon@2.5.0
          Group: Group3_1
          Properties:
            Color: =RGBA(8, 122, 135, 1)
            Height: =40
            Icon: =Icon.Reload
            OnSelect: |-
              =//Reset(dp_MaDH_SOBG);
              Reset(cb_san_pham_SOBG);
              Reset(dp_Don_vi_SOBG);
              Reset(txt_So_luong_SOBG);
              Reset(txt_Gia_SOBG);
              Reset(dp_VAT_SOBG);
              Reset(dp_ngay_giao_SOBG);
              Reset(dp_ngay_giao_NM_SOBG);
              Reset(cb_khach_hang_SOBG);
              Reset(dp_ViTriKho_SOBG);
              Reset(dp_Ca_SOBG);
              Clear(formData_SOBG);
              Reset(Checkbox_duyetgia_SOBG);
              Reset(dp_kenhtiepnhan_SOBG);
              Clear(TanSuatKho_sobg);
            Width: =40
            X: =1278
            Y: =213
      - txt_Ghichu_SOBG:
          Control: Classic/TextInput@2.3.2
          Group: Group3_1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            Color: =RGBA(255, 0, 0, 1)
            Default: |-
              =If(
                  CountRows(var_list_gia_KH) = 1 And cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                  LookUp(
                      var_list_gia_KH,
                      'Mã KH' = var_MaKH
                  ).'Ghi chú',
                  If(Checkbox_duyetgia_SOBG.Value Or Checkbox_duyetgiasup_SOBG.Value,"Duyệt giá bởi " & drd_duyet_gia_SOBG.Selected.Value)
              )
            Fill: =RGBA(241, 244, 249, 1)
            Font: =Font.Arial
            Height: =30
            HintText: ="Ghi chú"
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Size: =12
            Width: =300
            X: =871
            Y: =218
      - Icon_Them_SOBG:
          Control: Classic/Icon@2.5.0
          Group: Group3_1
          Properties:
            BorderColor: =RGBA(179, 179, 179, 1)
            Color: =RGBA(8, 122, 135, 1)
            DisplayMode: |+
              =If(

                  cb_san_pham_SOBG.Selected.'Mã nhóm sp' = "NSP-00027" 

                  || cb_san_pham_SOBG.Selected.'Mã nhóm sp' = "NSP-000872"

                  || cb_san_pham_SOBG.Selected.'Mã nhóm sp' = "NSP-000409"

                  || cb_san_pham_SOBG.Selected.'Mã nhóm sp' = "NSP-000474"

                      || cb_khach_hang.Selected.'Customer name' = "Kho Wecare" || cb_khach_hang.Selected.'Customer name' = "Kho Wecare (Hồ Chí Minh)"

                  ,

                  DisplayMode.Edit,

                  If(

                      dp_MaDH_SOBG.Selected.'Loại đơn hàng' = 'Loại đơn hàng (SO báo giá)'.'Đơn hàng khuyến mãi',

                      DisplayMode.Edit,

                      If(

                          var_warning_gia.value 

                          // --- Điều kiện kiểm tra tồn kho cho đơn hàng Không VAT ---

                          || (

                              loai_don_SOBG.Text = "Không VAT"  && dp_ViTriKho_SOBG.Selected.'Tên kho' = Var_ton_kho_lythuyet_inventory_vitrikho.'Tên kho'

                              && (

                                  (Var_ton_kho_lythuyet_inventory <= 0 || IsBlank(Var_ton_kho_lythuyet_inventory))

                                  || Value(txt_So_luong_SOBG.Text) > Var_ton_kho_lythuyet_inventory

                              )

                          )

                          // --- Điều kiện kiểm tra tồn kho sau khi chuyển đổi đơn vị cho đơn Không VAT ---

                          || (

                              loai_don_SOBG.Text = "Không VAT" 

                              && dp_ViTriKho_SOBG.Selected.'Tên kho' = Var_ton_kho_lythuyet_inventory_vitrikho.'Tên kho'

                              && Value(txt_So_luong_SOBG.Text) * dp_Don_vi_SOBG.Selected.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)' > Var_ton_kho_lythuyet_inventory

                          )

                          // --- Điều kiện kiểm tra VAT và GTGT = 0% ---

                          || (

                              loai_don_SOBG.Text = "Có VAT" 

                              && lbl_sanpham.Text = "Sản phẩm không VAT"

                          )

                          // --- Điều kiện kiểm tra Có VAT và sản phẩm có GTGT > 0% (không cho phép sản phẩm không VAT) ---

                          || (

                              loai_don_SOBG.Text = "Có VAT" 

                              && Value(Substitute(Trim(cb_san_pham_SOBG.Selected.GTGT), "%", "")) = 0

                          )

                          // --- Điều kiện kiểm tra Không VAT và GTGT > 0% ---

                          || (

                              loai_don_SOBG.Text = "Đơn hàng Không VAT" 

                              && lbl_sanpham.Text = "Sản phẩm có VAT"

                          )

                          // --- Điều kiện kiểm tra Tên kho trống ---

                          || (IsBlank(Var_ton_kho_lythuyet_inventory_vitrikho.'Tên kho') And  loai_don_SOBG.Text = "Đơn hàng Không VAT"),

                          DisplayMode.Disabled,

                          DisplayMode.Edit

                      )

                  )

              )

            FocusedBorderThickness: =0
            Height: =40
            HoverBorderColor: =RGBA(50, 86, 160, 1)
            HoverColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
            Icon: =Icon.AddLibrary
            OnSelect: |
              =If(
                  !IsBlank(cb_san_pham_SOBG.Selected.'Mã sản phẩm') And !IsBlank(dp_Don_vi_SOBG.Selected.'Đơn vị chuyển đổi-Transfome') And !IsBlank(txt_So_luong_SOBG.Text) And !IsBlank(txt_Gia_SOBG.Text),
                  UpdateIf(
                      formData_SOBG,
                      ThisRecord.PromotionRecord.'Promotion type (text)' = var_selected_Promotion.TypePromotion && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes && (IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng') || var_cong_don + var_input_soluong >= ThisRecord.PromotionRecord.'Số lượng áp dụng'),
                      With(
                          {
                              giamgia: If(
                                  !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') && var_cong_don + var_input_soluong >= ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3' = var_selected_dieukhoanthanhtoan_choice),
                                  ThisRecord.PromotionRecord.'Value 3',
                                  If(
                                      IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2' = var_selected_dieukhoanthanhtoan_choice,
                                      ThisRecord.PromotionRecord.'Value 2',
                                      ThisRecord.PromotionRecord.Value
                                  )
                              ),
                              Value_muakem: If(
                                  !IsBlank(ThisRecord.PromotionRecord.'Value mua kèm') && (IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') || ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' > var_input_soluong),
                                  ThisRecord.PromotionRecord.'Value mua kèm',
                                  0
                              ),
                              PPHD: If(
                                  dp_MaDH_SOBG.Selected.'Loại hóa đơn' = 'Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' And dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT',
                                  1.015,
                                  1
                              ),
                              Record: ThisRecord
                          },
                          With(
                              {
                                  Gia_da_chietkhau: If(
                                      Record.PromotionRecord.'VNĐ/% Text' = "VNĐ",
                                      Record.Giá - (giamgia+Value_muakem),
                                      Record.Giá * (1 - (giamgia + Value_muakem) / 100)
                                  )
                              },
                              {
                                  '% Giảm giá': If(
                                      var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%',
                                      (giamgia + Value_muakem) / 100,
                                      (giamgia + Value_muakem)
                                  ),
                                  'Giá đã giảm': Gia_da_chietkhau * PPHD,
                                  'Tổng tiền': (Record.'Số lượng' * Gia_da_chietkhau * PPHD) + Record.VAT,
                                  Chietkhauphantram: If(
                                      var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%' && var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                      (giamgia + Value_muakem) / 100,
                                      0
                                  ),
                                  Chietkhautien: If(
                                      var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ && var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                      (giamgia + Value_muakem),
                                      0
                                  )
                              }
                          )
                      )
                  );
                  Collect(
                      formData_SOBG,
                      {
                          'Tên sản phẩm': cb_san_pham_SOBG.Selected.'Tên sản phẩm',
                          'Mã sản phẩm': cb_san_pham_SOBG.Selected.'Mã sản phẩm',
                          'Record sản phẩm': cb_san_pham_SOBG.Selected,
                          'Mã nhóm SP': var_selected_manhomSP,
                          'Số lượng': Value(txt_So_luong_SOBG.Text),
                          'Đơn vị': dp_Don_vi_SOBG.Selected.'Đơn vị chuyển đổi-Transfome',
                          'Record Đơn vị': dp_Don_vi_SOBG.Selected,
                          Giá: Value(txt_Gia_SOBG.Text),
                          'Giá đã giảm': If(
                              Value(txt_Gia_SOBG.Text) = 0,
                              0,
                              Value(lbl_GiaDaGiam_SOBG.Text)
                          ),
                          '% Giảm giá': If( var_selected_Checkbox_duyetgia, var_selected_theochietkhau/100,
                              var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                              Value_Promotion + Value_Promtion_Muakem,
                              (Value_Promotion + Value_Promtion_Muakem) / 100
                          ),
                          'Thành Tiền': Value(lbl_Thanh_tien_SOBG.Text),
                          'Tổng tiền': Value(lbl_Tong_tien_SOBG.Text),
                          VAT: Value(dp_VAT_SOBG.Selected.Value),
                          //GTGT: Value(lbl_GTGT_SOBG.Text),
                          'Ngày giao': DateValue(dp_ngay_giao_SOBG.SelectedDate),
                          Ca: dp_Ca_SOBG.SelectedText.Value,
                          'Ngày giao NM': DateValue(dp_ngay_giao_NM_SOBG.SelectedDate),
                          MaDH: dp_MaDH_SOBG.Selected.'Mã đơn hàng',
                          STT: If(
                              Max(
                                  formData_SOBG,
                                  STT
                              ) = 0,
                              1,
                              Max(
                                  formData_SOBG,
                                  STT
                              ) + 1
                          ),
                          GhiChu: txt_Ghichu_SOBG.Text,
                          duyet_gia: drd_duyet_gia_SOBG.Selected.Value,
                          //DonhangGap: Checkbox_DHgap_1.Value,
                          Chietkhauphantram: If( var_selected_Checkbox_duyetgia, var_selected_theochietkhau/100,
                              var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%' And cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                              (Value_Promotion + Value_Promtion_Muakem) / 100,
                              0
                          ),
                          Chietkhautien: If(
                              var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                              Value_Promotion + Value_Promtion_Muakem,
                              0
                          ),
                          promotiontext: If(
                              cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                              var_selected_Promotion.NamePromotion
                          ),
                          PromotionRecord: LookUp(
                              Promotion,
                              ID = var_selected_Promotion.crdfd_promotionid
                          ),
                          id_duyetgiaSUP: First(var_duyetgiasup_SOBG).ID,
                          'Kho đáp ứng': LookUp(
                              TanSuatKho_sobg,
                              TênSảnPhẩm = cb_san_pham_SOBG.Selected.'Tên sản phẩm',
                              Kho
                          ),
                          DKTT: var_selected_Promotion.DKTT,
                          Createdon: Now(),
                          'Phụ phí hoá đơn': If(
                              dp_MaDH_SOBG.Selected.'Loại hóa đơn' = 'Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' And dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop",
                              0.015,
                              0
                          ),
                          HinhThucGiaoHang: HT_giaohang.'Giao 1 lần'
                      }
                  );
                  If(
                      var_Nganh_nghe = "Shop",
                      UpdateIf(
                          Filter(
                              formData_SOBG,
                              'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị nước" || 'Record sản phẩm'.'Cấp 4' = "Ống cứng PVC"
                          ),
                          ((var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000) || var_sum_ong_cung >= 100000000),
                          {
                              'Ngày giao': DateAdd(
                                  DateTimeValue(ngay_giao),
                                  If(
                                      var_sum_thiet_bi_nuoc >= 200000000 || var_sum_ong_cung >= 200000000,
                                      24,
                                      12
                                  ),
                                  TimeUnit.Hours
                              ),
                              Ca: If(
                                  Hour(
                                      DateAdd(
                                          DateTimeValue(ngay_giao),
                                          If(
                                              var_sum_thiet_bi_nuoc >= 200000000 || var_sum_ong_cung >= 200000000,
                                              24,
                                              12
                                          ),
                                          TimeUnit.Hours
                                      )
                                  ) <= 12,
                                  'Ca (SOD báo giá)'.'Ca sáng',
                                  'Ca (SOD báo giá)'.'Ca chiều'
                              )
                          }
                      );
                      UpdateIf(
                          Filter(
                              formData_SOBG,
                              'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị điện"
                          ),
                          var_sum_thiet_bi_dien >= 200000000,
                          {
                              'Ngày giao': DateAdd(
                                  DateTimeValue(ngay_giao),
                                  12,
                                  TimeUnit.Hours
                              ),
                              Ca: If(
                                  Hour(
                                      DateAdd(
                                          DateTimeValue(ngay_giao),
                                          12,
                                          TimeUnit.Hours
                                      )
                                  ) >= 0 && Hour(
                                      DateAdd(
                                          DateTimeValue(ngay_giao),
                                          12,
                                          TimeUnit.Hours
                                      )
                                  ) <= 12,
                                  'Ca (SOD báo giá)'.'Ca sáng',
                                  'Ca (SOD báo giá)'.'Ca chiều'
                              )
                          }
                      );
                      UpdateIf(
                          Filter(
                              formData_SOBG,
                              'Record sản phẩm'.'Cấp 2 NHSP' = "Vật tư kim khí"
                          ),
                          var_count_kim_khi >= 100,
                          {
                              'Ngày giao': DateAdd(
                                  DateTimeValue(ngay_giao),
                                  12,
                                  TimeUnit.Hours
                              ),
                              Ca: If(
                                  Hour(
                                      DateAdd(
                                          DateTimeValue(ngay_giao),
                                          12,
                                          TimeUnit.Hours
                                      )
                                  ) >= 0 && Hour(
                                      DateAdd(
                                          DateTimeValue(ngay_giao),
                                          12,
                                          TimeUnit.Hours
                                      )
                                  ) <= 12,
                                  'Ca (SOD báo giá)'.'Ca sáng',
                                  'Ca (SOD báo giá)'.'Ca chiều'
                              )
                          }
                      );
                  );
                  Reset(cb_san_pham_SOBG);
                  Reset(dp_Don_vi_SOBG);
                  Reset(txt_So_luong_SOBG);
                  Reset(txt_Gia_SOBG);
                  Reset(dp_VAT_SOBG);
                  Reset(drd_duyet_gia_SOBG);
                  Reset(dp_ngay_giao_SOBG);
                  Reset(Checkbox_duyetgiasup_SOBG);
                  Reset(Checkbox_duyetgia_SOBG),
                  Notify(
                      "Vui lòng điền đầy đủ thông tin!!",
                      NotificationType.Warning,
                      1000
                  )
              );
              Clear(TanSuatKho_sobg);
              ForAll(
                  formData_SOBG As ColData,
                  ForAll(
                      var_filterkho_SOBG As Kho,
                      If(
                          CountRows(
                              Filter(
                                  'Kho Bình Định',
                                  'Vị trí kho'.'Tên kho' = Kho.'Tên kho' && 'Tên sản phẩm'.'Tên sản phẩm' = ColData.'Tên sản phẩm' && 'Tồn kho lý thuyết - Bỏ mua' >= ColData.'Số lượng'
                              )
                          ) > 0,
                          Collect(
                              TanSuatKho_sobg,
                              {
                                  TênSảnPhẩm: ColData.'Tên sản phẩm',
                                  SốLượng: ColData.'Số lượng',
                                  Kho: Kho.'Tên kho'
                              }
                          )
                      )
                  )
              );
              With(
                  {tempData: formData_SOBG},
                  ForAll(
                      tempData As ColData,
                      Patch(
                          formData_SOBG,
                          LookUp(
                              formData_SOBG,
                              'Tên sản phẩm' = ColData.'Tên sản phẩm'
                          ),
                          {
                              'Kho đáp ứng': LookUp(
                                  TanSuatKho_sobg,
                                  TênSảnPhẩm = ColData.'Tên sản phẩm',
                                  Kho
                              )
                          }
                      )
                  )
              );
              Reset(dp_Ca_SOBG);
            Width: =40
            X: =1179
            Y: =213
      - icon_Cancel_SOBG:
          Control: Classic/Icon@2.5.0
          Group: Group3_1
          Properties:
            Color: =RGBA(8, 122, 135, 1)
            Height: =40
            Icon: =Icon.Cancel
            OnSelect: "=UpdateContext({formdata_selected: Data_don_chi_tiet_SOBG.Selected});\n//remove STT\nRemoveIf(\n    formData_SOBG,\n    STT = formdata_selected.STT\n);\n//deactive\nUpdateIf(\n    'SOD báo giá',\n    ID = formdata_selected.'ID đơn hàng',\n    {Status: 'Status (SOD báo giá)'.Inactive}\n);\nUpdateContext(\n    {\n        data_muakem: Filter(\n            Promotion,\n            (formdata_selected.'Mã sản phẩm' in 'Mã sản phẩm (mua kèm)' || formdata_selected.'Mã nhóm SP' in 'Mã nhóm sp (Mua kèm)') && Status = 'Status (Promotion)'.Active\n        )\n    }\n);\nForAll(\n    data_muakem As data_muakem,\n    If(\n        (CountIf(\n            List_Ma_SP_formdata,\n            Text(Value) in data_muakem.'Mã sản phẩm (mua kèm)'\n        ) = 0 And !IsBlank(data_muakem.'Mã sản phẩm (mua kèm)')) || (CountIf(\n            List_Ma_NSP_formdata,\n            Text(Value) in data_muakem.'Mã nhóm sp (Mua kèm)'\n        ) = 0 And !IsBlank(data_muakem.'Mã nhóm sp (Mua kèm)')),\n        With(\n            {\n                heSoVAT: If(\n                    dp_MaDH_SOBG.Selected.'Loại hóa đơn' = 'Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' && dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT',\n                    1.015,\n                    1\n                )\n            },\n            ForAll(\n                Filter(\n                    formData_SOBG,\n                    PromotionRecord.ID = data_muakem.ID\n                ),\n                Patch(\n                    formData_SOBG,\n                    ThisRecord,\n                    {\n                        PromotionRecord: Blank(),\n                        'Giá đã giảm': ThisRecord.Giá * heSoVAT,\n                        'Tổng tiền': ThisRecord.Giá * heSoVAT * (1 + ThisRecord.VAT),\n                        '% Giảm giá': 0,\n                        Chietkhauphantram: 0,\n                        Chietkhautien: 0\n                    }\n                )\n            )\n        )\n    )\n);\n// Update record collection với giá trị mới với trường hợp cộng dồn\nWith(\n    {\n        value: Sum(\n            Filter(\n                formData_SOBG,\n                PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes\n            ),\n            'Số lượng'\n        )\n    },\n    UpdateIf(\n        formData_SOBG,\n        ThisRecord.PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes,\n        With(\n            {\n                promoValue: If(\n                    !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3' = var_selected_dieukhoanthanhtoan_choice),\n                    ThisRecord.PromotionRecord.'Value 3',\n                    If(\n                        !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2' = var_selected_dieukhoanthanhtoan_choice),\n                        ThisRecord.PromotionRecord.'Value 2',\n                        ThisRecord.PromotionRecord.Value\n                    )\n                ),\n                PPHD: If(\n                    dp_MaDH_SOBG.Selected.'Loại hóa đơn' = 'Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' And dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT',\n                    1.015,\n                    1\n                ),\n                Record: ThisRecord\n            },\n            With(\n                {\n                    Gia_da_chietkhau: If(\n                        Record.PromotionRecord.'VNĐ/% Text' = \"VNĐ\",\n                        Record.Giá - promoValue,\n                        Record.Giá * (1 - promoValue / 100)\n                    )\n                },\n                {\n                    '% Giảm giá': If(\n                        Record.PromotionRecord.'VNĐ/% Text' = \"%\",\n                        promoValue / 100,\n                        promoValue\n                    ),\n                    'Giá đã giảm': Gia_da_chietkhau * PPHD,\n                    'Tổng tiền': (Record.'Số lượng' * Gia_da_chietkhau * PPHD) + Record.VAT,\n                    Chietkhauphantram: If(\n                        Record.PromotionRecord.'VNĐ/% Text' = \"%\" && var_Nganh_nghe = \"Shop\",\n                        promoValue / 100,\n                        0\n                    ),\n                    Chietkhautien: If(\n                        Record.PromotionRecord.'VNĐ/% Text' = \"VNĐ\" && var_Nganh_nghe = \"Shop\",\n                        promoValue,\n                        0\n                    )\n                }\n            )\n        )\n    );\n    If(\n        var_Nganh_nghe = \"Shop\",\n        UpdateIf(\n            Filter(\n                formData_SOBG,\n                'Record sản phẩm'.'Cấp 2 NHSP' = \"Thiết bị nước\" || 'Record sản phẩm'.'Cấp 4' = \"Ống cứng PVC\"\n            ),\n            var_sum_thiet_bi_nuoc < 200000000 || var_sum_ong_cung < 200000000,\n            {\n                'Ngày giao': If(\n                    var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,\n                    DateTimeValue(ngay_giao_SOBG),\n                    If(\n                        var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,\n                        DateAdd(\n                            DateTimeValue(ngay_giao_SOBG),\n                            12,\n                            TimeUnit.Hours\n                        ),\n                        DateTimeValue(ngay_giao_SOBG)\n                    )\n                ),\n                Ca: If(\n                    Hour(\n                        If(\n                            var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,\n                            DateTimeValue(ngay_giao_SOBG),\n                            If(\n                                var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,\n                                DateAdd(\n                                    DateTimeValue(ngay_giao_SOBG),\n                                    12,\n                                    TimeUnit.Hours\n                                ),\n                                DateTimeValue(ngay_giao_SOBG)\n                            )\n                        )\n                    ) >= 0 && Hour(\n                        If(\n                            var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,\n                            DateTimeValue(ngay_giao_SOBG),\n                            If(\n                                var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,\n                                DateAdd(\n                                    DateTimeValue(ngay_giao_SOBG),\n                                    12,\n                                    TimeUnit.Hours\n                                ),\n                                DateTimeValue(ngay_giao_SOBG)\n                            )\n                        )\n                    ) <= 12,\n                    'Ca (SOD báo giá)'.'Ca sáng',\n                    'Ca (SOD báo giá)'.'Ca chiều'\n                )\n            }\n        );\n        UpdateIf(\n            Filter(\n                formData_SOBG,\n                'Record sản phẩm'.'Cấp 2 NHSP' = \"Thiết bị điện\"\n            ),\n            var_sum_thiet_bi_dien < 200000000,\n            {\n                'Ngày giao': DateTimeValue(ngay_giao_SOBG),\n                Ca: If(\n                    var_Ca,\n                    'Ca (SOD báo giá)'.'Ca sáng',\n                    'Ca (SOD báo giá)'.'Ca chiều'\n                )\n            }\n        );\n        UpdateIf(\n            Filter(\n                formData_SOBG,\n                'Record sản phẩm'.'Cấp 2 NHSP' = \"Vật tư kim khí\"\n            ),\n            var_count_kim_khi < 100,\n            {\n                'Ngày giao': DateAdd(\n                    DateTimeValue(ngay_giao_SOBG),\n                    0,\n                    TimeUnit.Hours\n                ),\n                Ca: If(\n                    var_Ca,\n                    'Ca (SOD báo giá)'.'Ca sáng',\n                    'Ca (SOD báo giá)'.'Ca chiều'\n                )\n            }\n        );\n    );\n    \n);\nClearCollect(\n    formData_SOBG,\n    ForAll(\n        Sequence(\n            CountRows(\n                Sort(\n                    formData_SOBG,\n                    Createdon,\n                    SortOrder.Ascending\n                )\n            )\n        ),\n        Patch(\n            Last(\n                FirstN(\n                    Sort(\n                        formData_SOBG,\n                        Createdon,\n                        SortOrder.Ascending\n                    ),\n                    Value\n                )\n            ),\n            {STT: Value}\n        )\n    )\n);\nIf(\n    !IsBlank(formdata_selected.'ID đơn hàng'),\n    ForAll(\n        formData_SOBG,\n        Patch(\n            'SOD báo giá',\n            LookUp(\n                'SOD báo giá',\n                ID = formData_SOBG[@'ID đơn hàng']\n            ),\n            {\n                'Đơn giá': If(\n                    var_Nganh_nghe = \"Shop\",\n                    formData_SOBG[@'Giá đã giảm'],\n                    formData_SOBG[@Giá]\n                ),\n                //'Giá gốc': Value(formData_SOBG[@Giá]),\n                'Stt đơn': formData_SOBG[@STT],\n                'Chiết khấu %': formData_SOBG[@Chietkhauphantram],\n                'Chiết khấu VNĐ': formData_SOBG[@Chietkhautien]\n            }\n        )\n    );\n    ,\n    false\n);\nNotify(\n    \"Cập nhật thành công\",\n    NotificationType.Success,\n    2000\n);\nClear(TanSuatKho);\nForAll(\n    formData As ColData,\n    ForAll(\n        var_filterkho As Kho,\n        If(\n            CountRows(\n                Filter(\n                    'Kho Bình Định',\n                    'Vị trí kho'.'Tên kho' = Kho.'Tên kho' && 'Tên sản phẩm'.'Tên sản phẩm' = ColData.'Tên sản phẩm' && 'Tồn kho lý thuyết - Bỏ mua' >= ColData.'Số lượng'\n                )\n            ) > 0,\n            Collect(\n                TanSuatKho,\n                {\n                    TênSảnPhẩm: ColData.'Tên sản phẩm',\n                    SốLượng: ColData.'Số lượng',\n                    Kho: Kho.'Tên kho'\n                }\n            )\n        )\n    )\n);\nWith(\n    {tempData: formData},\n    ForAll(\n        tempData As ColData,\n        Patch(\n            formData,\n            LookUp(\n                formData,\n                'Tên sản phẩm' = ColData.'Tên sản phẩm'\n            ),\n            {\n                'Kho đáp ứng': LookUp(\n                    TanSuatKho,\n                    TênSảnPhẩm = ColData.'Tên sản phẩm',\n                    Kho\n                )\n            }\n        )\n    )\n);\n"
            Visible: =CountRows(formData_SOBG) > 0
            Width: =40
            X: =1326
            Y: =213
      - lbl_thongbao_SOBG:
          Control: Label@2.5.1
          Group: Group3_1
          Properties:
            Align: =Align.Center
            Color: =RGBA(255, 0, 0, 1)
            Size: =11
            Text: |-
              =If(false, "Khách chưa được thêm vào nhóm BGCT",
              "Sản phẩm chưa báo giá cho đơn vị " & dp_Don_vi_SOBG.Selected.'Đơn vị chuyển đổi-Transfome' & " !!")
            Visible: =IsBlank(txt_Gia_SOBG.Text) And !IsBlank(var_selected_maSP)
            Width: =308
            X: =334
            Y: =211
      - drd_duyet_gia_SOBG:
          Control: DropDown@0.0.45
          Group: Group3_1
          Properties:
            BorderColor: =RGBA(106, 122, 127, 0.38)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =2
            DefaultSelectedItems: |-
              =If(
                  Checkbox_duyetgia_SOBG.Value Or Checkbox_duyetgiasup_SOBG.Value,
                  If(
                      cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                      If(
                          !IsBlank(First(var_duyetgiasup_SOBG).'Người duyệt'.Name) And Checkbox_duyetgiasup_SOBG.Value,
                          [First(var_duyetgiasup_SOBG).'Người duyệt'.Name],
                          ["Lê Thị Ngọc Anh"]
                      ),
                      ["Phạm Thị Mỹ Hương"]
                  ),
                  []
              )
            Items: =var_table_supduyet
            Width: =200
            X: =656
            Y: =219
      - Data_don_chi_tiet_SOBG:
          Control: DataTable@1.0.3
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            Color: =RGBA(77, 77, 77, 1)
            Fill: =RGBA(255, 255, 255, 1)
            Font: =Font.Arial
            HeadingColor: =RGBA(255, 255, 255, 1)
            HeadingFill: =RGBA(4, 161, 179, 1)
            HeadingFont: =Font.Arial
            HeadingFontWeight: =FontWeight.Bold
            HeadingSize: =12
            Height: =515
            HoverFill: =RGBA(204, 231, 246, 1)
            Items: =Sort(formData_SOBG, STT, SortOrder.Descending)
            NoDataText: ="Chưa có đơn hàng"
            Size: =11
            Width: =1366
            Y: =253
          Children:
            - STT_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="STT"
                  FieldName: ="STT"
                  Order: =10
                  Text: =ThisItem.STT
                  Width: =50
            - Tên sản phẩm_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Tên sản phẩm"
                  FieldName: ="Tên sản phẩm"
                  Order: =14
                  Text: =ThisItem.'Tên sản phẩm'
                  Width: =207
            - Đơn vị_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Đơn vị"
                  FieldName: ="Đơn vị"
                  Order: =19
                  Text: =ThisItem.'Đơn vị'
                  Width: =104
            - Số lượng_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Số lượng"
                  FieldName: ="Số lượng"
                  Order: =22
                  Text: |+
                    =Text(ThisItem.'Số lượng', "#,###.##")
                  Width: =118
            - Giá_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Giá"
                  FieldName: ="Giá"
                  Order: =28
                  Text: =Text(ThisItem.Giá, "#,###")
                  Width: =92
            - Giá đã giảm_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Giá đã CK"
                  FieldName: ="Giá đã giảm"
                  Order: =42
                  Text: =Text(ThisItem.'Giá đã giảm', "#,###.##")
                  Visible: =If(cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,true,false)
                  Width: =125
            - VAT_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="VAT"
                  FieldName: ="VAT"
                  Order: =43
                  Text: =ThisItem.VAT
                  Width: =55
            - Tổng tiền_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Tổng tiền"
                  FieldName: ="Tổng tiền"
                  Order: =44
                  Text: =Text(ThisItem.'Tổng tiền', "#,###")
                  Width: =110
            - Ngày giao_Column1_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Ngày giao"
                  FieldName: ="Ngày giao"
                  Order: =46
                  Text: =If(var_Nganh_nghe = "Shop", Text(ThisItem.'Ngày giao',"dd/mm/yyyy"),Text(ThisItem.'Ngày giao NM',"dd/mm/yyyy"))
                  Width: =139
            - '% Giảm giá_Column1_1':
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Chiết khấu"
                  FieldName: ="% Giảm giá"
                  Order: =40
                  Text: =ThisItem.'% Giảm giá'
                  Visible: =If(cb_khach_hang_SOBG.Selected.'Ngành nghề' = 'Ngành nghề mới'.Shop,true,false)
                  Width: =110
            - ID đơn hàng_Column3:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldName: ="ID đơn hàng"
                  Order: =49
                  Text: =If(IsBlank(ThisItem.'ID đơn hàng'),"","✅")
                  Width: =56
            - duyet_gia_Column2:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Người duyệt"
                  FieldName: ="duyet_gia"
                  Order: =45
                  Text: =ThisItem.duyet_gia
                  Width: =136
            - Ca_Column2:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                IsLocked: true
                Properties:
                  FieldDisplayName: ="Ca"
                  FieldName: ="Ca"
                  Order: =47
                  Text: =ThisItem.Ca
            - phuphihoadon:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  AutoWidth: =false
                  FieldDisplayName: ="Phụ phí hóa đơn"
                  FieldName: ="Chietkhauphantram"
                  Order: =32
                  Text: =ThisItem.'Phụ phí hoá đơn'
                  Visible: |-
                    =If(
                        dp_MaDH_SOBG.Selected.'Loại hóa đơn' = 'Loại hóa đơn (SO báo giá)'.'Hộ kinh doanh' And dp_MaDH_SOBG.Selected.VAT = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop",
                        true,
                        false
                    )
                  Width: =94
      - Label8_1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Right
            Height: =30
            Text: ="V2.82"
            Width: =88
            X: =1278
      - cb_listPromotion_SOBG:
          Control: Classic/ComboBox@2.4.0
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DefaultSelectedItems: =If( !IsBlank(cb_san_pham_SOBG.SelectedItems) And !IsBlank(txt_Gia_SOBG.Text) And !Checkbox_duyetgia_SOBG.Value And !Checkbox_duyetgiasup_SOBG.Value And ( dp_nhom_gia_SOBG.Selected.'Loại bỏ Promotion' = "No" Or dp_nhom_gia_SOBG.Selected.'Nhóm đối tượng text' = "Miền Nam"), First(ListPromotion), Blank() )
            DisplayFields: =["NamePromotion"]
            Font: =Font.Arial
            Height: =35
            InputTextPlaceholder: ="Khuyễn mãi"
            Items: =ListPromotion
            OnChange: =
            PressedColor: =RGBA(116, 116, 116, 1)
            SearchFields: =["NamePromotion"]
            SelectMultiple: =false
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Visible: =!IsBlank(cb_san_pham_SOBG.SelectedItems) And !IsBlank(txt_Gia_SOBG.Text) And !Checkbox_duyetgia_SOBG.Value And !Checkbox_duyetgiasup_SOBG.Value And (dp_nhom_gia_SOBG.Selected.'Loại bỏ Promotion' = "No" Or dp_nhom_gia_SOBG.Selected.'Nhóm đối tượng text' = "Miền Nam")
            Width: =350
            X: =614
            Y: =158
      - dp_MaDH_SOBG:
          Control: Classic/ComboBox@2.4.0
          Group: Group5
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DefaultSelectedItems: =First(var_DHBG)
            DisplayFields: =["crdfd_name"]
            Font: =Font.Arial
            InputTextPlaceholder: ="SO báo giá"
            IsSearchable: =false
            Items: =var_DHBG
            OnChange: |
              =Clear(formData_SOBG);
              ForAll(
                  var_SODBG As itemSODBG,
                  With(
                      {
                          mappedApproval: LookUp(
                              var_table_duyetgia_SOBG,
                              Value = itemSODBG[@'Duyệt giá'],
                              Name
                          ),
                          Promoption_Record: LookUp(
                              Promotion,
                              ID = itemSODBG[@Promotion].ID
                          )
                      },
                      Collect(
                          formData_SOBG,
                          {
                              STT: itemSODBG[@'Stt đơn'],
                              'ID đơn hàng': itemSODBG[@ID],
                              'Tên sản phẩm': itemSODBG[@'sản phẩm text'],
                              'Mã sản phẩm': itemSODBG[@'Mã sản phẩm'],
                              'Mã nhóm SP': itemSODBG[@'Mã nhóm sản phẩm'],
                              'Record Đơn vị': itemSODBG[@'Đơn vị'],
                              'Record sản phẩm': itemSODBG[@'Sản phẩm'],
                              'Số lượng': itemSODBG[@'Số lượng'],
                              'Đơn vị': itemSODBG[@'Đơn vị text'],
                              Giá: itemSODBG[@'Giá gốc'],
                              'Phụ phí hoá đơn': itemSODBG[@'Phụ phí hoá đơn (%)'],
                              'Giá đã giảm': itemSODBG[@'Đơn giá'],
                              '% Giảm giá': If(
                                  itemSODBG[@'Chiết khấu %'] > 0,
                                  itemSODBG[@'Chiết khấu %'],
                                  itemSODBG[@'Chiết khấu VNĐ']
                              ),
                              'Tổng tiền': With(
                                  {
                                      TotalExVAT: itemSODBG[@'Tổng tiền chưa VAT'],
                                      AdjustGTGT: Value(itemSODBG[@'Điều chỉnh GTGT Text'])
                                  },
                                  TotalExVAT * (1 + If(
                                      AdjustGTGT <> 0,
                                      AdjustGTGT / 100,
                                      0
                                  ))
                              ),
                              VAT: Value(itemSODBG[@'Điều chỉnh GTGT Text']),
                              'Ngày giao': itemSODBG[@'Ngày giao dự kiến'],
                              Ca: If(
                                  itemSODBG[@Ca] = 283640000,
                                  "Ca sáng",
                                  "Ca chiều"
                              ),
                              'Ngày giao NM': itemSODBG[@'Ngày giao dự kiến'],
                              GhiChu: itemSODBG[@'Ghi chú'],
                              GTGT: itemSODBG[@GTGT],
                              Chietkhauphantram: itemSODBG[@'Chiết khấu %'],
                              Chietkhautien: itemSODBG[@'Chiết khấu VNĐ'],
                              promotiontext: itemSODBG[@'Promotion text'],
                              PromotionRecord: Promoption_Record,
                              duyet_gia: mappedApproval,
                              Createdon: itemSODBG[@'Created On']
                          }
                      )
                  )
              );
              //UpdateContext({var_kenhtiepnhan_isSelected: false});
            PressedColor: =RGBA(116, 116, 116, 1)
            SearchFields: =["crdfd_dieukhoanthanhtoancal"]
            SelectMultiple: =false
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Width: =650
            X: =460
            Y: =30
      - Checkbox_duyetgia_SOBG:
          Control: Classic/CheckBox@2.1.0
          Group: Group2
          Properties:
            BorderColor: =RGBA(237, 237, 237, 1)
            CheckboxBorderColor: =RGBA(4, 161, 179, 1)
            CheckboxSize: =25
            Color: =RGBA(77, 77, 77, 1)
            Height: =35
            OnCheck: =
            OnSelect: =Reset(dp_nhapthucong_theochietkhau_SOBG)
            OnUncheck: |-
              =Reset(txt_Gia_SOBG);
              Reset(drd_duyet_gia_SOBG)
            Size: =11
            Text: ="Duyệt giá"
            Width: =111
            X: =1112
            Y: =155
      - dp_ViTriKho_SOBG:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            Default: =var_MultiChoiceKho_SOBG.'Vị trí kho'.'Tên kho'
            DisplayMode: =If(IsBlank(dp_MaDH_SOBG.Selected), DisplayMode.Disabled, DisplayMode.Edit)
            Font: =Font.Arial
            Height: =28
            Items: =var_filterkho_SOBG
            Items.Value: =crdfd_name
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Visible: =cb_khach_hang_SOBG.Selected.'Ngành nghề text' = "5. Shop bán lẻ"
            Width: =164
            X: =10
            Y: =161
      - lbl_khodexuat_SOBG:
          Control: Label@2.5.1
          Properties:
            Color: =RGBA(255, 0, 0, 1)
            Height: =25
            Size: =11
            Text: |-
              ="Kho đề xuất: "
            Visible: =cb_khach_hang_SOBG.Selected.'Ngành nghề text' = "5. Shop bán lẻ"
            Width: =96
            X: =6
            Y: =200
      - lb_suggest_kho_SOBG:
          Control: Label@2.5.1
          Properties:
            Color: =RGBA(255, 0, 0, 1)
            Height: =24
            Role: =
            Size: =11
            Text: |-
              =If(IsEmpty(TanSuatKho_sobg),
              var_MultiChoiceKho_SOBG.'Vị trí kho'.'Tên kho',
              First(
                  Filter(
                      AddColumns(
                          GroupBy(
                              TanSuatKho_sobg,
                              Kho,
                              Group_theo_kho
                          ),
                          SốLượng,
                          CountRows(Group_theo_kho)
                      ),
                      SốLượng = Max(
                          AddColumns(
                              GroupBy(
                                  TanSuatKho_sobg,
                                  Kho,
                                  Group
                              ),
                              SốLượng,
                              CountRows(Group)
                          ),
                          SốLượng
                      ) && 
                      If(
                          CountRows(
                              Filter(
                                  AddColumns(
                                      GroupBy(
                                          TanSuatKho_sobg,
                                          Kho,
                                          Group
                                      ),
                                      SốLượng,
                                      CountRows(Group)
                                  ),
                                  SốLượng = Max(
                                      AddColumns(
                                          GroupBy(
                                              TanSuatKho_sobg,
                                              Kho,
                                              Group
                                          ),
                                          SốLượng,
                                          CountRows(Group)
                                      ),
                                      SốLượng
                                  )
                              )
                          ) > 1,
                          Kho = var_MultiChoiceKho_SOBG.'Vị trí kho'.'Tên kho',
                          true
                      ),
                      Kho
                  )
              ).Kho
              )
            Visible: =cb_khach_hang_SOBG.Selected.'Ngành nghề text' = "5. Shop bán lẻ"
            Width: =172
            X: =94
            Y: =201
      - dp_Ca_SOBG:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            Default: =If(var_Ca_SOBG, "Ca sáng", "Ca chiều")
            DisplayMode: =If(IsBlank(dp_MaDH_SOBG.Selected.'Mã đơn hàng'), DisplayMode.Disabled, DisplayMode.Edit)
            Font: =Font.Arial
            Height: =23
            Items: =colCaSOBG
            Items.Value: =Ca
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =reset_control
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Visible: =If(var_Nganh_nghe = "Shop", true, false)
            Width: =110
            X: =225
            Y: =227
      - dp_nhom_gia_SOBG:
          Control: Classic/DropDown@2.3.1
          Group: Group2
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            DisplayMode: =If(IsBlank(dp_MaDH_SOBG.Selected), DisplayMode.Disabled, DisplayMode.Edit)
            Font: =Font.Arial
            Height: =35
            Items: =var_list_gia_nhom
            Items.Value: =Gia_format
            OnChange: =
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =reset_control
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =12
            Tooltip: |-
              ="Giá nhóm: " & dp_nhom_gia_SOBG.Selected.'Nhóm đối tượng text'
            Visible: |-
              =If(
                  (Checkbox_duyetgiasup_SOBG.Value And CountRows(var_duyetgiasup_SOBG) > 0),
                  false,
                  !Checkbox_duyetgia_SOBG.Value,
                  true,
                  false
              )
            Width: =124
            X: =615
            Y: =120
      - C_showPopupPromotionOrder_1:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(189, 189, 189, 0.67)
            Height: =768
            Visible: '=Popup_PromotionOrder '
            Width: =1366
          Children:
            - Button1_2:
                Control: Classic/Button@2.2.0
                Group: Group8
                Properties:
                  DisplayMode: =DisplayMode.View
                  Fill: =RGBA(255, 255, 255, 0.95)
                  Height: =234
                  RadiusBottomLeft: =30
                  RadiusBottomRight: =30
                  RadiusTopLeft: =30
                  RadiusTopRight: =30
                  Text: =
                  Width: =556
                  X: =387
                  Y: =267
            - bt_huy_2:
                Control: Button@0.0.45
                Group: Group8
                Properties:
                  Appearance: =
                  BasePaletteColor: =RGBA(189, 178, 176, 1)
                  BorderRadius: =10
                  Font: =Font.Arial
                  FontSize: =16
                  FontWeight: =FontWeight.Semibold
                  Height: =40
                  OnSelect: |-
                    =UpdateContext({Popup_PromotionOrder:false});
                    Reset(Combobox_PromotionOrder_1);
                  Text: ="Huỷ"
                  Width: =160
                  X: =713
                  Y: =428
            - Label_lydohuy_3:
                Control: Label@2.5.1
                Group: Group8
                Properties:
                  FontWeight: =FontWeight.Semibold
                  Height: =35
                  Size: =18
                  Text: ="Promotion Order "
                  Width: =500
                  X: =419
                  Y: =274
            - Combobox_PromotionOrder_1:
                Control: ComboBox@0.0.51
                Group: Group8
                Properties:
                  Font: =Font.Arial
                  FontSize: =18
                  FontWeight: =FontWeight.Normal
                  Height: =49
                  InputTextPlaceholder: ="Promotion Order"
                  IsSearchable: =false
                  Items: =Promotion_Order_Max
                  OnChange: =
                  SelectMultiple: =true
                  Width: =468
                  X: =431
                  Y: =339
                Children:
                  - NamePromotion1_1:
                      Control: ComboBoxDataField@1.5.0
                      Variant: textualColumn
                      IsLocked: true
                      Properties:
                        FieldDisplayName: ="NamePromotion"
                        FieldName: ="NamePromotion"
                        FieldType: ="s"
                        Order: =1
            - Timer_Promotion_1:
                Control: Timer@2.1.0
                Group: Group8
                Properties:
                  AutoPause: =false
                  DisplayMode: =If(!IsBlank(Combobox_PromotionOrder_1.Selected), DisplayMode.Edit,DisplayMode.Disabled)
                  FontWeight: =FontWeight.Semibold
                  OnTimerEnd: |
                    =UpdateContext({showLoading: false});
                    ForAll(
                        Combobox_PromotionOrder_1.SelectedItems As This, 
                        Patch(
                            'SO báo giá x Promotion',
                            Defaults('SO báo giá x Promotion'),
                            {
                                'SO báo giá': lookup_donhang_SOBG,
                                Promotion: LookUp(Promotion,ID =This.crdfd_promotionid),
                                Type: "Order",
                                Loại: If(
                                    This.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ,
                                    "Tiền",
                                    "Phần trăm"
                                ),
                                'Chiết khấu': If(
                                    This.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ,
                                    This.ValuePromotion,
                                    This.ValuePromotion / 100
                                )
                            }
                        )
                    );
                    Patch(
                        'SO báo giá',
                        lookup_donhang_SOBG,
                        {
                            'Chiết khấu VNĐ':lookup_donhang_SOBG.'Chiết khấu VNĐ'+ Sum(
                                Filter(
                                    Combobox_PromotionOrder_1.SelectedItems,
                                    VND_Percent = 'VNĐ/% (Promotion)'.VNĐ
                                ),
                                ValuePromotion
                            )
                        }
                    );
                    Reset(Combobox_PromotionOrder_1);
                    Notify(
                        "Áp dụng thành công",
                        NotificationType.Success,
                        5000
                    );
                    UpdateContext({Popup_PromotionOrder: false});
                  OnTimerStart: |-
                    =UpdateContext({showLoading: true});
                  RadiusBottomLeft: =15
                  RadiusBottomRight: =15
                  RadiusTopLeft: =15
                  RadiusTopRight: =15
                  Reset: =true
                  Size: =14
                  Start: =true
                  Text: =If(!IsBlank(Combobox_PromotionOrder_1.Selected) And showLoading ,Text(Time(0, 0, Round((Self.Duration - Self.Value) / 1000, 0)), "mm:ss"), "Xác nhận")
                  X: =448
                  Y: =428
      - dp_kenhtiepnhan_SOBG:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            Color: =RGBA(77, 77, 77, 1)
            Default: =//var_KenhTiepNhan
            Height: =24
            Items: =Choices('SO báo giá'.'Kênh tiếp nhận SOBG')
            Items.Value: =Value
            OnSelect: |-
              =//UpdateContext({var_kenhtiepnhan_isSelected: true});
            Size: =12
            Visible: =false//If(var_Nganh_nghe = "Shop", true, false)
            Width: =110
            X: =225
            Y: =201
      - C_showPopupNhacNhoKenhTiepNhan_1:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(189, 189, 189, 0.67)
            Height: =768
            Visible: =show_popup_nhacchonkenhtiepnhan
            Width: =1366
          Children:
            - Nền_2:
                Control: Classic/Button@2.2.0
                Group: NhacChonKenhTiepNhan_1
                Properties:
                  DisplayMode: =DisplayMode.View
                  Fill: =RGBA(255, 255, 255, 0.95)
                  Height: =201
                  RadiusBottomLeft: =30
                  RadiusBottomRight: =30
                  RadiusTopLeft: =30
                  RadiusTopRight: =30
                  Text: =
                  Width: =514
                  X: =401
                  Y: =268
            - bt_xacnhannhacnho_1:
                Control: Button@0.0.45
                Group: NhacChonKenhTiepNhan_1
                Properties:
                  Appearance: =
                  BasePaletteColor: =RGBA(8, 222, 8, 1)
                  BorderRadius: =10
                  Font: =Font.Arial
                  FontSize: =16
                  FontWeight: =FontWeight.Semibold
                  Height: =40
                  OnSelect: |-
                    =//UpdateContext({var_kenhtiepnhan_isSelected: false});
                    //UpdateContext({show_popup_nhacchonkenhtiepnhan:false});
                  Text: ="Đóng"
                  Visible: =show_popup_nhacchonkenhtiepnhan
                  Width: =160
                  X: =702
                  Y: =387
            - Label_lydohuy_5:
                Control: Label@2.5.1
                Group: NhacChonKenhTiepNhan_1
                Properties:
                  FontWeight: =FontWeight.Semibold
                  Height: =51
                  Size: =18
                  Text: ="Kiểm tra chọn kênh tiếp nhận"
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  Width: =500
                  X: =415
                  Y: =292
            - Button_Nền_2:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderThickness: =0
                  DisplayMode: =DisplayMode.View
                  Fill: =RGBA(255, 255, 255, 1)
                  Height: =324
                  RadiusBottomLeft: =30
                  RadiusBottomRight: =30
                  RadiusTopLeft: =30
                  RadiusTopRight: =30
                  Visible: =
                  Width: =720
                  X: =327
                  Y: =231
      - Dropdown1_2:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderStyle: =BorderStyle.None
            BorderThickness: =0
            ChevronBackground: =RGBA(237, 237, 237, 1)
            ChevronDisabledBackground: =RGBA(237, 237, 237, 1)
            ChevronDisabledFill: =RGBA(237, 237, 237, 1)
            ChevronHoverBackground: =RGBA(237, 237, 237, 1)
            ChevronHoverFill: =RGBA(237, 237, 237, 1)
            Default: ="SO báo giá"
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Bold
            HoverBorderColor: =RGBA(237, 237, 237, 1)
            HoverFill: =
            Items: =Screen_Admin
            Items.Value: =Screen
            OnChange: |-
              =Navigate(Dropdown1_2.Selected.Value,ScreenTransition.CoverRight);
              Reset(Dropdown1_2)
            PressedFill: =
            SelectionFill: =RGBA(180, 214, 250, 1)
            Size: =16
            Width: =250
            X: =1108
            Y: =30
      - dp_nhapthucong_theochietkhau_SOBG:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Items: =var_choice_nhapthucong_theochietkhau
            Items.Value: =Value
            OnChange: =Reset(txt_Gia);
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =reset_control
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =10
            Visible: =If(Checkbox_duyetgia_SOBG.Value,true,false)
            Width: =150
            X: =932
            Y: =160
      - dp_theochietkhau_SOBG:
          Control: Classic/DropDown@2.3.1
          Properties:
            BorderColor: =RGBA(202, 202, 202, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(0, 0, 0, 0)
            ChevronFill: =RGBA(4, 161, 179, 1)
            ChevronHoverFill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(77, 77, 77, 1)
            Font: =Font.Arial
            Height: =30
            Items: =var_choice_theochietkhau
            Items.Value: =Value
            OnChange: =
            PressedColor: =RGBA(255, 255, 255, 1)
            Reset: =reset_control
            SelectionColor: =RGBA(255, 255, 255, 1)
            Size: =10
            Visible: =If(dp_nhapthucong_theochietkhau_SOBG.Selected.Value ="Theo chiết khấu", true,false)
            Width: =70
            X: =858
            Y: =160
      - lbl_tonkhobomua_SOBG_1:
          Control: Label@2.5.1
          Group: Group2
          Properties:
            Color: =If(var_ton_kho_lythuyet_KT < var_input_soluong * var_selected_donvi.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)',RGBA(255, 0, 0, 1),RGBA(0, 0, 0, 1))
            Height: =20
            Size: =9
            Text: |-
              ="Tồn LT kế toán: " & Coalesce(var_ton_kho_lythuyet_KT,
                  0
              ) & " " & cb_san_pham_SOBG.Selected.'Đơn vị chuẩn text'
            Visible: =!IsBlank(dp_Don_vi_SOBG.SelectedText) And !IsBlank(var_ton_kho_lythuyet_KT)
            Width: =232
            X: =179
            Y: =181
      - loai_don_SOBG:
          Control: Text@0.0.51
          Properties:
            Height: =33
            Text: =dp_MaDH_SOBG.Selected.VAT
            Visible: =false
            Width: =102
            X: =333
            Y: =157
