# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Screen_SO_tam:
    Properties:
      OnHidden: =Set(is_Screen_SO_Tmp,false);
      OnVisible: =Set(is_Screen_SO_Tmp,true);
    Children:
      - Container Main:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            Height: =694
            LayoutDirection: =LayoutDirection.Vertical
            LayoutOverflowY: =LayoutOverflow.Scroll
            Width: =1366
            Y: =74
          Children:
            - Container Body:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  AlignInContainer: =AlignInContainer.Center
                  DropShadow: =DropShadow.Bold
                  Fill: =RGBA(250, 250, 250, 1)
                  FillPortions: =0
                  Height: =Container_Chitietdonhang.Height + Container_Chitietdonhang.Y + 100
                  LayoutMinHeight: =Container_Chitietdonhang.Height + Container_Chitietdonhang.Y + 200
                  Width: =Parent.Width
                Children:
                  - Container_Chitietdonhang:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.Regular
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Button_tu_choi_don_tam.Y + Button_tu_choi_don_tam.Height + 20
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Visible: =CountRows(Dropdown_kho.SelectedItems) > 0 And CountRows(Dropdown_DKTT.SelectedItems) > 0 And Len(TextInput_TenDonHang.Value) > 1 And CountRows(cb_donhang_tam.SelectedItems) > 0 And Len(TextInput_GhiChu.Value) > 0 And CountRows(Dropdown_LDH.SelectedItems) > 0 And CountRows(Dropdown_KenhTiepNhan.SelectedItems) > 0
                        Width: =1327
                        X: =25
                        Y: =Container_Cauhinhdonhang.Height + Container_Cauhinhdonhang.Y + 20
                      Children:
                        - TextCanvas1_3:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =40
                              Size: =22
                              Text: |-
                                ="Chi tiết đơn hàng: "
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =230
                              X: =95
                              Y: =Container_Chitietdonhang.X
                        - IconFontAwesome1_2:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =37
                              Width: =40
                              X: =50
                              Y: =Container_Chitietdonhang.X
                              iconHtml: |-
                                ="<i class='fa-solid fa-list-check' style='color: #04a1b3;'></i>"
                              iconSize: =30
                        - TextCanvas_cảnh báo:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =18
                              Text: ="Vui lòng kiểm tra thông tin đơn hàng trước khi duyệt"
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Medium
                              Width: =900
                              X: =IconFontAwesome1_2.X
                              Y: =TextCanvas1_3.Height + TextCanvas1_3.Y
                        - TextCanvas1_5:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =40
                              Size: =18
                              Text: |-
                                ="Trạng thái: "
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Medium
                              Width: =124
                              X: =1032
                              Y: =TextCanvas1_3.Y+10
                        - Button3:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =
                              BorderThickness: =0
                              DisplayMode: =DisplayMode.View
                              Fill: =RGBA(245, 158, 11, 1)
                              Height: =35
                              OnSelect: =
                              RadiusBottomLeft: =40
                              RadiusBottomRight: =40
                              RadiusTopLeft: =40
                              RadiusTopRight: =40
                              Text: ="Chờ duyệt"
                              Width: =146
                              X: =1141
                              Y: =TextCanvas1_3.Y+10
                        - TextCanvas1_6:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(4, 161, 179, 1)
                              Height: =40
                              Size: =22
                              Text: =cb_donhang_tam.Selected.Value
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =700
                              Wrap: =false
                              X: =301
                              Y: =Container_Chitietdonhang.X
                        - Button4:
                            Control: Classic/Button@2.2.0
                            Properties:
                              DisplayMode: =DisplayMode.View
                              Fill: =RGBA(238,242,255,1)
                              Height: =75
                              RadiusBottomLeft: =20
                              RadiusBottomRight: =20
                              RadiusTopLeft: =20
                              RadiusTopRight: =20
                              Text: =
                              Width: =1247
                              X: =40
                              Y: ='TextCanvas_cảnh báo'.Height + 'TextCanvas_cảnh báo'.Y + 15
                        - TextCanvas1_7:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(4, 161, 179, 1)
                              Height: =25
                              Size: =18
                              Text: ="Khách hàng"
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =200
                              X: =64
                              Y: ='TextCanvas_cảnh báo'.Height + 'TextCanvas_cảnh báo'.Y + 27
                        - TextCanvas1_8:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(4, 161, 179, 1)
                              Height: =25
                              Size: =18
                              Text: ="Ngày tạo"
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =200
                              X: =673
                              Y: ='TextCanvas_cảnh báo'.Height + 'TextCanvas_cảnh báo'.Y + 27
                        - TextCanvas1_9:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(4, 161, 179, 1)
                              Height: =25
                              Size: =18
                              Text: ="Tổng giá trị"
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =200
                              X: =937
                              Y: ='TextCanvas_cảnh báo'.Height + 'TextCanvas_cảnh báo'.Y + 27
                        - TextCanvas1_10:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(0, 0, 0, 1)
                              Height: =30
                              Size: =20
                              Text: =cb_khach_hang_tam.Selected.'Customer name'
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =570
                              Wrap: =false
                              X: =64
                              Y: '=TextCanvas1_7.Height + TextCanvas1_7.Y '
                        - TextCanvas1_11:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(0, 0, 0, 1)
                              Height: =30
                              Size: =20
                              Text: =Text(Lk_donhangtam.'Created On',"dd/mm/yyyy")
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =200
                              X: =TextCanvas1_8.X
                              Y: '=TextCanvas1_7.Height + TextCanvas1_7.Y '
                        - TextCanvas1_12:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(4, 161, 179, 1)
                              Height: =30
                              Size: =20
                              Text: =Text(Sum(Gallery_donhang.AllItems,Value(TextCanvas_TongTien.Text)),"#,### VNĐ")
                              VerticalAlign: =VerticalAlign.Top
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =298
                              X: =937
                              Y: '=TextCanvas1_7.Height + TextCanvas1_7.Y '
                        - Button4_1:
                            Control: Classic/Button@2.2.0
                            Properties:
                              DisplayMode: =DisplayMode.View
                              Fill: =RGBA(238,242,255,1)
                              Height: =174
                              RadiusBottomLeft: =20
                              RadiusBottomRight: =20
                              RadiusTopLeft: =20
                              RadiusTopRight: =20
                              Text: =
                              Visible: =var_selected_donhangtam > 0
                              Width: =1247
                              X: =40
                              Y: =Gallery_donhang.Height + Gallery_donhang.Y + 10
                        - TextCanvas1_13:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Justify
                              Font: =Font.'Open Sans'
                              FontColor: =RGBA(53, 61, 63, 1)
                              Height: =36
                              Size: =22
                              Text: ="Sản phẩm đã chọn"
                              VerticalAlign: =VerticalAlign.Top
                              Visible: =var_selected_donhangtam > 0
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =272
                              X: =111
                              Y: =IconFontAwesome1_3.Y
                        - IconFontAwesome1_3:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =37
                              Visible: =var_selected_donhangtam > 0
                              Width: =40
                              X: =64
                              Y: =Button4_1.Y + 20
                              iconHtml: |-
                                ="<i class='fa-solid fa-cart-shopping' style='color: #04a1b3;'></i>"
                              iconSize: =30
                        - Container_soluong:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              Height: =80
                              RadiusBottomLeft: =10
                              RadiusBottomRight: =10
                              RadiusTopLeft: =10
                              RadiusTopRight: =10
                              Visible: =var_selected_donhangtam > 0
                              Width: =355
                              X: =65
                              Y: =TextCanvas1_13.Height +TextCanvas1_13.Y + 10
                            Children:
                              - TextCanvas1_14:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(4, 161, 179, 1)
                                    Height: =25
                                    Size: =18
                                    Text: |-
                                      ="Số lượng sản phẩm: "
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    Width: =300
                                    X: =8
                                    Y: =5
                              - IconFontAwesome1_4:
                                  Control: CodeComponent
                                  ComponentName: crdfd_CustomComponent.IconFontAwesome
                                  Properties:
                                    Height: =37
                                    Width: =40
                                    X: =24
                                    Y: =37
                                    iconHtml: |-
                                      ="<i class='fa-solid fa-box' style='color: #04a1b3;'></i>"
                                    iconSize: =30
                              - TextCanvas1_15:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(0, 0, 0, 1)
                                    Height: =40
                                    Size: =22
                                    Text: =var_selected_donhangtam
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =280
                                    Wrap: =false
                                    X: =64
                                    Y: =37
                        - Container_tongtienhang:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              Height: =80
                              RadiusBottomLeft: =10
                              RadiusBottomRight: =10
                              RadiusTopLeft: =10
                              RadiusTopRight: =10
                              Visible: =var_selected_donhangtam > 0
                              Width: =355
                              X: =487
                              Y: =Container_soluong.Y
                            Children:
                              - TextCanvas1_16:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(4, 161, 179, 1)
                                    Height: =25
                                    Size: =18
                                    Text: |-
                                      ="Tổng tiền không VAT: "
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    Width: =300
                                    X: =8
                                    Y: =5
                              - IconFontAwesome1_5:
                                  Control: CodeComponent
                                  ComponentName: crdfd_CustomComponent.IconFontAwesome
                                  Properties:
                                    Height: =37
                                    Width: =40
                                    X: =24
                                    Y: =37
                                    iconHtml: |-
                                      ="<i class='fa-solid fa-file-invoice' style='color: #04a1b3;'></i>"
                                    iconSize: =30
                              - TextCanvas1_17:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(0, 0, 0, 1)
                                    Height: =40
                                    Size: =22
                                    Text: =Text(Sum(Filter(List_SO_tam,SelectedSP = true),P_GiaSauCK),"#,### VNĐ")
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =280
                                    Wrap: =false
                                    X: =64
                                    Y: =37
                        - Container_Tongthanhtoan:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              Height: =80
                              RadiusBottomLeft: =10
                              RadiusBottomRight: =10
                              RadiusTopLeft: =10
                              RadiusTopRight: =10
                              Visible: =var_selected_donhangtam > 0
                              Width: =355
                              X: =895
                              Y: =Container_soluong.Y
                            Children:
                              - TextCanvas1_18:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(4, 161, 179, 1)
                                    Height: =25
                                    Size: =18
                                    Text: ="Tổng thanh toán"
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    Width: =300
                                    X: =8
                                    Y: =5
                              - IconFontAwesome1_6:
                                  Control: CodeComponent
                                  ComponentName: crdfd_CustomComponent.IconFontAwesome
                                  Properties:
                                    Height: =37
                                    Width: =40
                                    X: =24
                                    Y: =37
                                    iconHtml: |-
                                      ="<i class='fa-solid fa-money-bill-wave' style='color: #04a1b3;'></i>"
                                    iconSize: =30
                              - TextCanvas1_19:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Justify
                                    Font: =Font.'Open Sans'
                                    FontColor: =RGBA(4, 161, 179, 1)
                                    Height: =40
                                    Size: =22
                                    Text: =Text(Sum(Filter(List_SO_tam,SelectedSP = true),P_ThanhTien),"#,### VNĐ")
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =280
                                    Wrap: =false
                                    X: =71
                                    Y: =37
                        - Button_duyet_don_tam:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(16, 185, 129, 1)
                              Fill: =RGBA(16,185,129,1)
                              FontWeight: =FontWeight.Bold
                              Height: =50
                              HoverFill: =App.Theme.Colors.Darker20
                              OnSelect: |-
                                =With(
                                    {
                                        khachHang: cb_khach_hang_tam.Selected,
                                        trangThaiKH: cb_khach_hang_tam.Selected.'Trạng thái KH text',
                                        ngungGiaoDich: cb_khach_hang_tam.Selected.'Ngừng giao dịch',
                                        soItems: Filter(
                                            Gallery_donhang.AllItems,
                                            SelectedSP = true
                                        ),
                                        Cb_donhang: cb_donhang_tam.Selected
                                    },
                                    If(
                                        trangThaiKH = "Khách hàng tạo mới",
                                        Notify(
                                            "Không tạo SO được vì " & trangThaiKH & "!!",
                                            NotificationType.Error,
                                            3000
                                        ),
                                        If(
                                            !IsBlank(ngungGiaoDich),
                                            Notify(
                                                "Không tạo SO được vì khách hàng " & ngungGiaoDich & "!!",
                                                NotificationType.Error,
                                                3000
                                            ),
                                            If(
                                                CountRows(soItems) > 0,
                                                With(
                                                    {
                                                        recordSO: Patch(
                                                            Sale_Orders,
                                                            Defaults(Sale_Orders),
                                                            {
                                                                'Khách hàng': khachHang,
                                                                'Điều khoản thanh toán': Dropdown_DKTT.Selected.Value,
                                                                VAT: Dropdown_VAT.Selected.Value,
                                                                'Loại đơn hàng': Dropdown_LDH.Selected.Value,
                                                                'Loại hóa đơn': Dropdown_LoaiHoaDon.Selected.Value,
                                                                'Tên đơn hàng': TextInput_TenDonHang.Value,
                                                                'Hình Thức Giao Hàng': If(
                                                                    Lk_donhangtam.'Hình thức giao hàng' = 283640000,
                                                                    HT_giaohang.'Giao 1 lần',
                                                                    HT_giaohang.'Giao theo tiến độ'
                                                                ),
                                                                'Ghi chú': TextInput_GhiChu.Value,
                                                                //'Đơn đặt hàng SO': 'dp_MaSO tạm'.Selected.Value,
                                                                'Tên thương mại': Dropdown_TenThuongMai.Selected,
                                                                'Vị trí kho': Dropdown_kho.Selected,
                                                                'Kênh tiếp nhận': Dropdown_KenhTiepNhan.Selected.Value,
                                                                'Nhân viên sales': khachHang.'Sale name'
                                                            }
                                                        )
                                                    },
                                                    ForAll(
                                                        Sequence(CountRows(soItems)),
                                                        With(
                                                            {
                                                                currentRow: Last(
                                                                    FirstN(
                                                                        soItems,
                                                                        Value
                                                                    )
                                                                )
                                                            },
                                                            Patch(
                                                                'Sale Order Details',
                                                                Defaults('Sale Order Details'),
                                                                {
                                                                    'Mã đơn hàng': recordSO,
                                                                    'Tên sản phẩm': currentRow.'Sản phẩm',
                                                                    ID_Unit_Sp: currentRow.'Đơn vị',
                                                                    'Số lượng': Value(currentRow.'Số lượng'),
                                                                    Giá: Value(currentRow.TextCanvas_GiaSauCK.Text),
                                                                    'Giá gốc': Value(currentRow.TextCanvas_GiaGoc.Text),
                                                                    'Stt đơn': Value,
                                                                    'Ngày dự kiến giao': DateValue(currentRow.DatePickerCanvas2.SelectedDate),
                                                                    Thuế: Value(currentRow.TextCanvas_GTGTSP.Text),
                                                                    'Điều chỉnh GTGT': DropdownCanvas2.Selected.Value,
                                                                    //'Ghi chú': currentRow.'txt_GhiChu_SO tạm'.Text,
                                                                    'Duyệt giá (crdfd_duyetgia)': Switch(
                                                                        currentRow.DropdownNguoiDuyetGia.Selected.Value,
                                                                        "Bùi Tuấn Dũng",
                                                                        'Duyệt giá (Sale Order Details)'.'Bùi Tuấn Dũng',
                                                                        "Lê Sinh Thông",
                                                                        'Duyệt giá (Sale Order Details)'.'Lê Sinh Thông',
                                                                        "Lê Thị Ngọc Anh",
                                                                        'Duyệt giá (Sale Order Details)'.'Lê Thị Ngọc Anh',
                                                                        "Nguyễn Quốc Chinh",
                                                                        'Duyệt giá (Sale Order Details)'.'Nguyễn Quốc Chinh',
                                                                        "Huỳnh Minh Trung",
                                                                        'Duyệt giá (Sale Order Details)'.'Huỳnh Minh Trung',
                                                                        "Bùi Thị Mỹ Trang",
                                                                        'Duyệt giá (Sale Order Details)'.'Bùi Thị Mỹ Trang',
                                                                        "Hà Bông",
                                                                        'Duyệt giá (Sale Order Details)'.'Hà Bông'
                                                                    ),
                                                                    //'Đơn hàng gấp': currentRow.Checkbox_DHgap.Value,
                                                                    'Chiết khấu %': If(
                                                                        currentRow.'Đơn vị chiết khấu' = "%",
                                                                        currentRow.'Chiết khấu' / 100,
                                                                        0
                                                                    ),
                                                                    'Chiết khấu VNĐ': If(
                                                                        currentRow.'Đơn vị chiết khấu' = "VNĐ",
                                                                        currentRow.'Chiết khấu',
                                                                        0
                                                                    ),
                                                                    Promotion: currentRow.Promotion,
                                                                    'Chiết khấu 2 (%)': 0,
                                                                    Ca: currentRow.DropdownCanvas_Ca.Selected.Value,
                                                                    'Phụ phí hoá đơn (%)': If(
                                                                        Dropdown_LoaiHoaDon.Selected.Value = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop",
                                                                        0.015,
                                                                        0
                                                                    ),
                                                                    'Ghi chú': currentRow.TextInputCanvas_GhiChu.Value
                                                                }
                                                            );
                                                        )
                                                    );
                                                    UpdateContext({Create_recordSO: recordSO});
                                                    ForAll(
                                                        soItems As L_SoItem,
                                                        Patch(
                                                            'Đặt hàng SOS',
                                                            LookUp(
                                                                'Đặt hàng SOS',
                                                                ID = L_SoItem.ID
                                                            ),
                                                            {'Trạng thái đơn hàng': 'Trạng thái đơn hàng (Đặt hàng SOS)'.'Đã xác nhận'}
                                                        )
                                                    );
                                                );
                                                Notify(
                                                    "Chuyển đơn đặt hàng --> SO thành công !",
                                                    NotificationType.Success,
                                                    2000
                                                );
                                                Set(
                                                    khachhang_selected,
                                                    cb_khach_hang_tam.Selected
                                                );
                                                Set(
                                                    var_check_promotion_SOD,
                                                    IsEmpty(
                                                        Filter(
                                                            List_SO_tam,
                                                            SelectedSP = true,
                                                            !IsBlank(Promotion)
                                                        )
                                                    )
                                                );
                                                Set(
                                                    Total_Order,
                                                    Sum(
                                                        Filter(
                                                            List_SO_tam,
                                                            SelectedSP = true
                                                        ),
                                                        P_ThanhTien
                                                    )
                                                );
                                                Set(
                                                    var_table_SP,
                                                    Split(
                                                        Concat(
                                                            ShowColumns(
                                                                Filter(
                                                                    List_SO_tam,
                                                                    SelectedSP = true
                                                                ),
                                                                'Mã sản phẩm'
                                                            ),
                                                            crdfd_masanpham,
                                                            ","
                                                        ),
                                                        ","
                                                    )
                                                );
                                                Set(
                                                    var_table_NSP,
                                                    Split(
                                                        Concat(
                                                            ShowColumns(
                                                                Filter(
                                                                    List_SO_tam,
                                                                    SelectedSP = true
                                                                ),
                                                                'Mã nhóm sản phẩm'
                                                            ),
                                                            crdfd_manhomsanpham,
                                                            ","
                                                        ),
                                                        ","
                                                    )
                                                );
                                                Set(
                                                    var_count_notIn_Promotions,
                                                    CountRows(
                                                        Filter(
                                                            Filter(
                                                                Gallery_donhang.AllItems,
                                                                SelectedSP = true
                                                            ) As item,
                                                            CountRows(
                                                                Filter(
                                                                    ListPromotion_Order As PromotionM,
                                                                    PromotionM.'Chiết khấu 2' = 'Chiết khấu 2 (Promotion)'.Yes && (item.'Mã sản phẩm' in PromotionM.Ma_SP || item.'Mã nhóm sản phẩm' in PromotionM.Ma_NSP)
                                                                )
                                                            ) = 0
                                                        )
                                                    )
                                                );
                                                Set(
                                                    var_dieukhoanthanhtoan,
                                                    Text(Dropdown_DKTT.Selected.Value)
                                                );
                                                UpdateContext({Popup_PromotionOrder: true});
                                                Reset(cb_khach_hang_tam);
                                                Reset(cb_donhang_tam);
                                                Reset(TextInput_TenDonHang);
                                                Reset(TextInput_GhiChu);
                                            )
                                        )
                                    )
                                )
                              Size: =14
                              Text: ="Duyệt đơn hàng đã chọn"
                              Visible: =var_selected_donhangtam > 0
                              Width: =350
                              X: =40
                              Y: =Button4_1.Y + Button4_1.Height + 20
                        - IconFontAwesome1_7:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =26
                              Visible: =var_selected_donhangtam > 0
                              Width: =35
                              X: =60
                              Y: =Button_duyet_don_tam.Y + 10
                              iconHtml: |-
                                ="<i class='fa-solid fa-check' style='color: #ffffff;'></i>"
                              iconSize: =30
                        - Button_tu_choi_don_tam:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(189, 49, 51, 1)
                              BorderThickness: =1
                              DisplayMode: |-
                                =If(
                                    CountRows(
                                        Filter(
                                            List_SO_tam,
                                            SelectedSP = true
                                        )
                                    ) > 0,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                              Fill: =RGBA(189, 49, 51, 1)
                              FontWeight: =FontWeight.Bold
                              Height: =50
                              HoverBorderColor: =RGBA(189, 49, 51, 0.5)
                              HoverFill: =RGBA(255, 184, 174, 1)
                              OnSelect: |-
                                =
                                If(
                                    CountRows(
                                        Filter(
                                            List_SO_tam,
                                            SelectedSP = true
                                        )
                                    ) > 0,
                                    With(
                                        {
                                            selectedItems: Filter(
                                                List_SO_tam,
                                                SelectedSP = true
                                            )
                                        },
                                        // Patch trước
                                        ForAll(
                                            selectedItems As recorDH,
                                            Patch(
                                                'Đặt hàng SOS',
                                                LookUp(
                                                    'Đặt hàng SOS',
                                                    ID = recorDH.ID
                                                ),
                                                {'Trạng thái đơn hàng': 'Trạng thái đơn hàng (Đặt hàng SOS)'.'Hủy đơn hàng'}
                                            )
                                        );
                                        // Rồi Remove sau
                                Remove(
                                            List_SO_tam,
                                            selectedItems
                                        )
                                    );
                                    Notify(
                                        "Từ chối thành công",
                                        NotificationType.Success,
                                        3000
                                    ),
                                    Notify(
                                        "Vui lòng chọn sản phẩm để từ chối",
                                        NotificationType.Warning,
                                        3000
                                    )
                                )
                              Size: =14
                              Text: ="Từ chối đơn hàng"
                              Width: =300
                              X: =If(var_selected_donhangtam > 0, Button_duyet_don_tam.Width + Button_duyet_don_tam.X + 30,67)
                              Y: =If(var_selected_donhangtam > 0, Button_duyet_don_tam.Y,Gallery_donhang.Height + Gallery_donhang.Y + 20)
                        - IconFontAwesome1_8:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =26
                              Width: =35
                              X: =Button_tu_choi_don_tam.X + 20
                              Y: =Button_tu_choi_don_tam.Y + 10
                              iconHtml: |-
                                ="<i class='fa-solid fa-xmark' style='color: #ffffff;'></i>"
                              iconSize: =30
                        - Button_in_don_hang_tam:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(106, 122, 127, 1)
                              BorderThickness: =1
                              Fill: =RGBA(106, 122, 127, 1)
                              FontWeight: =FontWeight.Bold
                              Height: =50
                              HoverFill: =RGBA(214, 221, 224, 1)
                              OnSelect: =Notify("Coming Soon",NotificationType.Information,2000)
                              Size: =14
                              Text: ="In đơn hàng"
                              Width: =270
                              X: =Button_tu_choi_don_tam.Width + Button_tu_choi_don_tam.X + 30
                              Y: =Button_tu_choi_don_tam.Y
                        - IconFontAwesome1_9:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =26
                              Width: =35
                              X: =Button_in_don_hang_tam.X  +20
                              Y: =Button_in_don_hang_tam.Y + 10
                              iconHtml: |-
                                ="<i class='fa-solid fa-print' style='color: #ffffff;'></i>"
                              iconSize: =30
                        - Gallery_donhang:
                            Control: Gallery@2.15.0
                            Variant: VariableHeight
                            Properties:
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderThickness: =1
                              Fill: =RGBA(255, 255, 255, 1)
                              Height: =Min(CountIf(List_SO_tam,true) * 90, 370)
                              Items: =List_SO_tam
                              OnSelect: =
                              ShowNavigation: =true
                              TemplatePadding: =4
                              TemplateSize: =85
                              Width: =1247
                              X: =40
                              Y: =256
                            Children:
                              - CheckboxCanvas1:
                                  Control: CheckBox@0.0.30
                                  Properties:
                                    BasePaletteColor: =RGBA(4, 161, 179, 1)
                                    CheckboxSize: =18
                                    Checked: =ThisItem.SelectedSP
                                    Height: =50
                                    Label: =
                                    OnCheck: |-
                                      =UpdateIf(
                                          List_SO_tam,
                                          ID = ThisItem.ID,
                                          {
                                              SelectedSP: true,
                                              P_ThanhTien: Value(TextCanvas_TongTien.Text),
                                              P_GiaSauCK: Value(TextCanvas_GiaSauCK.Text)
                                          }
                                      )
                                    OnSelect: =Select(Parent)
                                    OnUncheck: |-
                                      =UpdateIf(
                                          List_SO_tam,
                                          ID = ThisItem.ID,
                                          {
                                              SelectedSP: false,
                                              P_ThanhTien: 0,
                                              P_GiaSauCK: 0
                                          }
                                      )
                                    Width: =46
                                    Y: =25
                              - TextCanvas1:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: =ThisItem.'Sản phẩm text'
                                    Width: =230
                                    Wrap: =false
                                    X: =46
                              - TextCanvas1_20:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: =ThisItem.'Đơn vị CAL'
                                    Width: =60
                                    Wrap: =false
                                    X: =296
                              - TextCanvas_SL:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Center
                                    BorderRadius: =10
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: =ThisItem.'Số lượng'
                                    Width: =56
                                    Wrap: =false
                                    X: =358
                              - TextCanvas_ChietKhau:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: |-
                                      =Switch(
                                          ThisItem.'Đơn vị chiết khấu',
                                          "VNĐ",
                                          Text(
                                              ThisItem.'Chiết khấu',
                                              "#,###"
                                          ),
                                          "%",
                                          (ThisItem.'Chiết khấu' & "%"),
                                          "0"
                                      )
                                    Width: =70
                                    Wrap: =false
                                    X: =513
                              - TextCanvas_GiaSauCK:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: |-
                                      =Text(
                                          Value(
                                              If(
                                                  Dropdown_LoaiHoaDon.Selected.Value = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' && Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT' && var_Nganh_nghe = "Shop",
                                                  If(
                                                      ThisItem.'Đơn vị chiết khấu' = "VNĐ",
                                                      Value(TextCanvas_GiaGoc.Text) - ThisItem.'Chiết khấu',
                                                      Value(TextCanvas_GiaGoc.Text) * (1 - ThisItem.'Chiết khấu' / 100)
                                                  ) * 1.015,
                                                  If(
                                                      ThisItem.'Đơn vị chiết khấu' = "VNĐ",
                                                      Value(TextCanvas_GiaGoc.Text) - ThisItem.'Chiết khấu',
                                                      Value(TextCanvas_GiaGoc.Text) * (1 - ThisItem.'Chiết khấu' / 100)
                                                  )
                                              )
                                          ),
                                          "#,###"
                                      )
                                    Width: =100
                                    Wrap: =false
                                    X: =583
                              - TextCanvas1_25:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =RGBA(217, 7, 7, 1)
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: "=\"Giảm: \" & Text(\n    If(\n        ThisItem.'Đơn vị chiết khấu' = \"%\",\n        Value(TextCanvas_GiaGoc.Text) * (ThisItem.'Chiết khấu' / 100)\n    ),\n    \"#,### đ\"\n) "
                                    Visible: |-
                                      =If(
                                          ThisItem.'Đơn vị chiết khấu' = "%",
                                          true,
                                          false
                                      )
                                    Width: =170
                                    X: =513
                                    Y: =35
                              - TextCanvas_TongTien:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    Size: =16
                                    Text: |-
                                      =With(
                                          {
                                              value_GTGT: Switch(
                                                  DropdownCanvas2.Selected.Value,
                                                  'Thuế GTGT'.'0%',
                                                  1,
                                                  'Thuế GTGT'.'10%',
                                                  1.10,
                                                  'Thuế GTGT'.'5%',
                                                  1.05,
                                                  'Thuế GTGT'.'8%',
                                                  1.08
                                              )
                                          },
                                          Text(
                                              Value(TextCanvas_SL.Text) * Value(TextCanvas_GiaSauCK.Text) * value_GTGT,
                                              "#,###"
                                          )
                                      )
                                    Width: =100
                                    Wrap: =false
                                    X: =743
                              - DropdownNguoiDuyetGia:
                                  Control: DropDown@0.0.45
                                  Properties:
                                    Appearance: ='DropdownCanvas.Appearance'.Outline
                                    FontSize: =16
                                    Height: =35
                                    Items: |-
                                      =If(
                                          IsBlank(ThisItem.'Người duyệt giá'),
                                          [
                                              "",
                                              "Bùi Tuấn Dũng",
                                              "Lê Sinh Thông",
                                              "Lê Thị Ngọc Anh",
                                              "Nguyễn Quốc Chinh",
                                              "Huỳnh Minh Trung",
                                              "Bùi Thị Mỹ Trang",
                                              "Hà Bông"
                                          ],
                                          [ThisItem.'Người duyệt giá']
                                      )
                                    PaddingLeft: =5
                                    Width: =80
                                    X: =843
                                  Children:
                                    - Value2:
                                        Control: DropDownDataField@1.5.0
                                        Variant: textualColumn
                                        IsLocked: true
                                        Properties:
                                          FieldDisplayName: ="Value"
                                          FieldName: ="Value"
                                          FieldType: ="s"
                                          Order: =1
                              - TextCanvas1_28:
                                  Control: Text@0.0.51
                                  Properties:
                                    FontColor: =RGBA(53, 61, 63, 1)
                                    Height: =25
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: |-
                                      ="Leadtime sản phẩm: " & ThisItem.'Sản phẩm'.'Lead time' & " ngày"
                                    Width: =398
                                    Wrap: =false
                                    X: =46
                                    Y: =35
                              - TextCanvas1_29:
                                  Control: Text@0.0.51
                                  Properties:
                                    FontColor: =RGBA(53, 61, 63, 1)
                                    Height: =25
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: |-
                                      ="Tồn kho (bộ mua): "  & Coalesce(
                                          LookUp(
                                              'Kho Bình Định',
                                              'Vị trí kho'.'Mã kho' = Dropdown_kho.Selected.'Mã kho' &&
                                              'Tên sản phẩm'.'Tên sản phẩm' = ThisItem.'Sản phẩm'.'Tên sản phẩm',
                                              'Tồn kho lý thuyết - Bỏ mua'
                                          ),
                                          0
                                      ) & " " & ThisItem.'Sản phẩm'.'Đơn vị chuẩn text'
                                    Width: =398
                                    Wrap: =false
                                    X: =46
                                    Y: =60
                              - TextInputCanvas_GhiChu:
                                  Control: TextInput@0.0.54
                                  Properties:
                                    Appearance: ='TextInputCanvas.Appearance'.Outline
                                    FontSize: =12
                                    Height: =35
                                    Width: =120
                                    X: =923
                              - DatePickerCanvas2:
                                  Control: DatePicker@0.0.46
                                  Properties:
                                    Appearance: ='DatePickerCanvas.Appearance'.Outline
                                    DateTimeZone: ='DatePickerCanvas.DateTimeZone'.Local
                                    FontSize: =12
                                    Format: ="d/m/yyyy"//'DatePickerCanvas.Format'.Short
                                    Height: =35
                                    OnChange: |-
                                      =If(
                                          DateValue(DatePickerCanvas2.SelectedDate) < DateValue(ngay_giao),
                                          Notify("Ngày giao dự kiến không hợp lệ!!!", NotificationType.Warning, 1000);
                                          Reset(DatePickerCanvas2)
                                      );
                                    SelectedDate: =ThisItem.NgayGiao
                                    Width: =100
                                    X: =1043
                                    Y: =1
                              - DropdownCanvas2:
                                  Control: DropDown@0.0.45
                                  Properties:
                                    Appearance: ='DropdownCanvas.Appearance'.Outline
                                    DefaultSelectedItems: |
                                      =With(
                                          {
                                              gtgtValue: ThisItem.'Sản phẩm'.GTGT,
                                              isVATIncluded: Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT',
                                              isPriceIncludesVAT: ThisItem.'Sản phẩm'.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)'
                                          },
                                          If(
                                              isVATIncluded,
                                              Switch(
                                                  gtgtValue,
                                                  'GTGT (products)'.'10%', LookUp(Choices('Thuế GTGT'), Value = 'Thuế GTGT'.'10%'),
                                                  'GTGT (products)'.'8%', LookUp(Choices('Thuế GTGT'), Value = 'Thuế GTGT'.'8%'),
                                                  'GTGT (products)'.'5%', LookUp(Choices('Thuế GTGT'), Value = 'Thuế GTGT'.'5%'),
                                                  LookUp(Choices('Thuế GTGT'), Value = 'Thuế GTGT'.'0%')
                                              ),
                                              LookUp(Choices('Thuế GTGT'), Value = 'Thuế GTGT'.'0%')
                                          )
                                      )
                                    DisplayMode: =DisplayMode.View
                                    Items: =Choices('Thuế GTGT')
                                    Width: =60
                                    X: =683
                              - TextCanvas_GTGTSP:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =RGBA(79, 90, 94, 1)
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: |-
                                      =With(
                                          {
                                              Value_GTGT: Switch(
                                                  DropdownCanvas2.Selected.Value,
                                                  'Thuế GTGT'.'0%',
                                                  0,
                                                  'Thuế GTGT'.'10%',
                                                  0.10,
                                                  'Thuế GTGT'.'5%',
                                                  0.05,
                                                  'Thuế GTGT'.'8%',
                                                  0.08
                                              )
                                          },
                                          Text(
                                              Value(TextCanvas_GiaSauCK.Text) * Value_GTGT,
                                              "#,###"
                                          )
                                      )
                                    Visible: =Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT'
                                    Width: =200
                                    X: =771
                                    Y: =35
                              - TextCanvas1_34:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =RGBA(79, 90, 94, 1)
                                    Height: =35
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: |-
                                      ="GTGT: + "
                                    Visible: =Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT'
                                    Width: =50
                                    X: =728
                                    Y: =35
                              - TextCanvas1_35:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =RGBA(217, 7, 7, 1)
                                    Height: =30
                                    PaddingBottom: =5
                                    PaddingRight: =5
                                    PaddingTop: =0
                                    Size: =12
                                    Text: |-
                                      =If(
                                          Dropdown_LoaiHoaDon.Selected.Value = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop",
                                          "PPHĐ: + " & Text(
                                              Value(TextCanvas_GiaSauCK.Text) * 0.015,
                                              "#,### đ"
                                          )
                                      )
                                    Visible: =Dropdown_LoaiHoaDon.Selected.Value = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop"
                                    Width: =170
                                    X: =514
                                    Y: =50
                              - DropdownCanvas_Ca:
                                  Control: DropDown@0.0.45
                                  Properties:
                                    Appearance: ='DropdownCanvas.Appearance'.Outline
                                    DefaultSelectedItems: =[ThisItem.CaSP]
                                    Height: =35
                                    Items: =Choices('Ca (Sale Order Details)')
                                    Width: =90
                                    X: =1143
                                    Y: =1
                              - TextCanvas_GiaGoc:
                                  Control: Label@2.5.1
                                  Properties:
                                    Height: =35
                                    OnSelect: =Select(Parent)
                                    Size: =12
                                    Text: |-
                                      =Text(
                                          Value(
                                              Switch(
                                                  true,
                                                          // ✅ Que hàn đặc biệt
                                                  ThisItem.'Sản phẩm'.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)' && Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT',
                                                  ThisItem.BGCT.'Giá không VAT',
                                                  ThisItem.'Sản phẩm'.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)' && Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT',
                                                  ThisItem.BGCT.Giá,
                                                          // ✅ Các trường hợp khác theo bản chất
                                                  ThisItem.'Sản phẩm'.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT',
                                                  If(
                                                      Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT',
                                                      ThisItem.BGCT.'Giá không VAT',
                                                      ThisItem.BGCT.Giá
                                                  ),
                                                  ThisItem.'Sản phẩm'.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá chưa bao gồm VAT',
                                                  ThisItem.BGCT.'Giá không VAT',
                                                          // ✅ Mặc định
                                                  ThisItem.BGCT.Giá
                                              )
                                          ),
                                          "#,###"
                                      )
                                    Width: =100
                                    X: =414
                              - Rectangle2:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    BorderStyle: =BorderStyle.None
                                    DisplayMode: =DisplayMode.View
                                    Fill: =RGBA(214, 221, 224, 1)
                                    Height: =1
                                    OnSelect: =Select(Parent)
                                    Width: =1239
                                    Y: =80
                        - Container2:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              Fill: =RGBA(214, 221, 224, 0.23)
                              Height: =50
                              RadiusBottomLeft: =10
                              RadiusBottomRight: =10
                              RadiusTopLeft: =10
                              RadiusTopRight: =10
                              Width: =1247
                              X: =40
                              Y: =196
                            Children:
                              - TextCanvas3_1:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Sản phẩm"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =250
                                    X: =46
                              - TextCanvas3_2:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Đơn vị"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =60
                                    X: =296
                              - TextCanvas3_3:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Số lượng"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =56
                                    Wrap: =false
                                    X: =358
                              - TextCanvas3_4:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Giá gốc"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =100
                                    Wrap: =false
                                    X: =414
                              - TextCanvas3_5:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Chiết khấu"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =70
                                    Wrap: =false
                                    X: =513
                              - TextCanvas3_6:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Giá sau CK"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =100
                                    Wrap: =false
                                    X: =583
                              - TextCanvas3_7:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="VAT"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =60
                                    Wrap: =false
                                    X: =683
                              - TextCanvas3_8:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Tổng tiền"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =100
                                    Wrap: =false
                                    X: =743
                              - TextCanvas3_9:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Người duyệt"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =80
                                    Wrap: =false
                                    X: =843
                              - TextCanvas3_10:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Ghi chú"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =120
                                    Wrap: =false
                                    X: =923
                              - TextCanvas3_11:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Ngày giao"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =100
                                    Wrap: =false
                                    X: =1043
                              - TextCanvas3_12:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.Start
                                    Font: =Font.'Open Sans'
                                    Height: =50
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    PaddingRight: =5
                                    PaddingTop: =15
                                    Size: =12
                                    Text: ="Ca"
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =90
                                    Wrap: =false
                                    X: =1143
                              - CheckboxCanvas1_1:
                                  Control: CheckBox@0.0.30
                                  Properties:
                                    BasePaletteColor: =RGBA(4, 161, 179, 1)
                                    CheckboxSize: =18
                                    Checked: =CountIf(List_SO_tam,SelectedSP = true) = CountIf(List_SO_tam,true) And CountIf(List_SO_tam,true) > 0
                                    Height: =50
                                    Label: =
                                    OnCheck: |-
                                      =///UpdateIf(List_SO_tam,true,{SelectedSP:false})
                                      ForAll(
                                          Gallery_donhang.AllItems As l_SOtmp,
                                          Patch(
                                              List_SO_tam,
                                              LookUp(
                                                  List_SO_tam,
                                                  ID = l_SOtmp[@ID]
                                              ),
                                              {
                                                  SelectedSP: true,
                                                  P_ThanhTien: Value(l_SOtmp[@TextCanvas_TongTien].Text),
                                                  P_GiaSauCK: Value(l_SOtmp[@TextCanvas_GiaSauCK].Text)
                                              }
                                          )
                                      )
                                    OnSelect: =
                                    OnUncheck: |-
                                      =///UpdateIf(List_SO_tam,true,{SelectedSP:false})
                                      ForAll(
                                          Gallery_donhang.AllItems As l_SOtmp,
                                          Patch(
                                              List_SO_tam,
                                              LookUp(
                                                  List_SO_tam,
                                                  ID = l_SOtmp[@ID]
                                              ),
                                              {
                                                  SelectedSP: false,
                                                  P_ThanhTien: Value(l_SOtmp[@TextCanvas_TongTien].Text),
                                                  P_GiaSauCK: Value(l_SOtmp[@TextCanvas_GiaSauCK].Text)
                                              }
                                          )
                                      )
                                    Width: =50
                                    X: =3
                  - Container_Cauhinhdonhang:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.Regular
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =227
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Visible: =CountRows(cb_donhang_tam.SelectedItems) > 0
                        Width: =1327
                        X: =25
                        Y: =Container_Locdonhang.Y + Container_Locdonhang.Height + 20
                      Children:
                        - TextCanvas1_4:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =40
                              Size: =22
                              Text: ="Cấu hình đơn hàng"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =500
                              X: =88
                              Y: =IconFontAwesome1_10.Y
                        - IconFontAwesome1_10:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =37
                              Width: =40
                              X: =43
                              Y: =17
                              iconHtml: |-
                                ="<i class='fa-solid fa-gear' style='color: #04a1b3;'></i>"
                              iconSize: =30
                        - TextInput_TenDonHang:
                            Control: TextInput@0.0.54
                            Properties:
                              BorderColor: =If(Len(TextInput_TenDonHang.Value)>0,RGBA(214, 221, 224, 1), RGBA(224, 80, 92,1))
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              Fill: =RGBA(255, 255, 255, 1)
                              Font: =Font.'Open Sans'
                              FontSize: =18
                              FontWeight: =FontWeight.Normal
                              Height: =40
                              Placeholder: ="Tên đơn hàng"
                              TriggerOutput: ='TextInputCanvas.TriggerOutput'.Keypress
                              Width: =270
                              X: =43
                              Y: =TextCanvas2.Height + TextCanvas2.Y
                        - TextCanvas2:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Tên đơn hàng (*)"
                              Width: =TextInput_TenDonHang.Width
                              X: =43
                              Y: =TextCanvas1_4.Height + TextCanvas1_4.Y
                        - TextCanvas2_1:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: '="Điều khoản thanh toán" '
                              Width: =Dropdown_DKTT.Width
                              X: =TextCanvas2.Width + TextCanvas2.X + 30
                              Y: =TextCanvas2.Y
                        - Dropdown_DKTT:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: =LookUp(Choices('Điều khoản thanh toán - choice'), Value = Lk_donhangtam.'Điều khoản thanh toán')
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: =Choices('Điều khoản thanh toán - choice')
                              Width: =300
                              X: =TextCanvas2_1.X
                              Y: =TextInput_TenDonHang.Y
                            Children:
                              - Value1:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Value"
                                    FieldName: ="Value"
                                    FieldType: ="l"
                                    Order: =1
                        - TextCanvas2_2:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Loại đơn hàng (*)"
                              Width: =Dropdown_LDH.Width
                              X: =TextCanvas2_1.Width +TextCanvas2_1.X + 30
                              Y: =TextCanvas2.Y
                        - Dropdown_LDH:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =If(Len(Dropdown_LDH.Selected.Value)>0,RGBA(214, 221, 224, 1), RGBA(224, 80, 92,1))
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: =Choices('Loại đơn hàng (Sale_Orders)')
                              Width: =300
                              X: =TextCanvas2_2.X
                              Y: =TextInput_TenDonHang.Y
                            Children:
                              - Value4:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Value"
                                    FieldName: ="Value"
                                    FieldType: ="l"
                                    Order: =1
                        - TextCanvas_vat:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="VAT"
                              Width: =Dropdown_VAT.Width
                              X: =TextCanvas2.X
                              Y: =TextInput_TenDonHang.Height + TextInput_TenDonHang.Y + 10
                        - Dropdown_VAT:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: =LookUp(Choices(VAT_choice), Value = Lk_donhangtam.VAT)
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: =Choices(VAT_choice)
                              OnChange: |-
                                =Reset(Dropdown_LoaiHoaDon);
                                UpdateIf(List_SO_tam,true,{SelectedSP:false})
                              Width: =150
                              X: =TextCanvas_vat.X
                              Y: =TextCanvas_vat.Height + TextCanvas_vat.Y
                            Children:
                              - Value3:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Value"
                                    FieldName: ="Value"
                                    FieldType: ="l"
                                    Order: =1
                        - Dropdown_TenThuongMai:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: |-
                                =LookUp(
                                    'Công ty',
                                    ID = If(
                                        Dropdown_VAT.Selected.Value = VAT_choice.'Có VAT',
                                        GUID("8f603736-b718-ef11-840a-000d3aa00fac"), //Wecare
                                        GUID("6872ed50-b718-ef11-840a-000d3aa00fac") //Weshop
                                    )
                                )
                              DisplayMode: =DisplayMode.View
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: |-
                                =
                                Filter('Công ty',Status = 'Status (Công ty)'.Active)
                              Width: =150
                              X: =TextCanvas_tenthuongmai.X
                              Y: =TextCanvas_tenthuongmai.Height + TextCanvas_tenthuongmai.Y
                            Children:
                              - Tên công ty1:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Tên công ty"
                                    FieldName: ="cr1bb_name"
                                    FieldType: ="s"
                                    Order: =1
                        - TextCanvas_tenthuongmai:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Tên thương mại"
                              Width: =Dropdown_VAT.Width
                              X: =TextCanvas_vat.X + TextCanvas_vat.Width + 30
                              Y: =TextInput_TenDonHang.Height + TextInput_TenDonHang.Y + 10
                        - TextCanvas_xuathoadon:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Loại hóa đơn"
                              Visible: =Dropdown_VAT.Selected.Value = VAT_choice.'Không VAT'
                              Width: =Dropdown_LoaiHoaDon.Width
                              X: =TextCanvas_tenthuongmai.Width + TextCanvas_tenthuongmai.X + 30
                              Y: =137
                        - TextInput_GhiChu:
                            Control: TextInput@0.0.54
                            Properties:
                              BorderColor: =If(Len(TextInput_GhiChu.Value)>0,RGBA(214, 221, 224, 1), RGBA(224, 80, 92,1))
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              Fill: =RGBA(255, 255, 255, 1)
                              Font: =Font.'Open Sans'
                              FontSize: =18
                              FontWeight: =FontWeight.Normal
                              Height: =40
                              Placeholder: ="Nhập ghi chú..."
                              TriggerOutput: ='TextInputCanvas.TriggerOutput'.Keypress
                              Width: =300
                              X: =TextCanvas_ghichu.X
                              Y: =TextCanvas_ghichu.Height + TextCanvas_ghichu.Y
                        - TextCanvas_ghichu:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Ghi chú (*)"
                              Width: =TextInput_GhiChu.Width
                              X: =TextCanvas2_2.Width +TextCanvas2_2.X + 30
                              Y: =57
                        - Dropdown_LoaiHoaDon:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.Outline
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: =LookUp(Choices('Loại hóa đơn (Sale_Orders)'),Value = 'Loại hóa đơn (Sale_Orders)'.'Không xuất hóa đơn')
                              FontSize: =18
                              Height: =40
                              Items: =Choices('Loại hóa đơn (Sale_Orders)')
                              OnChange: =UpdateIf(List_SO_tam,true,{SelectedSP:false})
                              Visible: =TextCanvas_xuathoadon.Visible
                              Width: =150
                              X: =TextCanvas_xuathoadon.X
                              Y: =167
                        - TextCanvas2_4:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Kho"
                              Width: =Dropdown_kho.Width
                              X: |-
                                =If(
                                    Dropdown_VAT.Selected.Value <> VAT_choice.'Có VAT',
                                    TextCanvas_xuathoadon.Width + TextCanvas_xuathoadon.X + 30,
                                    TextCanvas_tenthuongmai.Width + TextCanvas_tenthuongmai.X + 30
                                )
                              Y: =137
                        - Dropdown_kho:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: =cb_khach_hang_tam.Selected.'Vị trí kho'
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: =var_filterkho
                              Width: =200
                              X: =TextCanvas2_4.X
                              Y: =167
                            Children:
                              - crdfd_name1_2:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="crdfd_name"
                                    FieldName: ="crdfd_name"
                                    FieldType: ="s"
                                    Order: =1
                        - TextCanvas2_5:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =30
                              Size: =16
                              Text: ="Kênh tiếp nhận"
                              Width: =Dropdown_KenhTiepNhan.Width
                              X: =TextCanvas2_4.Width + TextCanvas2_4.X + 30
                              Y: =137
                        - Dropdown_KenhTiepNhan:
                            Control: DropDown@0.0.45
                            Properties:
                              Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                              BorderColor: =RGBA(214, 221, 224, 1)
                              BorderRadius: =10
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =1
                              DefaultSelectedItems: =LookUp(Choices('Kênh tiếp nhận'), Value = Lk_donhangtam.'Kênh tiếp nhận SO')
                              Fill: =RGBA(255, 255, 255, 1)
                              FontSize: =18
                              Height: =40
                              Items: =Choices(Sale_Orders.'Kênh tiếp nhận')
                              Width: =200
                              X: =TextCanvas2_4.Width + TextCanvas2_4.X + 30
                              Y: =167
                            Children:
                              - Value5:
                                  Control: DropDownDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Value"
                                    FieldName: ="Value"
                                    FieldType: ="l"
                                    Order: =1
                  - Container_Locdonhang:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.Regular
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =cb_khach_hang_tam.Height + cb_khach_hang_tam.Y +20
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Width: =1327
                        X: =25
                        Y: =17
                      Children:
                        - TextCanvas1_2:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =40
                              Size: =22
                              Text: ="Lọc đơn hàng"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =225
                              X: =85
                              Y: =IconFontAwesome1_1.Y
                        - IconFontAwesome1_1:
                            Control: CodeComponent
                            ComponentName: crdfd_CustomComponent.IconFontAwesome
                            Properties:
                              Height: =37
                              Width: =40
                              X: =40
                              Y: =17
                              iconHtml: |-
                                ="<i class='fa-solid fa-filter' style='color: #04a1b3;'></i>"
                              iconSize: =30
                        - TextCanvas_khachhang:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =35
                              Size: =16
                              Text: ="Chọn khách hàng"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Medium
                              Width: =225
                              X: =40
                              Y: =TextCanvas1_2.Height+TextCanvas1_2.Y
                        - TextCanvas_khachhang_1:
                            Control: Text@0.0.51
                            Properties:
                              Font: =Font.'Open Sans'
                              Height: =35
                              Size: =16
                              Text: ="Chọn mã đơn hàng"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Medium
                              Width: =225
                              X: =667
                              Y: =TextCanvas_khachhang.Y
                        - cb_khach_hang_tam:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              AccessibleLabel: =
                              BorderColor: =RGBA(202, 202, 202, 1)
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =RGBA(0, 0, 0, 1)
                              ChevronHoverBackground: =RGBA(0, 0, 0, 1)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              Color: =RGBA(77, 77, 77, 1)
                              DisplayFields: =["crdfd_name"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: ="Chọn khách hàng"
                              Items: =List_Customer
                              OnChange: =
                              PressedColor: =RGBA(116, 116, 116, 1)
                              SearchFields: =["crdfd_name"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(116, 192, 252, 1)
                              Size: =12
                              Tooltip: =
                              Width: =610
                              X: =40
                              Y: =TextCanvas_khachhang.Height + TextCanvas_khachhang.Y
                        - cb_donhang_tam:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              AccessibleLabel: =
                              BorderColor: =RGBA(202, 202, 202, 1)
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =RGBA(0, 0, 0, 1)
                              ChevronHoverBackground: =RGBA(0, 0, 0, 1)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              Color: =RGBA(77, 77, 77, 1)
                              DefaultSelectedItems: =First(Distinct(var_dhSOTam, 'Mã SO'))
                              DisplayFields: =["Value"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: ="Chọn mã đơn hàng"
                              IsSearchable: =false
                              Items: =Distinct(var_dhSOTam, 'Mã SO')
                              OnChange: |
                                =ClearCollect(
                                    List_SO_tam,
                                    AddColumns(
                                        Sort(
                                            Filter(
                                                'Đặt hàng SOS',
                                                Status = 'Status (Đặt hàng SOS)'.Active,
                                                'Mã SO' = cb_donhang_tam.Selected.Value,
                                                'Trạng thái đơn hàng' = 'Trạng thái đơn hàng (Đặt hàng SOS)'.'Chờ xác nhận',
                                                ('Trạng thái duyệt giá' = "Đã xác nhận" || IsBlank('Trạng thái duyệt giá')),
                                                IsBlank(Var_check_duyetgia)
                                            ),
                                            'Created On',
                                            SortOrder.Descending
                                        ),
                                        SelectedSP,
                                        false,
                                        'Phụ phí hoá đơn',
                                        0,
                                        P_ThanhTien,
                                        0,
                                        P_GiaSauCK,
                                        0,
                                        NgayGiao,
                                        DateAdd(
                                            Now(),
                                            var_leadtime_quanhuyen * 12,
                                            TimeUnit.Hours
                                        ),
                                        CaSP,
                                        If(var_Ca, 'Ca (Sale Order Details)'.'Ca sáng', 'Ca (Sale Order Details)'.'Ca chiều')
                                    )
                                );
                              PressedColor: =RGBA(116, 116, 116, 1)
                              SearchFields: =["Value"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(116, 192, 252, 1)
                              Size: =12
                              Tooltip: =
                              Width: =610
                              X: =667
                              Y: =cb_khach_hang_tam.Y
      - Container Header:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Height: =74
            Width: =1366
          Children:
            - IconFontAwesome1:
                Control: CodeComponent
                ComponentName: crdfd_CustomComponent.IconFontAwesome
                Properties:
                  Height: =59
                  Width: =31
                  X: =20
                  Y: =12
                  iconHtml: |-
                    ="<i class='fa-solid fa-cart-shopping' style='color: #04a1b3;'></i>"
                  iconSize: =45
            - IconBell:
                Control: CodeComponent
                ComponentName: crdfd_CustomComponent.IconFontAwesome
                Group: Group9
                Properties:
                  Height: =40
                  Width: =27
                  X: =1091
                  Y: =24
                  iconHtml: ="<i class='fa-regular fa-bell'></i>"
                  iconSize: =30
            - TextNameUser:
                Control: Text@0.0.51
                Group: Group9
                Properties:
                  Align: ='TextCanvas.Align'.Start
                  Font: =Font.'Open Sans'
                  Height: =73
                  Size: =20
                  Text: =User().FullName
                  VerticalAlign: =VerticalAlign.Middle
                  Weight: ='TextCanvas.Weight'.Regular
                  Width: =171
                  Wrap: =false
                  X: =1192
            - Dropdown1:
                Control: Classic/DropDown@2.3.1
                Properties:
                  BorderStyle: =BorderStyle.None
                  BorderThickness: =0
                  ChevronBackground: =
                  ChevronHoverBackground: =
                  Default: ="Duyệt đơn hàng"
                  FontWeight: =FontWeight.Bold
                  Height: =50
                  HoverBorderColor: =
                  HoverFill: =
                  Items: =Screen_Admin
                  Items.Value: =Screen
                  OnChange: |-
                    =Navigate(Dropdown1.Selected.Value,ScreenTransition.CoverRight);
                    Reset(Dropdown1)
                  PressedFill: =
                  SelectionFill: =RGBA(180, 214, 250, 1)
                  Size: =22
                  X: =79
                  Y: =5
            - TextNameUser_1:
                Control: Text@0.0.51
                Properties:
                  Align: ='TextCanvas.Align'.Start
                  Font: =Font.'Open Sans'
                  Height: =30
                  PaddingRight: =5
                  Size: =16
                  Text: ="V1.0.5"
                  VerticalAlign: =VerticalAlign.Middle
                  Weight: ='TextCanvas.Weight'.Regular
                  Width: =100
                  Wrap: =false
                  X: =93
                  Y: =44
            - Avatar1:
                Control: Avatar@1.0.40
                Group: Group9
                Properties:
                  Appearance: ='Avatar.Appearance'.Brand
                  Height: =50
                  Shape: ='Avatar.Shape'.Circular
                  Width: =50
                  X: =1130
                  Y: =11
      - C_showPopupPromotionOrder_2:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(189, 189, 189, 0.67)
            Height: =768
            Visible: =Popup_PromotionOrder
            Width: =1366
          Children:
            - Nền_3:
                Control: Classic/Button@2.2.0
                Group: Add promotion Order_1
                Properties:
                  DisplayMode: =DisplayMode.View
                  Fill: =RGBA(255, 255, 255, 0.95)
                  Height: =234
                  RadiusBottomLeft: =30
                  RadiusBottomRight: =30
                  RadiusTopLeft: =30
                  RadiusTopRight: =30
                  Text: =
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  Width: =556
                  X: =387
                  Y: =267
            - bt_huy_3:
                Control: Button@0.0.45
                Group: Add promotion Order_1
                Properties:
                  Appearance: =
                  BasePaletteColor: =RGBA(189, 178, 176, 1)
                  BorderRadius: =10
                  Font: =Font.Arial
                  FontSize: =16
                  FontWeight: =FontWeight.Semibold
                  Height: =40
                  OnSelect: |-
                    =UpdateContext({Popup_PromotionOrder:false});
                    Reset(Combobox_PromotionOrder_2);
                  Text: ="Huỷ"
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  Width: =160
                  X: =713
                  Y: =428
            - Label_lydohuy_6:
                Control: Label@2.5.1
                Group: Add promotion Order_1
                Properties:
                  FontWeight: =FontWeight.Semibold
                  Height: =35
                  Size: =18
                  Text: ="Promotion Order"
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  Width: =500
                  X: =419
                  Y: =274
            - Combobox_PromotionOrder_2:
                Control: ComboBox@0.0.51
                Group: Add promotion Order_1
                Properties:
                  Font: =Font.Arial
                  FontSize: =18
                  FontWeight: =FontWeight.Normal
                  Height: =49
                  InputTextPlaceholder: ="Promotion Order"
                  IsSearchable: =false
                  Items: |-
                    =Filter(
                        Sort(
                            AddColumns(
                                Filter(
                                    Filter(
                                        ListFilterPromotion,
                                        crdfd_type = "Order"
                                    ),
                                    (cr1bb_chietkhau2 <> 'Chiết khấu 2 (Promotion)'.Yes || ((!IsBlank(
                                        First(
                                            Filter(
                                                var_table_SP,
                                                Text(Value) in crdfd_masanpham_multiple
                                            )
                                        )
                                    ) || !IsBlank(
                                        First(
                                            Filter(
                                                var_table_NSP,
                                                Text(Value) in cr1bb_manhomsp_multiple
                                            )
                                        )
                                    )))) && statecode = 'Status (Promotion)'.Active && (IsBlank(
                                        Concat(
                                            cr1bb_ieukhoanthanhtoanapdung,
                                            Value,
                                            ", "
                                        )
                                    ) || var_dieukhoanthanhtoan in Concat(
                                        cr1bb_ieukhoanthanhtoanapdung,
                                        Value,
                                        ", "
                                    ) && (!IsBlank(
                                        First(
                                            Filter(
                                                var_table_SP,
                                                Text(Value) in crdfd_masanpham_multiple
                                            )
                                        )
                                    ) || !IsBlank(
                                        First(
                                            Filter(
                                                var_table_NSP,
                                                Text(Value) in cr1bb_manhomsp_multiple
                                            )
                                        )
                                    ))) && (crdfd_name <> "Voucher sinh nhật" || var_sinhnhat) && (crdfd_name <> "Giảm giá đặc biệt_Khách hàng 3 tháng đặt lại hàng" || (var_last_order_date && var_check_promotion_SOD)) And (IsBlank(cr1bb_tongtienapdung) Or Total_Order >= cr1bb_tongtienapdung)
                                ),
                                NamePromotion,
                                crdfd_name,
                                ValuePromotion,
                                crdfd_value,
                                VND_Percent,
                                crdfd_vn,
                                DKTT,
                                Concat(
                                    cr1bb_ieukhoanthanhtoanapdung,
                                    Value,
                                    ", "
                                ),
                                Ma_SP,
                                crdfd_masanpham_multiple,
                                Ma_NSP,
                                cr1bb_manhomsp_multiple,
                                'Chiết khấu 2',
                                cr1bb_chietkhau2
                            ),
                            NamePromotion,
                            SortOrder.Ascending
                        ),
                        ('Chiết khấu 2' = 'Chiết khấu 2 (Promotion)'.No Or IsBlank('Chiết khấu 2')) Or ('Chiết khấu 2' = 'Chiết khấu 2 (Promotion)'.Yes And var_count_notIn_Promotions > 0)
                    )
                  OnChange: =
                  SelectMultiple: =true
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  Width: =468
                  X: =431
                  Y: =339
                Children:
                  - NamePromotion1_2:
                      Control: ComboBoxDataField@1.5.0
                      Variant: textualColumn
                      IsLocked: true
                      Properties:
                        FieldDisplayName: ="NamePromotion"
                        FieldName: ="NamePromotion"
                        FieldType: ="s"
                        Order: =1
            - Timer_Promotion_2:
                Control: Timer@2.1.0
                Group: Add promotion Order_1
                Properties:
                  AutoPause: =false
                  DisplayMode: =If(!IsBlank(Combobox_PromotionOrder_2.Selected), DisplayMode.Edit,DisplayMode.Disabled)
                  FontWeight: =FontWeight.Semibold
                  OnTimerEnd: |-
                    =UpdateContext({showLoading: false});
                    ForAll(
                        Combobox_PromotionOrder_2.SelectedItems As This,
                        Patch(
                            'Orders x Promotion',
                            Defaults('Orders x Promotion'),
                            {
                                Promotion: LookUp(Promotion,ID = This.crdfd_promotionid),
                                SO: Create_recordSO,
                                Type:"Order",
                                Loại: If(This.VND_Percent='VNĐ/% (Promotion)'.VNĐ,"Tiền","Phần trăm"),
                                'Chiết khấu':If(This.VND_Percent='VNĐ/% (Promotion)'.VNĐ,This.ValuePromotion,This.ValuePromotion/100)
                            }
                        )
                    );
                    Reset(Combobox_PromotionOrder_2);
                    Notify("Áp dụng thành công",NotificationType.Success,5000);
                    UpdateContext({Popup_PromotionOrder:false});
                  OnTimerStart: |-
                    =UpdateContext({showLoading: true});
                  RadiusBottomLeft: =15
                  RadiusBottomRight: =15
                  RadiusTopLeft: =15
                  RadiusTopRight: =15
                  Reset: =true
                  Size: =14
                  Start: =true
                  Text: =If(!IsBlank(Combobox_PromotionOrder_2.Selected) And showLoading ,Text(Time(0, 0, Round((Self.Duration - Self.Value) / 1000, 0)), "mm:ss"), "Xác nhận")
                  Visible: =CountIf(OrderxPromotion_Order,true) = 0
                  X: =448
                  Y: =428
