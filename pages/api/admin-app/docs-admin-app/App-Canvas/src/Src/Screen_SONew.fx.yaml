Screen_SONew As screen:
    ContentLanguage: =""
    Fill: =Color.White
    Height: =900//Max(App.Height, App.MinScreenHeight)
    LoadingSpinnerColor: =App.Theme.Colors.Primary
    OnHidden: =Set(is_Screen_SO_New,false);
    OnVisible: =Set(is_Screen_SO_New,true);

    ScreenContainer2 As groupContainer.horizontalAutoLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =RGBA(245, 245, 245, 1)
        Height: =826
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutGap: =12
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        LayoutWrap: =true
        PaddingBottom: =12
        PaddingLeft: =12
        PaddingRight: =12
        PaddingTop: =12
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =Parent.Width
        Y: =74
        ZIndex: =1

        LeftContainer1 As groupContainer.horizontalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            Fill: =RGBA(255, 255, 255, 1)
            FillPortions: =0
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =400
            LayoutMinWidth: =150
            LayoutMode: =LayoutMode.Auto
            LayoutOverflowY: =LayoutOverflow.Scroll
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Width: =600
            ZIndex: =1

            Container_Left As groupContainer.manualLayoutContainer:
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =1300
                LayoutMinWidth: =250
                ZIndex: =1

                Container_ThietlapSP As groupContainer.manualLayoutContainer:
                    Height: =1200
                    Width: =600
                    Y: =135
                    ZIndex: =1

                    TextCanvas_prmotion As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Promotion"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =Dropdown_Promotion.Visible
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =Parent.Width - 30
                        Wrap: =true
                        X: =15
                        Y: =NumberInput_SL.Y + NumberInput_SL.Height
                        ZIndex: =1

                    TextCanvas1_31 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =40
                        Size: =22
                        TabIndex: =0
                        Text: ="Thiết lập sản phẩm" 
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =500
                        Wrap: =true
                        X: =50
                        Y: =IconFontAwesome1_13.Y
                        ZIndex: =2

                    IconFontAwesome1_13 As IconFontAwesome:
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Height: =37
                        iconHtml: |-
                            ="<i class='fa-solid fa-gear' style='color: #04a1b3;'></i>"
                        iconSize: =30
                        OnChange: =false
                        TabIndex: =0
                        Tooltip: ="IconFontAwesome description"
                        Visible: =true
                        Width: =40
                        X: =10
                        Y: =10
                        ZIndex: =3

                    cb_SanPham_SO_New As combobox:
                        AccessibleLabel: =
                        BorderColor: =RGBA(202, 202, 202, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronDisabledBackground: =RGBA(166, 166, 166, 1)
                        ChevronDisabledFill: =RGBA(244, 244, 244, 1)
                        ChevronFill: =RGBA(0, 0, 0, 1)
                        ChevronHoverBackground: =RGBA(0, 0, 0, 1)
                        ChevronHoverFill: =RGBA(255, 255, 255, 1)
                        Color: =RGBA(77, 77, 77, 1)
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        DisabledFill: =RGBA(244, 244, 244, 1)
                        DisplayFields: =["crdfd_name"]
                        Height: =32
                        HoverColor: =RGBA(0, 0, 0, 1)
                        HoverFill: =RGBA(255, 255, 255, 1)
                        InputTextPlaceholder: ="Chọn sản phẩm"
                        Items: =List_Product
                        OnChange: =
                        PressedColor: =RGBA(116, 116, 116, 1)
                        PressedFill: =App.Theme.Colors.Darker30
                        SearchFields: =["crdfd_name"]
                        SearchItems: =Search(List_Product,cb_SanPham_SO_New.SearchText,'Tên sản phẩm')
                        SelectionFill: =RGBA(116, 192, 252, 1)
                        SelectMultiple: =false
                        Size: =12
                        Tooltip: =
                        Width: =Parent.Width - 30
                        X: =15
                        Y: =85
                        ZIndex: =4

                    TextCanvas_khachhang_4 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Sản phẩm"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =15
                        Y: =50
                        ZIndex: =5

                    Dropdown_DVT_new As Dropdown.pcfdataset:
                        AccessibleLabel: =""
                        Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                        BorderColor: =If(IsEmpty(var_list_gia_nhom),RGBA(184, 26, 28,1),RGBA(214, 221, 224, 1))
                        BorderRadius: =10
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ContentLanguage: =""
                        DefaultSelectedItems: =First(List_DVT)
                        DisplayMode: =DisplayMode.Edit
                        Fill: =RGBA(255, 255, 255, 1)
                        FontSize: =18
                        Height: =40
                        Items: =List_DVT
                        OnChange: =Reset(Dropdown_NhomGia_New)
                        Required: =false
                        TabIndex: =0
                        Tooltip: =""
                        ValidationState: ="None"
                        Visible: =true
                        Width: =280
                        X: =TextCanvas_DVT.X
                        Y: =158
                        ZIndex: =6

                        "'Đơn vị chuyển đổi-Transfome1' As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn":
                            FieldDisplayName: ="Đơn vị chuyển đổi-Transfome"
                            FieldName: ="crdfd_onvichuyenoitransfome"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =1

                    TextCanvas_DVT As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =If(IsEmpty(var_list_gia_nhom),RGBA(184, 26, 28,1),RGBA(45, 45, 45,1))
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: =If(!IsEmpty(var_list_gia_nhom) , "Đơn vị tính","Đơn vị tính """ & Dropdown_DVT_new.Selected.'Đơn vị chuyển đổi-Transfome' & """ chưa có giá!")
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =300
                        Wrap: =true
                        X: =15
                        Y: =123
                        ZIndex: =7

                    Dropdown_VAT_New As Dropdown.pcfdataset:
                        AccessibleLabel: =""
                        Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                        BorderColor: =RGBA(214, 221, 224, 1)
                        BorderRadius: =10
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ContentLanguage: =""
                        DefaultSelectedItems: |-
                            =[
                                If(
                                    var_selected_VAT_SO = VAT_choice.'Có VAT' And var_selected_SP.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)',
                                    Switch(
                                        var_selected_SP.GTGT,
                                        'GTGT (products)'.'10%',
                                        10,
                                        'GTGT (products)'.'8%',
                                        8,
                                        'GTGT (products)'.'5%',
                                        5,
                                        'GTGT (products)'.'0%',
                                        0
                                    ),
                                    If(
                                        var_selected_VAT_SO = VAT_choice.'Có VAT',
                                        Dropdown_NhomGia_New.Selected.GTGT * 100,
                                        0
                                    )
                                )
                            ]
                        DisplayMode: |-
                            =If(
                                var_selected_VAT_SO = VAT_choice.'Có VAT',
                                DisplayMode.Edit,
                                DisplayMode.View
                            )
                        Fill: =RGBA(255, 255, 255, 1)
                        FontSize: =18
                        Height: =40
                        Items: |-
                            =Sort(
                                If(
                                    var_selected_VAT_SO = VAT_choice.'Có VAT' And var_selected_SP.'Bản chất giá phát ra' = 'Bản chất giá phát ra (products)'.'Giá đã bao gồm VAT( VAT hỗ trợ)',
                                    Switch(
                                        var_selected_SP.GTGT,
                                        'GTGT (products)'.'10%',
                                        [10],
                                        'GTGT (products)'.'8%',
                                        [8],
                                        'GTGT (products)'.'5%',
                                        [5],
                                        'GTGT (products)'.'0%',
                                        [0]
                                    ),
                                    If(
                                        var_selected_VAT_SO = VAT_choice.'Có VAT',
                                        [
                                            10,
                                            8,
                                            0
                                        ],
                                        [0]
                                    )
                                ),
                                Value,
                                SortOrder.Descending
                            )
                        OnChange: =false
                        Required: =false
                        TabIndex: =0
                        Tooltip: =""
                        ValidationState: ="None"
                        Visible: =true
                        Width: =280
                        X: =307
                        Y: =158
                        ZIndex: =8

                        Value6 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                            FieldDisplayName: ="Value"
                            FieldName: ="Value"
                            FieldType: ="n"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =1

                    TextCanvas_khachhang_6 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Thuế VAT (%)" 
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =307
                        Y: =123
                        ZIndex: =9

                    TextCanvas_khachhang_7 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Số lượng"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =15
                        Y: =lbl_tonkhobomua_kt.Height + lbl_tonkhobomua_kt.Y
                        ZIndex: =10

                    txt_Gia_SONew As text:
                        Align: =Align.Right
                        BorderColor: =RGBA(219, 219, 219, 1)
                        Color: =RGBA(77, 77, 77, 1)
                        Default: =gia_duyet
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        DisabledFill: =RGBA(0, 0, 0, 0)
                        DisplayMode: |-
                            =If(
                                Checkbox_DuyetGiaSO.Checked,
                                If(
                                    dp_nhapthucong_theochietkhau_SO.Selected.Value = "Nhập thủ công",
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                ),
                                DisplayMode.Disabled
                            )
                        FocusedBorderThickness: =4
                        Font: =App.Theme.Font
                        Format: =TextFormat.Number
                        Height: =35
                        HintText: =""
                        HoverBorderColor: =RGBA(186, 202, 226, 1)
                        HoverColor: =RGBA(0, 0, 0, 1)
                        HoverFill: =RGBA(0, 0, 0, 0)
                        OnChange: |-
                            =UpdateContext({so_luong: txt_Gia_SONew.Text})
                        PressedFill: =
                        Visible: =!Dropdown_NhomGia_New.Visible
                        Width: =280
                        X: =307
                        Y: =NumberInput_SL.Y
                        ZIndex: =11

                    Dropdown_NhomGia_New As Dropdown.pcfdataset:
                        AccessibleLabel: =""
                        Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                        BorderColor: =RGBA(214, 221, 224, 1)
                        BorderRadius: =10
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ContentLanguage: =""
                        DefaultSelectedItems: =First(var_list_gia_nhom)
                        DisplayMode: =DisplayMode.Edit
                        Fill: =RGBA(255, 255, 255, 1)
                        FontSize: =18
                        Height: =40
                        Items: =var_list_gia_nhom
                        OnChange: =false
                        Required: =false
                        TabIndex: =0
                        Tooltip: =""
                        ValidationState: ="None"
                        Visible: |-
                            =If(
                                (Checkbox_DuyetGiaSUPSO.Checked And CountRows(var_duyetgiasup) > 0),
                                false,
                                !Checkbox_DuyetGiaSO.Checked,
                                true,
                                false
                            )
                        Width: =280
                        X: =307
                        Y: =NumberInput_SL.Y
                        ZIndex: =12

                        Gia_format1 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                            FieldDisplayName: ="Gia_format"
                            FieldName: ="Gia_format"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =1

                    TextCanvas_khachhang_8 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Giá " & Dropdown_NhomGia_New.Selected.'Nhóm đối tượng text'
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =307
                        Y: =TextCanvas_khachhang_7.Y
                        ZIndex: =13

                    "NumberInput_SL As 'Number input'":
                        AccessibleLabel: =""
                        Align: =""
                        Appearance: ='NumberInput.Appearance'.FilledLighter
                        BasePaletteColor: =
                        BorderColor: =RGBA(214, 221, 224, 1)
                        BorderRadius: =10
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ContentLanguage: =""
                        DelayOutput: =false
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        FontSize: =18
                        Height: =40
                        Min: =1
                        OnChange: =false
                        Precision: ='NumberInput.Precision'.'1'
                        Step: =1
                        TabIndex: =0
                        Tooltip: =""
                        ValidationState: ="None"
                        Value: =1
                        Visible: =true
                        Width: =280
                        X: =15
                        Y: =TextCanvas_khachhang_7.Height + TextCanvas_khachhang_7.Y
                        ZIndex: =14

                    Dropdown_Promotion As Dropdown.pcfdataset:
                        AccessibleLabel: =""
                        Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                        BorderColor: =RGBA(214, 221, 224, 1)
                        BorderRadius: =10
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ContentLanguage: =""
                        DefaultSelectedItems: |-
                            =If(
                                !IsBlank(var_selected_maSP) And !IsBlank(txt_Gia_SONew.Text) And !Checkbox_DuyetGiaSO.Checked And !Checkbox_DuyetGiaSUPSO.Checked And Dropdown_NhomGia_New.Selected.'Loại bỏ Promotion' = "No" And !Checkbox_LoaiBoPromotion.Checked,
                                First(ListPromotion),
                                First([])
                            )
                        DisplayMode: =If(!IsBlank(var_selected_maSP) And !IsBlank(txt_Gia_SONew.Text) And !Checkbox_DuyetGiaSO.Checked And !Checkbox_DuyetGiaSUPSO.Checked And Dropdown_NhomGia_New.Selected.'Loại bỏ Promotion' = "No", DisplayMode.Edit, DisplayMode.Disabled)
                        Fill: =RGBA(255, 255, 255, 1)
                        FontSize: =18
                        Height: =40
                        Items: =ListPromotion
                        OnChange: =false
                        Required: =false
                        TabIndex: =0
                        Tooltip: =""
                        ValidationState: ="None"
                        Visible: =true
                        Width: =Parent.Width - 130
                        X: =15
                        Y: =TextCanvas_prmotion.Y + TextCanvas_prmotion .Height
                        ZIndex: =15

                        NamePromotion2 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                            FieldDisplayName: ="NamePromotion"
                            FieldName: ="NamePromotion"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =1

                    Container_total As groupContainer.manualLayoutContainer:
                        BorderColor: =RGBA(240, 253, 246, 1)
                        BorderThickness: =0.5
                        DropShadow: =DropShadow.Light
                        Fill: =RGBA(240, 253, 244, 1)
                        Height: =161
                        RadiusBottomLeft: =10
                        RadiusBottomRight: =10
                        RadiusTopLeft: =10
                        RadiusTopRight: =10
                        Width: =570
                        X: =15
                        Y: =Dropdown_Promotion.Height + Dropdown_Promotion.Y + 20
                        ZIndex: =16

                        TextCanvas_khachhang_10 As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =5
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="Chiết khấu:"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Medium
                            Width: =152
                            Wrap: =true
                            X: =0
                            Y: =0
                            ZIndex: =1

                        TextCanvas_KM As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="Giảm: " & If(
                                    dp_nhapthucong_theochietkhau_SO.Selected.Value = "Theo chiết khấu",
                                    Text(gia_theochietkhau * dp_theochietkhau_SO.Selected.Value/100,"#,### đ"),
                                    If(
                                        var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ,
                                        Text(
                                            Value_Promotion,
                                            "#,###"
                                        ) & " + " & Value_Promtion_Muakem,
                                        Text(Value_Promotion) & "%" & " + " & Value_Promtion_Muakem & "%"
                                    )
                                )
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =!IsBlank(cb_SanPham_SO_New.Selected)
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =380
                            Wrap: =true
                            X: =97
                            Y: =0
                            ZIndex: =2

                        TextCanvas_khachhang_12 As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =5
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="Giá sau giảm: "
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Medium
                            Width: =152
                            Wrap: =true
                            X: =0
                            Y: =30
                            ZIndex: =3

                        TextCanvas_GiaSauGiam As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =5
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                =With(
                                    {
                                        Gia: If(
                                            dp_nhapthucong_theochietkhau_SO.Selected.Value = "Theo chiết khấu",
                                            gia_theochietkhau,
                                            Value(txt_Gia_SONew.Text)
                                        )
                                    },
                                    Text(
                                        If(
                                            cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT',
                                            // Nếu có xuất hóa đơn và không VAT → áp thêm 1.5%
                                            If(
                                                var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And Gia > 0,
                                                (Gia - Value_Promotion - Value_Promtion_Muakem) * 1.015,
                                                (Gia * (1 - (Value_Promotion + Value_Promtion_Muakem) / 100)) * 1.015
                                            ),
                                        // Nếu không khớp điều kiện trên → không cộng VAT
                                            If(
                                                var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And Gia > 0,
                                                Gia - Value_Promotion - Value_Promtion_Muakem,
                                                Gia * (1 - (Value_Promotion + Value_Promtion_Muakem) / 100)
                                            )
                                        ),
                                        "#,###"
                                    )
                                )
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =!IsBlank(cb_SanPham_SO_New.Selected)
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =464
                            Wrap: =true
                            X: =106
                            Y: =30
                            ZIndex: =4

                        TextCanvas_khachhang_14 As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =5
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="Thành tiền:"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Medium
                            Width: =152
                            Wrap: =true
                            X: =0
                            Y: =60
                            ZIndex: =5

                        TextCanvas_ThanhTien As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =3
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |
                                =If(
                                    var_Nganh_nghe = "Shop",
                                    Text(
                                        NumberInput_SL.Value * (Value(TextCanvas_GiaSauGiam.Text)),
                                        "#,###"
                                    ),
                                    Text(
                                        NumberInput_SL.Value * Value(txt_Gia_SONew.Text),
                                        "#,###"
                                    )
                                )
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =!IsBlank(cb_SanPham_SO_New.Selected)
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =464
                            Wrap: =true
                            X: =94
                            Y: =60
                            ZIndex: =6

                        TextCanvas_khachhang_16 As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingLeft: =5
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="VAT(" & var_selected_VAT & "%):"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Medium
                            Width: =152
                            Wrap: =true
                            X: =0
                            Y: =90
                            ZIndex: =7

                        TextCanvas_GiaVAT As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingTop: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                =If(
                                    var_selected_VAT = 0,
                                    "0",
                                    Text(
                                        Value(TextCanvas_ThanhTien.Text) * (var_selected_VAT / 100),
                                        "#,###"
                                    )
                                )
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =!IsBlank(cb_SanPham_SO_New.Selected)
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =464
                            Wrap: =true
                            X: =91
                            Y: =90
                            ZIndex: =8

                        TextCanvas_TongTien_SONew As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =30
                            PaddingBottom: =5
                            PaddingLeft: =5
                            Size: =16
                            TabIndex: =0
                            Text: |-
                                ="Tổng tiền: "
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =100
                            Wrap: =true
                            X: =0
                            Y: =130
                            ZIndex: =9

                        Rectangle4 As rectangle:
                            BorderColor: =App.Theme.Colors.Darker40
                            Fill: =RGBA(166, 215, 153, 1)
                            Height: =1
                            Width: =Parent.Width - 30
                            X: =Parent.X
                            Y: =125
                            ZIndex: =10

                        TextCanvas_TongTien_SO As Text:
                            BorderColor: =
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =RGBA(45, 128, 40, 1)
                            Height: =30
                            Size: =16
                            Text: |-
                                =Text(TextCanvas_ThanhTien.Text + TextCanvas_GiaVAT.Text, "#,###")
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =!IsBlank(cb_SanPham_SO_New.Selected)
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =200
                            X: =95
                            Y: =128
                            ZIndex: =12

                    Container_Setup_Duyet As groupContainer.manualLayoutContainer:
                        Height: =541
                        RadiusBottomLeft: =4
                        RadiusBottomRight: =4
                        RadiusTopLeft: =4
                        RadiusTopRight: =4
                        Width: =600
                        Y: =Container_total.Y + Container_total.Height
                        ZIndex: =17

                        TextCanvas_Option As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =40
                            Size: =16
                            TabIndex: =0
                            Text: ="Option"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =100
                            Wrap: =true
                            X: =145
                            Y: =252
                            ZIndex: =1

                        TextCanvas_ngaygiao_SO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Ngày giao hàng"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =15
                            Y: =10
                            ZIndex: =3

                        Dropdown_CaGiaoSO As Dropdown.pcfdataset:
                            AccessibleLabel: =""
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            ContentLanguage: =""
                            DefaultSelectedItems: |-
                                =If(var_Ca, {Ca:"Ca sáng"}, {Ca: "Ca chiều"})
                            DisplayMode: =If(var_Nganh_nghe = "Shop" And !(cb_donhang_SO_new.Selected.'Mã Đơn Hàng'), DisplayMode.Edit,DisplayMode.Disabled)
                            Fill: =RGBA(255, 255, 255, 1)
                            FontSize: =18
                            Height: =40
                            Items: =colCa
                            OnChange: =false
                            Required: =false
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =true
                            Width: =280
                            X: =307
                            Y: =45
                            ZIndex: =4

                            Ca2 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                                FieldDisplayName: ="Ca"
                                FieldName: ="Ca"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =1
                                ZIndex: =1

                        TextCanvas_cagiaohang_SO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Ca giao hàng"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =305
                            Y: =10
                            ZIndex: =5

                        TextCanvas_KenhtiepnhanSO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Kênh tiếp nhận"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =15
                            Y: =89
                            ZIndex: =6

                        Dropdown_KhoDapUngSO As Dropdown.pcfdataset:
                            AccessibleLabel: =""
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            ContentLanguage: =""
                            DefaultSelectedItems: =LookUp(var_filterkho,'Tên kho' =First([var_MultiChoiceKho.'Vị trí kho'.'Tên kho']).Value)
                            DisplayMode: =DisplayMode.Edit
                            Fill: =RGBA(255, 255, 255, 1)
                            FontSize: =18
                            Height: =40
                            Items: =var_filterkho
                            OnChange: =false
                            Required: =false
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =true
                            Width: =280
                            X: =307
                            Y: =124
                            ZIndex: =7

                            crdfd_name1 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                                FieldDisplayName: ="crdfd_name"
                                FieldName: ="crdfd_name"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =1
                                ZIndex: =1

                        TextCanvas_KhodapungSO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Kho đáp ứng"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =307
                            Y: =89
                            ZIndex: =8

                        "DatePicker_NgayGiaoSO As 'Date picker'":
                            AccessibleLabel: =""
                            Appearance: ='DatePickerCanvas.Appearance'.Outline
                            BasePaletteColor: =
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DateTimeZone: ="Local"
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontSize: =18
                            FontStrikethrough: =false
                            FontUnderline: =false
                            FontWeight: =""
                            Format: ="dd/mm/yyyy"
                            Height: =40
                            IsEditable: =false
                            OnChange: |-
                                =If(
                                    var_Nganh_nghe = "Shop",
                                    If(
                                        DateValue(DatePicker_NgayGiaoSO.SelectedDate) < DateValue(ngay_giao),
                                        Notify(
                                            "Ngày giao dự kiến không hợp lệ!!!",
                                            NotificationType.Warning,
                                            1000
                                        );
                                        Reset(DatePicker_NgayGiaoSO)
                                    ),
                                    If(
                                        DatePicker_NgayGiaoSO.SelectedDate < Max(
                                            formData_new,
                                            'Ngày giao'
                                        ) || (DatePicker_NgayGiaoSO.SelectedDate = Today() && Hour(Now()) >= 15),
                                        Notify(
                                            "Ngày giao dự kiến không hợp lệ",
                                            NotificationType.Warning,
                                            1000
                                        );
                                        Reset(DatePicker_NgayGiaoSO),
                                        UpdateIf(
                                            formData_new,
                                            true,
                                            {'Ngày giao': DateValue(DatePicker_NgayGiaoSO.SelectedDate)}
                                        )
                                    )
                                )
                            Placeholder: ="Chọn ngày..."
                            Required: =false
                            SelectedDate: |-
                                =If(
                                    var_Nganh_nghe = "Shop",
                                    ngay_giao,
                                    If(
                                        Hour(Now()) >= 15,
                                        DateAdd(
                                            Today(),
                                            1
                                        ),
                                        Today()
                                    )
                                )
                            StartOfWeek: ="Sunday"
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =true
                            Width: =280
                            X: =15
                            Y: =45
                            ZIndex: =9

                        Dropdown_KenhTiepNhanSO As Dropdown.pcfdataset:
                            AccessibleLabel: =""
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            ContentLanguage: =""
                            DefaultSelectedItems: =//[If(!IsBlank(var_KenhTiepNhan), var_KenhTiepNhan, First(Choices(Sale_Orders.'Kênh tiếp nhận')).Value)]
                            DisplayMode: =If(var_Nganh_nghe = "Shop" And !(cb_donhang_SO_new.Selected.'Mã Đơn Hàng'), DisplayMode.Edit,DisplayMode.Disabled)
                            Fill: =RGBA(255, 255, 255, 1)
                            FontSize: =18
                            Height: =40
                            Items: =Choices(Sale_Orders.'Kênh tiếp nhận')
                            OnChange: |-
                                =//UpdateContext({var_kenhtiepnhan_isSelected: true});
                            Required: =false
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =false
                            Width: =280
                            X: =15
                            Y: =124
                            ZIndex: =10

                            Value8 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                                FieldDisplayName: ="Value"
                                FieldName: ="Value"
                                FieldType: ="l"
                                FieldVariantName: ="textualColumn"
                                Order: =1
                                ZIndex: =1

                        TextCanvas_nguoiduyetSO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Người duyệt"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =15
                            Y: =164
                            ZIndex: =11

                        Dropdown_NguoiDuyetSO As Dropdown.pcfdataset:
                            AccessibleLabel: =""
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            ContentLanguage: =""
                            DefaultSelectedItems: |-
                                =If(
                                    Checkbox_DuyetGiaSO.Checked Or Checkbox_DuyetGiaSUPSO.Checked,
                                    If(
                                        var_Nganh_nghe = "Shop",
                                        If(
                                            !IsBlank(First(var_duyetgiasup).'Người duyệt'.Name) And Checkbox_DuyetGiaSUPSO.Checked,
                                            [First(var_duyetgiasup).'Người duyệt'.Name],
                                            ["Lê Thị Ngọc Anh"]
                                        ),
                                        ["Phạm Thị Mỹ Hương"]
                                    ),
                                    []
                                )
                            DisplayMode: =DisplayMode.Edit
                            Fill: =RGBA(255, 255, 255, 1)
                            FontSize: =18
                            Height: =40
                            Items: =var_table_supduyet
                            OnChange: =false
                            Required: =false
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =true
                            Width: =570
                            X: =15
                            Y: =199
                            ZIndex: =12

                            Value7 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                                FieldDisplayName: ="Value"
                                FieldName: ="Value"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =1
                                ZIndex: =1

                        Checkbox_DuyetGiaSO As Checkbox:
                            AccessibleLabel: =""
                            BasePaletteColor: =
                            CheckboxSize: =16
                            Checked: =false
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontSize: =16
                            FontStrikethrough: =false
                            FontUnderline: =false
                            FontWeight: =FontWeight.Normal
                            Height: =40
                            Label: ="Duyệt giá"
                            OnCheck: =Reset(dp_theochietkhau_SO);
                            OnSelect: =false
                            OnUncheck: |-
                                =Reset(dp_nhapthucong_theochietkhau_SO);
                                Reset(dp_theochietkhau_SO);
                            TabIndex: =0
                            Tooltip: =""
                            Visible: =true
                            Width: =130
                            X: =15
                            Y: =252
                            ZIndex: =13

                        Checkbox_DuyetGiaSUPSO As Checkbox:
                            AccessibleLabel: =""
                            BasePaletteColor: =
                            CheckboxSize: =16
                            Checked: =false
                            ContentLanguage: =""
                            DisplayMode: |-
                                =If(
                                    CountRows(var_duyetgiasup) > 0,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontSize: =16
                            FontStrikethrough: =false
                            FontUnderline: =false
                            FontWeight: =FontWeight.Normal
                            Height: =40
                            Label: ="Duyệt giá Supervisor"
                            OnCheck: =
                            OnSelect: =false
                            OnUncheck: =false
                            TabIndex: =0
                            Tooltip: =""
                            Visible: =true
                            Width: =210
                            X: =15
                            Y: =299
                            ZIndex: =14

                        Checkbox_DonHangGap As Checkbox:
                            AccessibleLabel: =""
                            BasePaletteColor: =
                            CheckboxSize: =16
                            Checked: =false
                            ContentLanguage: =""
                            DisplayMode: |
                                = If(
                                    NumberInput_SL.Value * var_selected_donvi.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)' <= Var_ton_kho_lythuyet_bomua,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontSize: =16
                            FontStrikethrough: =false
                            FontUnderline: =false
                            FontWeight: =FontWeight.Normal
                            Height: =40
                            Label: ="Đơn hàng gấp"
                            OnCheck: =false
                            OnSelect: =false
                            OnUncheck: =false
                            TabIndex: =0
                            Tooltip: =""
                            Visible: =true
                            Width: =160
                            X: =222
                            Y: =299
                            ZIndex: =15

                        TextCanvas_ghichuSO As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =35
                            Size: =16
                            TabIndex: =0
                            Text: ="Ghi chú"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =225
                            Wrap: =true
                            X: =15
                            Y: =338
                            ZIndex: =16

                        Button_ThemGioHangSO As button:
                            BorderColor: =RGBA(16, 185, 129, 1)
                            Color: =App.Theme.Colors.PrimaryForeground
                            DisabledBorderColor: =RGBA(244, 244, 244, 1)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            DisplayMode: =If(!IsEmpty(var_list_gia_nhom) And !var_warning_gia.value,DisplayMode.Edit,DisplayMode.Disabled)
                            Fill: =RGBA(16,185,129,1)
                            Font: =App.Theme.Font
                            FontWeight: =FontWeight.Bold
                            Height: =50
                            HoverBorderColor: =
                            HoverColor: =App.Theme.Colors.PrimaryForeground
                            HoverFill: =
                            OnSelect: |-
                                =If(
                                    !IsBlank(var_selected_maSP) And !IsBlank(var_selected_donvi.'Đơn vị chuyển đổi-Transfome') And !IsBlank(NumberInput_SL.Value) And !IsBlank(txt_Gia_SONew.Text) Or (Dropdown_NguoiDuyetSO.Selected.Value And Dropdown_NguoiDuyetSO.Selected.Value),
                                    UpdateIf(
                                        formData_new,
                                        ThisRecord.PromotionRecord.'Promotion type (text)' = var_selected_Promotion.TypePromotion && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes && (IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng') || var_cong_don + var_input_soluong >= ThisRecord.PromotionRecord.'Số lượng áp dụng'),
                                        With(
                                            {
                                                giamgia: If(
                                                    !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') && var_cong_don + var_input_soluong >= ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' And (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3' = var_selected_dieukhoanthanhtoan_choice),
                                                    ThisRecord.PromotionRecord.'Value 3',
                                                    If(
                                                        (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2' = var_selected_dieukhoanthanhtoan_choice),
                                                        ThisRecord.PromotionRecord.'Value 2',
                                                        ThisRecord.PromotionRecord.Value
                                                    )
                                                ),
                                                Value_muakem: If(
                                                    !IsBlank(ThisRecord.PromotionRecord.'Value mua kèm') && (IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') || ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' > var_input_soluong),
                                                    ThisRecord.PromotionRecord.'Value mua kèm',
                                                    0
                                                ),
                                                Record: ThisRecord
                                            },
                                            With(
                                                {
                                                    PPHD: If(
                                                        cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT',
                                                        1.015,
                                                        1
                                                    ),
                                                    Gia_da_chietkhau: If(
                                                        Record.PromotionRecord.'VNĐ/% Text' = "VNĐ",
                                                        Record.Giá - (giamgia+Value_muakem),
                                                        Record.Giá * (1 - (giamgia + Value_muakem) / 100)
                                                    )
                                                },
                                                {
                                                    '% Giảm giá': If(
                                                        var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%',
                                                        (giamgia + Value_muakem) / 100,
                                                        giamgia + Value_muakem
                                                    ),
                                                    'Giá đã giảm': Gia_da_chietkhau * PPHD,
                                                    'Tổng tiền': (Record.'Số lượng' * Gia_da_chietkhau * PPHD) + Record.VAT,
                                                    Chietkhauphantram: If(
                                                        var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%' && var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                                        (giamgia + Value_muakem) / 100,
                                                        0
                                                    ),
                                                    Chietkhautien: If(
                                                        var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ && var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                                        (giamgia + Value_muakem),
                                                        0
                                                    )
                                                }
                                            )
                                        )
                                    );
                                    UpdateIf(
                                        formData_new,
                                        var_count_thiet_bi_nuoc >= 200000000,
                                        {'Ngày giao': DateValue(DatePicker_NgayGiaoSO.SelectedDate)}
                                    );
                                    Collect(
                                        formData_new,
                                        {
                                            IDform: GUID(),
                                            'Tên sản phẩm': var_selected_SP.'Tên sản phẩm',
                                            'Mã sản phẩm': var_selected_SP.'Mã sản phẩm',
                                            'Record sản phẩm': var_selected_SP,
                                            'Mã nhóm SP': var_selected_manhomSP,
                                            'Số lượng': Value(NumberInput_SL.Value),
                                            'Đơn vị': var_selected_donvi.'Đơn vị chuyển đổi-Transfome',
                                            'Record Đơn vị': var_selected_donvi,
                                            Giá: Value(txt_Gia_SONew.Text),
                                            'Giá đã giảm': If(
                                                Value(txt_Gia_SONew.Text) = 0,
                                                0,
                                                Value(TextCanvas_GiaSauGiam.Text)
                                            ),
                                            '% Giảm giá': If(
                                                var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ,
                                                Value_Promotion + Value_Promtion_Muakem,
                                                (Value_Promotion + Value_Promtion_Muakem) / 100
                                            ),
                                            'Thành Tiền': Value(TextCanvas_ThanhTien.Text),
                                            'Tổng tiền': Value(TextCanvas_TongTien_SO.Text),
                                            VAT: Dropdown_VAT_New.Selected.Value,
                                            GTGT: Value(TextCanvas_GiaVAT.Text),
                                            'Ngày giao': DateValue(DatePicker_NgayGiaoSO.SelectedDate),
                                            Ca: Dropdown_CaGiaoSO.Selected.Ca,
                                            'Ngày giao NM': DateValue(DatePicker_NgayGiaoSO.SelectedDate),
                                            MaDH: cb_donhang_SO_new.Selected.'Mã Đơn Hàng',
                                            STT: If(
                                                Max(
                                                    formData_new,
                                                    STT
                                                ) = 0,
                                                1,
                                                Max(
                                                    formData_new,
                                                    STT
                                                ) + 1
                                            ),
                                            GhiChu: TextInput_GhiChuSO.Text,
                                            duyet_gia: Dropdown_NguoiDuyetSO.Selected.Value,
                                            DonhangGap: Checkbox_DonHangGap.Checked,
                                            Chietkhauphantram: If(
                                                var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.'%' And var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                                (Value_Promotion + Value_Promtion_Muakem) / 100,
                                                0
                                            ),
                                            Chietkhautien: If(
                                                var_selected_Promotion.VND_Percent = 'VNĐ/% (Promotion)'.VNĐ And var_selected_khachhang.'Ngành nghề' = 'Ngành nghề mới'.Shop,
                                                Value_Promotion + Value_Promtion_Muakem,
                                                0
                                            ),
                                            promotiontext: If(
                                                var_Nganh_nghe = "Shop",
                                                var_selected_Promotion.NamePromotion
                                            ),
                                            PromotionRecord: LookUp(
                                                Promotion,
                                                ID = var_selected_Promotion.crdfd_promotionid
                                            ),
                                            id_duyetgiaSUP: First(var_duyetgiasup).ID,
                                            'Kho đáp ứng': LookUp(
                                                TanSuatKho,
                                                TênSảnPhẩm = var_selected_SP.'Tên sản phẩm',
                                                Kho
                                            ),
                                            DKTT: var_selected_Promotion.DKTT,
                                            Createdon: Now(),
                                            'Phụ phí hoá đơn': If(
                                                cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT' And var_Nganh_nghe = "Shop",
                                                0.015,
                                                0
                                            )
                                        }
                                    );
                                    If(
                                        var_Nganh_nghe = "Shop",
                                        UpdateIf(
                                            Filter(
                                                formData_new,
                                                'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị nước" || 'Record sản phẩm'.'Cấp 4' = "Ống cứng PVC"
                                            ),
                                            ((var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000) || var_sum_ong_cung >= 100000000),
                                            {
                                                'Ngày giao': DateAdd(
                                                    DateTimeValue(ngay_giao),
                                                    If(
                                                        var_sum_thiet_bi_nuoc >= 200000000 || var_sum_ong_cung >= 200000000,
                                                        24,
                                                        12
                                                    ),
                                                    TimeUnit.Hours
                                                ),
                                                Ca: If(
                                                    Hour(
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao),
                                                            If(
                                                                (var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 200000000) || var_sum_ong_cung >= 200000000,
                                                                24,
                                                                12
                                                            ),
                                                            TimeUnit.Hours
                                                        )
                                                    ) <= 12,
                                                    'Ca (SOD báo giá)'.'Ca sáng',
                                                    'Ca (SOD báo giá)'.'Ca chiều'
                                                )
                                            }
                                        );
                                        UpdateIf(
                                            Filter(
                                                formData_new,
                                                'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị điện"
                                            ),
                                            var_sum_thiet_bi_dien >= 200000000,
                                            {
                                                'Ngày giao': DateAdd(
                                                    DateTimeValue(ngay_giao),
                                                    12,
                                                    TimeUnit.Hours
                                                ),
                                                Ca: If(
                                                    Hour(
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao),
                                                            12,
                                                            TimeUnit.Hours
                                                        )
                                                    ) >= 0 && Hour(
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao),
                                                            12,
                                                            TimeUnit.Hours
                                                        )
                                                    ) <= 12,
                                                    'Ca (SOD báo giá)'.'Ca sáng',
                                                    'Ca (SOD báo giá)'.'Ca chiều'
                                                )
                                            }
                                        );
                                        UpdateIf(
                                            Filter(
                                                formData_new,
                                                'Record sản phẩm'.'Cấp 2 NHSP' = "Vật tư kim khí"
                                            ),
                                            var_count_kim_khi >= 100,
                                            {
                                                'Ngày giao': DateAdd(
                                                    DateTimeValue(ngay_giao),
                                                    12,
                                                    TimeUnit.Hours
                                                ),
                                                Ca: If(
                                                    Hour(
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao),
                                                            12,
                                                            TimeUnit.Hours
                                                        )
                                                    ) >= 0 && Hour(
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao),
                                                            12,
                                                            TimeUnit.Hours
                                                        )
                                                    ) <= 12,
                                                    'Ca (SOD báo giá)'.'Ca sáng',
                                                    'Ca (SOD báo giá)'.'Ca chiều'
                                                )
                                            }
                                        );
                                    );
                                    Reset(cb_SanPham_SO_New);
                                    Reset(Dropdown_DVT_new);
                                    Reset(NumberInput_SL);
                                    Reset(txt_Gia_SONew);
                                    Reset(Dropdown_VAT_New);
                                    Reset(Dropdown_NguoiDuyetSO);
                                    Reset(DatePicker_NgayGiaoSO);
                                    Reset(Checkbox_DonHangGap);
                                    Reset(Checkbox_DuyetGiaSUPSO);
                                    Reset(Dropdown_Promotion);
                                    Reset(Checkbox_DuyetGiaSO);
                                    Reset(Dropdown_KhoDapUngSO);
                                    Reset(Dropdown_KenhTiepNhanSO);
                                    Reset(dp_nhapthucong_theochietkhau_SO);
                                    Reset(Checkbox_LoaiBoPromotion);
                                    //Set(
                                    //    var_kenhtiepnhan_isSelected,
                                    //    false
                                    //);
                                    ,
                                    Notify(
                                        "Vui lòng điền đầy đủ thông tin!!",
                                        NotificationType.Warning,
                                        1000
                                    );
                                    
                                );
                                Clear(TanSuatKho);
                                ForAll(
                                    formData_new As ColData,
                                    ForAll(
                                        var_filterkho As Kho,
                                        If(
                                            CountRows(
                                                Filter(
                                                    'Kho Bình Định',
                                                    'Vị trí kho'.'Tên kho' = Kho.'Tên kho' && 'Tên sản phẩm'.'Tên sản phẩm' = ColData.'Tên sản phẩm' && 'Tồn kho lý thuyết - Bỏ mua' >= ColData.'Số lượng'
                                                )
                                            ) > 0,
                                            Collect(
                                                TanSuatKho,
                                                {
                                                    TênSảnPhẩm: ColData.'Tên sản phẩm',
                                                    SốLượng: ColData.'Số lượng',
                                                    Kho: Kho.'Tên kho'
                                                }
                                            )
                                        )
                                    )
                                );
                                With(
                                    {tempData: formData_new},
                                    ForAll(
                                        tempData As ColData,
                                        Patch(
                                            formData_new,
                                            LookUp(
                                                formData_new,
                                                'Tên sản phẩm' = ColData.'Tên sản phẩm'
                                            ),
                                            {
                                                'Kho đáp ứng': LookUp(
                                                    TanSuatKho,
                                                    TênSảnPhẩm = ColData.'Tên sản phẩm',
                                                    Kho
                                                )
                                            }
                                        )
                                    )
                                );
                                Reset(Dropdown_CaGiaoSO);
                            PressedBorderColor: =
                            PressedColor: =Self.Color
                            PressedFill: =RGBA(16, 143, 100, 1)
                            Size: =14
                            Text: ="Thêm vào giỏ hàng"
                            Width: =577
                            X: =10
                            Y: =452
                            ZIndex: =18

                        IconFontAwesome_ThemGioHangSO As IconFontAwesome:
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Height: =26
                            iconHtml: |-
                                ="<i class='fa-solid fa-check' style='color: #ffffff;'></i>"
                            iconSize: =30
                            OnChange: =false
                            TabIndex: =0
                            Tooltip: ="IconFontAwesome description"
                            Visible: =true
                            Width: =35
                            X: =Button_ThemGioHangSO.X + 170
                            Y: =Button_ThemGioHangSO.Y + 10
                            ZIndex: =19

                        dp_nhapthucong_theochietkhau_SO As Dropdown.pcfdataset:
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            DefaultSelectedItems: =First(var_choice_nhapthucong_theochietkhau)
                            DisplayMode: =If(Checkbox_DuyetGiaSO.Checked, DisplayMode.Edit, DisplayMode.Disabled)
                            FontSize: =18
                            Height: =40
                            Items: =var_choice_nhapthucong_theochietkhau
                            OnChange: |-
                                =Reset(dp_theochietkhau_SO);
                                Reset(txt_Gia_SONew);
                            Visible: =true
                            Width: =180
                            X: =208
                            Y: =252
                            ZIndex: =20

                        dp_theochietkhau_SO As Dropdown.pcfdataset:
                            AccessibleLabel: =""
                            Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                            BorderColor: =RGBA(214, 221, 224, 1)
                            BorderRadius: =10
                            BorderStyle: =BorderStyle.Solid
                            BorderThickness: =1
                            ContentLanguage: =""
                            DefaultSelectedItems: =["1"]
                            DisplayMode: =If(dp_nhapthucong_theochietkhau_SO.Selected.Value = "Theo chiết khấu", DisplayMode.Edit, DisplayMode.Disabled)
                            FontSize: =18
                            Height: =40
                            Items: =var_choice_theochietkhau
                            OnChange: =false
                            Required: =false
                            TabIndex: =0
                            Tooltip: =""
                            ValidationState: ="None"
                            Visible: =true
                            Width: =80
                            X: =499
                            Y: =252
                            ZIndex: =21

                        TextCanvas_Option_1 As Text:
                            Align: ="Start"
                            AutoHeight: =false
                            BorderColor: =
                            BorderStyle: =""
                            ContentLanguage: =""
                            DisplayMode: =DisplayMode.Edit
                            Fill: =
                            Font: =Font.'Open Sans'
                            FontColor: =
                            FontItalic: =false
                            FontStrikethrough: =false
                            FontUnderline: =false
                            Height: =40
                            Size: =16
                            TabIndex: =0
                            Text: ="Chiết khấu"
                            Tooltip: =""
                            VerticalAlign: =VerticalAlign.Middle
                            Visible: =true
                            Weight: ='TextCanvas.Weight'.Semibold
                            Width: =100
                            Wrap: =true
                            X: =402
                            Y: =252
                            ZIndex: =22

                        TextInput_GhiChuSO As text:
                            BorderColor: =RGBA(202, 202, 202, 1)
                            Color: =RGBA(255, 0, 0, 1)
                            Default: |-
                                =If(
                                    CountRows(var_list_gia_KH) = 1 And var_Nganh_nghe = "Shop",
                                    LookUp(
                                        var_list_gia_KH,
                                        'Mã KH' = var_MaKH
                                    ).'Ghi chú',
                                    If(Checkbox_DuyetGiaSO.Checked Or Checkbox_DuyetGiaSUPSO.Checked,"Duyệt giá bởi " &  Dropdown_NguoiDuyetSO.Selected.Value)
                                )
                            DisabledBorderColor: =RGBA(166, 166, 166, 1)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            Fill: =RGBA(241, 244, 249, 1)
                            FocusedBorderThickness: =4
                            Height: =61
                            HintText: ="Nhập ghi chú"
                            HoverBorderColor: =App.Theme.Colors.Darker40
                            HoverColor: =RGBA(0, 0, 0, 1)
                            HoverFill: =App.Theme.Colors.Lighter70
                            Mode: =TextMode.MultiLine
                            RadiusBottomLeft: =15
                            RadiusBottomRight: =15
                            RadiusTopLeft: =15
                            RadiusTopRight: =15
                            Width: =564
                            X: =15
                            Y: =376
                            ZIndex: =23

                    TextCanvas_tonkhobomua As Text:
                        BorderColor: =
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =true
                        Height: =20
                        Size: =13
                        Text: |
                            ="Tồn kho (bỏ mua): " & Coalesce(
                                Var_ton_kho_lythuyet_bomua,
                                0
                            ) & " " & var_selected_SP.'Đơn vị chuẩn text'
                        Weight: ='TextCanvas.Weight'.Regular
                        Width: =280
                        X: =15
                        Y: =Dropdown_DVT_new.Height + Dropdown_DVT_new.Y + 10
                        ZIndex: =18

                    TextCanvas_sltheokho As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =true
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =20
                        Size: =13
                        TabIndex: =0
                        Text: |-
                            ="SL theo kho: " & Text(NumberInput_SL.Value * var_selected_donvi.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)', "#,###.##") &" "& var_selected_SP.'Đơn vị chuẩn text'
                        Tooltip: =""
                        VerticalAlign: =""
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Regular
                        Width: =280
                        Wrap: =true
                        X: =308
                        Y: =Dropdown_DVT_new.Height + Dropdown_DVT_new.Y + 10
                        ZIndex: =19

                    Checkbox_LoaiBoPromotion As Checkbox:
                        BasePaletteColor: =
                        DisplayMode: =DisplayMode.Edit
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontSize: =14
                        Height: =36
                        Label: ="Loại bỏ Promotion"
                        OnCheck: =false
                        OnUncheck: =false
                        Width: =110
                        X: =481
                        Y: =357
                        ZIndex: =20

                    lb_warning_Gia_1 As label:
                        Align: =Align.Right
                        BorderColor: =App.Theme.Colors.Darker40
                        Color: =If(var_warning_gia.value,RGBA(255, 0, 0, 1),RGBA(0, 0, 0, 1))
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        Font: =App.Theme.Font
                        Height: =17
                        Italic: =true
                        PaddingRight: =0
                        Role: =
                        Size: =10
                        Text: =var_warning_gia.Label
                        Visible: =var_warning_gia.value
                        X: =435
                        Y: =266
                        ZIndex: =22

                    lbl_tonkhobomua_kt As label:
                        BorderColor: =App.Theme.Colors.Darker40
                        Color: =If(var_ton_kho_lythuyet_KT < var_input_soluong * var_selected_donvi.'Giá trị chuyển đổi (Chuyển đổi/chuẩn)',RGBA(255, 0, 0, 1),RGBA(0, 0, 0, 1))
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        Font: =App.Theme.Font
                        Height: =20
                        Italic: =true
                        PaddingLeft: =0
                        Size: =10
                        Text: |-
                            ="Tồn LT kế toán: " & Coalesce(var_ton_kho_lythuyet_KT,
                                0
                            ) & " " & cb_SanPham_SO_New.Selected.'Đơn vị chuẩn text'
                        Visible: =!IsBlank(cb_san_pham.Selected) And !IsBlank(var_ton_kho_lythuyet_KT)
                        Width: =170
                        X: =15
                        Y: =TextCanvas_tonkhobomua.Height + TextCanvas_tonkhobomua.Y
                        ZIndex: =23

                Container_Locdonhang_SO As groupContainer.manualLayoutContainer:
                    Fill: =RGBA(255, 255, 255, 1)
                    Height: =135
                    Width: =600
                    ZIndex: =2

                    TextCanvas1_26 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =40
                        Size: =22
                        TabIndex: =0
                        Text: ="Lọc đơn hàng" 
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =225
                        Wrap: =true
                        X: =50
                        Y: =IconFontAwesome1_12.Y
                        ZIndex: =1

                    IconFontAwesome1_12 As IconFontAwesome:
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Height: =37
                        iconHtml: |-
                            ="<i class='fa-solid fa-filter' style='color: #04a1b3;'></i>"
                        iconSize: =30
                        OnChange: =false
                        TabIndex: =0
                        Tooltip: ="IconFontAwesome description"
                        Visible: =true
                        Width: =40
                        X: =10
                        Y: =10
                        ZIndex: =2

                    TextCanvas_khachhang_2 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Chọn khách hàng"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =15
                        Y: =55
                        ZIndex: =3

                    TextCanvas_khachhang_3 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =35
                        Size: =16
                        TabIndex: =0
                        Text: ="Chọn mã đơn hàng"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =225
                        Wrap: =true
                        X: =307
                        Y: =TextCanvas_khachhang_2.Y
                        ZIndex: =4

                    cb_khach_hang_SO_new As combobox:
                        AccessibleLabel: =
                        BorderColor: =RGBA(202, 202, 202, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronDisabledBackground: =RGBA(166, 166, 166, 1)
                        ChevronDisabledFill: =RGBA(244, 244, 244, 1)
                        ChevronFill: =RGBA(0, 0, 0, 1)
                        ChevronHoverBackground: =RGBA(0, 0, 0, 1)
                        ChevronHoverFill: =RGBA(255, 255, 255, 1)
                        Color: =RGBA(77, 77, 77, 1)
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        DisabledFill: =RGBA(244, 244, 244, 1)
                        DisplayFields: =["crdfd_name"]
                        Height: =32
                        HoverColor: =RGBA(0, 0, 0, 1)
                        HoverFill: =RGBA(255, 255, 255, 1)
                        InputTextPlaceholder: ="Chọn khách hàng"
                        Items: =List_Customer
                        OnChange: |
                            =ClearCollect(
                                colCa,
                                {Ca: "Ca sáng"},
                                {Ca: "Ca chiều"}
                            );
                            Reset(cb_SanPham_SO_New);
                            Reset(Dropdown_DVT_new);
                            Reset(NumberInput_SL);
                            Reset(txt_Gia_SONew);
                            Reset(Dropdown_VAT_New);
                            Reset(Dropdown_NguoiDuyetSO);
                            Reset(DatePicker_NgayGiaoSO);
                            Reset(Checkbox_DonHangGap);
                            Reset(Checkbox_DuyetGiaSUPSO);
                            Reset(Dropdown_Promotion);
                            Reset(Checkbox_DuyetGiaSO);
                            Reset(Dropdown_KhoDapUngSO);
                            Reset(Dropdown_KenhTiepNhanSO);
                            Reset(dp_nhapthucong_theochietkhau_SO);
                        PressedColor: =RGBA(116, 116, 116, 1)
                        PressedFill: =App.Theme.Colors.Darker30
                        Reset: =true
                        SearchFields: =["crdfd_name"]
                        SearchItems: =Search(List_Customer,cb_khach_hang_SO_new.SearchText,'Customer name')
                        SelectionFill: =RGBA(116, 192, 252, 1)
                        SelectMultiple: =false
                        Size: =12
                        Tooltip: =
                        Width: =280
                        X: =15
                        Y: =TextCanvas_khachhang_2.Height + TextCanvas_khachhang_2.Y
                        ZIndex: =5

                    cb_donhang_SO_new As combobox:
                        AccessibleLabel: =
                        BorderColor: =RGBA(202, 202, 202, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronDisabledBackground: =RGBA(166, 166, 166, 1)
                        ChevronDisabledFill: =RGBA(244, 244, 244, 1)
                        ChevronFill: =RGBA(0, 0, 0, 1)
                        ChevronHoverBackground: =RGBA(0, 0, 0, 1)
                        ChevronHoverFill: =RGBA(255, 255, 255, 1)
                        Color: =RGBA(77, 77, 77, 1)
                        DefaultSelectedItems: =First(var_DHSO)
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        DisabledFill: =RGBA(244, 244, 244, 1)
                        DisplayFields: =["crdfd_name"]
                        Height: =32
                        HoverColor: =RGBA(0, 0, 0, 1)
                        HoverFill: =RGBA(255, 255, 255, 1)
                        InputTextPlaceholder: ="Chọn mã đơn hàng"
                        Items: |-
                            =Sort(
                                Filter(
                                    Sale_Orders,
                                    'Mã khách hàng' = var_MaKH,
                                    'Trạng thái giao nhận 1' = 'trạng thái giao nhận sale'.'Chưa giao',
                                    Status = 'Status (Sale_Orders)'.Active,
                                    'Active data' = 'Active data (Sale_Orders)'.Active
                                ),
                                'Created On',
                                SortOrder.Descending
                            )
                        OnChange: |
                            =Clear(formData_new);
                            If(
                                IsBlank(cb_khach_hang_SO_new.Selected),
                                [],
                                ForAll(
                                    var_SOD As itemSOD,
                                    With(
                                        {
                                            mappedApproval: LookUp(
                                                var_table_duyetgia,
                                                Value = itemSOD[@'Duyệt giá (crdfd_duyetgia)'],
                                                Name
                                            ),
                                            Promotion_Record: LookUp(
                                                Promotion,
                                                ID = itemSOD[@Promotion].ID
                                            )
                                        },
                                        Collect(
                                            formData_new,
                                            {
                                                STT: itemSOD[@'Stt đơn'],
                                                'ID đơn hàng': itemSOD[@Id],
                                                'Record SOD3': itemSOD,
                                                'Tên sản phẩm': itemSOD[@'Tên sản phẩm text'],
                                                'Mã sản phẩm': itemSOD[@'Mã sản phẩm'],
                                                'Mã nhóm SP': itemSOD[@'Mã nhóm sp'],
                                                'Record Đơn vị': itemSOD[@ID_Unit_Sp],
                                                'Record sản phẩm': itemSOD[@'Tên sản phẩm'],
                                                'Số lượng': itemSOD[@'Số lượng'],
                                                'Đơn vị': itemSOD[@ID_Unit_Sp].'Đơn vị chuyển đổi-Transfome',
                                                Giá: itemSOD[@'Giá gốc'],
                                                'Giá đã giảm': itemSOD[@Giá],
                                                '% Giảm giá': If(
                                                    itemSOD[@'Chiết khấu %'] > 0,
                                                    itemSOD[@'Chiết khấu %'],
                                                    itemSOD[@'Chiết khấu VNĐ']
                                                ),
                                                'Tổng tiền': With(
                                                    {
                                                        TotalExVAT: itemSOD[@'Tổng tiền chưa VAT'],
                                                        AdjustGTGT: Value(itemSOD[@'Điều chỉnh GTGT Text'])
                                                    },
                                                    TotalExVAT * (1 + If(
                                                        AdjustGTGT <> 0,
                                                        AdjustGTGT / 100,
                                                        0
                                                    ))
                                                ),
                                                VAT: Value(itemSOD[@'Điều chỉnh GTGT Text']),
                                                'Ngày giao': itemSOD[@'Ngày dự kiến giao'],
                                                Ca: If(
                                                    itemSOD[@Ca] = 283640000,
                                                    "Ca sáng",
                                                    "Ca chiều"
                                                ),
                                                'Ngày giao NM': itemSOD[@'Ngày dự kiến giao'],
                                                GhiChu: itemSOD[@'Ghi chú'],
                                                GTGT: itemSOD[@GTGT],
                                                Chietkhauphantram: itemSOD[@'Chiết khấu %'],
                                                Chietkhautien: itemSOD[@'Chiết khấu VNĐ'],
                                                promotiontext: itemSOD[@'Promotion text'],
                                                PromotionRecord: Promotion_Record,
                                                duyet_gia: mappedApproval,
                                                DKTT: Concat(
                                                    Promotion_Record.'Điều khoản thanh toán áp dụng',
                                                    Value,
                                                    ", "
                                                ),
                                                Createdon: itemSOD[@'Created On'],
                                                'Phụ phí hoá đơn': itemSOD[@'Phụ phí hoá đơn (%)']
                                            }
                                        )
                                    )
                                );
                                
                            );
                            ClearCollect(
                                SO,
                                ShowColumns(
                                    cb_donhang_SO_new.Selected,
                                    'Khách hàng text',
                                    'Mã Đơn Hàng',
                                    Id,
                                    'Tên thương mại_text',
                                    'Địa chỉ text',
                                    'SĐT text',
                                    'Ghi chú',
                                    'Điều khoản thanh toán',
                                    'Created On',
                                    Localtext,
                                    VAT,
                                    'Phụ phí vận chuyển'
                                )
                            );
                            ClearCollect(
                                SOD,
                                ShowColumns(
                                    var_SOD,
                                    'Tên sản phẩm text',
                                    'Ngày giao dự kiến tổng hợp',
                                    'Chiết khấu %',
                                    'Chiết khấu 2 (%)',
                                    'Chiết khấu VNĐ',
                                    'Số lượng',
                                    'Giá gốc',
                                    'Đơn vị đơn hàng',
                                    'Điều chỉnh GTGT'
                                )
                            );
                            UpdateContext({CountR_SOD: CountRows(SOD)});
                            //UpdateContext({var_kenhtiepnhan_isSelected: false});
                        PressedColor: =RGBA(116, 116, 116, 1)
                        PressedFill: =App.Theme.Colors.Darker30
                        SearchFields: =["crdfd_name"]
                        SearchItems: =Search(Sort(Filter(Sale_Orders,'Mã khách hàng'=var_MaKH,'Trạng thái giao nhận 1'='trạng thái giao nhận sale'.'Chưa giao',Status='Status (Sale_Orders)'.Active,'Active data'='Active data (Sale_Orders)'.Active),'Created On',SortOrder.Descending),cb_donhang_SO_new.SearchText,'Mã Đơn Hàng')
                        SelectionFill: =RGBA(116, 192, 252, 1)
                        SelectMultiple: =false
                        Size: =12
                        Tooltip: =
                        Width: =280
                        X: =307
                        Y: =cb_khach_hang_SO_new.Y
                        ZIndex: =6

        RightContainer1 As groupContainer.horizontalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            Fill: =RGBA(255, 255, 255, 1)
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            ZIndex: =2

            Container3 As groupContainer.manualLayoutContainer:
                DropShadow: =DropShadow.Light
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =1

                TextCanvas1_32 As Text:
                    Align: ="Start"
                    AutoHeight: =false
                    BorderColor: =
                    BorderStyle: =""
                    ContentLanguage: =""
                    DisplayMode: =DisplayMode.Edit
                    Fill: =
                    Font: =Font.'Open Sans'
                    FontColor: =
                    FontItalic: =false
                    FontStrikethrough: =false
                    FontUnderline: =false
                    Height: =40
                    Size: =22
                    TabIndex: =0
                    Text: ="Giỏ hàng"
                    Tooltip: =""
                    VerticalAlign: =VerticalAlign.Middle
                    Visible: =true
                    Weight: ='TextCanvas.Weight'.Bold
                    Width: =225
                    Wrap: =true
                    X: =50
                    Y: =IconFontAwesome1_14.Y
                    ZIndex: =1

                IconFontAwesome1_14 As IconFontAwesome:
                    ContentLanguage: =""
                    DisplayMode: =DisplayMode.Edit
                    Height: =37
                    iconHtml: |-
                        ="<i class='fa-solid fa-cart-shopping' style='color: #04a1b3;'></i>"
                    iconSize: =30
                    OnChange: =false
                    TabIndex: =0
                    Tooltip: ="IconFontAwesome description"
                    Visible: =true
                    Width: =40
                    X: =15
                    Y: =10
                    ZIndex: =2

                Table_GioHang As Table.pcfdataset:
                    AccessibleLabel: =""
                    BasePaletteColor: =
                    ContentLanguage: =""
                    ContextualLookupColumnFilters: ="yes"
                    DateOnlyFormat: ='PowerAppsOneGrid.DateOnlyFormat'.ShortDate
                    DateTimeFormat: ='PowerAppsOneGrid.DateTimeFormat'.ShortDateTime
                    DisableChildItemsEditing: ="no"
                    DisableStatusColumn: =""
                    DisableStatusColumnSavingIcons: =""
                    DisplayMode: =DisplayMode.Edit
                    EnableAggregation: ="no"
                    EnableColumnMoving: ="no"
                    EnableDropdownColor: ="no"
                    EnableEditing: ="no"
                    EnableFiltering: ="no"
                    EnableGrouping: ="no"
                    EnableJumpBar: ="no"
                    EnableMultipleSelection: ='PowerAppsOneGrid.EnableMultipleSelection'.Disable
                    EnablePagination: ="no"
                    EnableRangeSelection: ="yes"
                    EnableSorting: ="yes"
                    EnableStatusColumn: ="yes"
                    EnableStatusIcons: ="no"
                    EnableTypeIcons: ="no"
                    Font: =Font.'Open Sans'
                    FontColor: =RGBA(53, 61, 63, 1)
                    FontSize: =14
                    FontWeight: =FontWeight.Normal
                    GridCustomizerControlFullName: =""
                    HeaderFont: =Font.'Open Sans'
                    HeaderFontColor: =RGBA(40, 134, 222, 1)
                    HeaderFontSize: =16
                    HeaderFontWeight: =FontWeight.Semibold
                    Height: =274
                    Items: =Sort(formData_new,STT,SortOrder.Ascending)
                    LookupFilterBeginsWith: ="no"
                    NavigationTypesAllowed: ="none"
                    NoDataText: ="Giỏ hàng trống"
                    onCellValueChange: =false
                    onFilter: =false
                    onNavigate: =false
                    onRowSelect: =false
                    onSave: =false
                    OnSelect: =false
                    ReflowBehavior: ='PowerAppsOneGrid.ReflowBehavior'.GridOnly
                    ShowAvatar: ="yes"
                    ShowColumnHeaders: ="yes"
                    ShowFooter: ="yes"
                    TabIndex: =0
                    Tooltip: =""
                    Visible: =true
                    Width: =Parent.Width - 30
                    X: =15
                    Y: =47
                    ZIndex: =3

                    STT1 As PowerAppsOneGridTemplate_dataField.textualColumn:
                        CanGrow: =false
                        FieldDisplayName: ="STT"
                        FieldName: ="STT"
                        FieldType: ="n"
                        Order: =1
                        Type: ="s"
                        Visible: =true
                        Width: =50
                        ZIndex: =1

                    "'Tên sản phẩm1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =false
                        FieldDisplayName: ="Tên sản phẩm"
                        FieldName: ="Tên sản phẩm"
                        FieldType: ="s"
                        Order: =2
                        Type: ="s"
                        Visible: =true
                        ZIndex: =2

                    "'Đơn vị1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =true
                        FieldDisplayName: ="Đơn vị"
                        FieldName: ="Đơn vị"
                        FieldType: ="s"
                        Order: =3
                        Type: ="s"
                        Visible: =true
                        ZIndex: =3

                    "'Số lượng1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =true
                        FieldDisplayName: ="Số lượng"
                        FieldName: ="Số lượng"
                        FieldType: ="n"
                        Order: =4
                        Type: ="s"
                        Visible: =true
                        ZIndex: =4

                    VAT1 As PowerAppsOneGridTemplate_dataField.textualColumn:
                        CanGrow: =true
                        FieldDisplayName: ="VAT"
                        FieldName: ="VAT"
                        FieldType: ="n"
                        Order: =12
                        Type: ="s"
                        Visible: =true
                        ZIndex: =7

                    duyet_gia1 As PowerAppsOneGridTemplate_dataField.textualColumn:
                        CanGrow: =true
                        FieldDisplayName: ="duyet_gia"
                        FieldName: ="duyet_gia"
                        FieldType: ="s"
                        HeaderText: ="Người duyệt"
                        Order: =14
                        Type: ="s"
                        Visible: =true
                        ZIndex: =9

                    "'Ngày giao1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =true
                        FieldDisplayName: =If(var_Nganh_nghe = "Shop", "Ngày giao", "Ngày giao NM")
                        FieldName: =If(var_Nganh_nghe = "Shop", "Ngày giao", "Ngày giao NM")
                        FieldType: ="D"
                        Order: =14
                        Type: ="s"
                        Visible: =true
                        Width: =120
                        ZIndex: =10

                    Ca1 As PowerAppsOneGridTemplate_dataField.textualColumn:
                        CanGrow: =true
                        FieldDisplayName: ="Ca"
                        FieldName: ="Ca"
                        FieldType: ="s"
                        Order: =15
                        Type: ="s"
                        Visible: =true
                        ZIndex: =12

                    "'% Giảm giá1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =true
                        FieldDisplayName: ="% Giảm giá"
                        FieldName: ="% Giảm giá"
                        FieldType: ="n"
                        HeaderText: ="Chiết khấu"
                        Order: =10
                        Type: ="s"
                        Visible: =true
                        ZIndex: =13

                    "'Phụ phí hoá đơn1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        FieldDisplayName: ="Phụ phí hoá đơn"
                        FieldName: ="Phụ phí hoá đơn"
                        FieldType: ="n"
                        FieldVariantName: ="textualColumn"
                        Order: =9
                        Visible: =cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT'
                        ZIndex: =14

                    "'Giá đã giảm1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        FieldDisplayName: ="Giá đã giảm"
                        FieldName: ="Giá đã giảm"
                        FieldType: ="n"
                        FieldVariantName: ="textualColumn"
                        HeaderText: ="Giá sau CK"
                        Order: =12
                        ZIndex: =14

                    "'Tổng tiền1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        FieldDisplayName: ="Tổng tiền"
                        FieldName: ="Tổng tiền"
                        FieldType: ="n"
                        FieldVariantName: ="textualColumn"
                        Order: =13
                        Visible: =true
                        ZIndex: =14

                    "'Kho đáp ứng1' As PowerAppsOneGridTemplate_dataField.textualColumn":
                        CanGrow: =true
                        FieldDisplayName: ="Kho đáp ứng"
                        FieldName: ="Kho đáp ứng"
                        FieldType: ="s"
                        Order: =15
                        Type: ="s"
                        Visible: =true
                        ZIndex: =14

                    Gia_format2 As PowerAppsOneGridTemplate_dataField.textualColumn:
                        FieldDisplayName: ="Giá"
                        FieldName: ="Giá"
                        FieldType: ="n"
                        FieldVariantName: ="textualColumn"
                        HeaderText: ="Giá"
                        Order: =5
                        Width: =0
                        ZIndex: =15

                Container_total_1 As groupContainer.manualLayoutContainer:
                    BorderColor: =RGBA(239, 246, 255, 1)
                    BorderThickness: =0.5
                    DropShadow: =DropShadow.Light
                    Fill: =RGBA(239, 246, 255, 1)
                    Height: =161
                    RadiusBottomLeft: =10
                    RadiusBottomRight: =10
                    RadiusTopLeft: =10
                    RadiusTopRight: =10
                    Width: =Parent.Width - 30
                    X: =15
                    Y: =321
                    ZIndex: =4

                    TextCanvas_khachhang_18 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(53, 61, 63, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =40
                        PaddingLeft: =15
                        PaddingTop: =5
                        Size: =20
                        TabIndex: =0
                        Text: ="Thanh toán"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =400
                        Wrap: =true
                        X: =0
                        Y: =0
                        ZIndex: =1

                    TextCanvas_khachhang_23 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(53, 61, 63, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingLeft: =15
                        PaddingTop: =5
                        Size: =16
                        TabIndex: =0
                        Text: |-
                            ="Tổng tiền không VAT:"
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =200
                        Wrap: =true
                        X: =0
                        Y: =42
                        ZIndex: =2

                    TextCanvas_khachhang_24 As Text:
                        Align: ='TextCanvas.Align'.Start
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(53, 61, 63, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingLeft: =5
                        PaddingRight: =10
                        PaddingTop: =5
                        Size: =16
                        TabIndex: =0
                        Text: |-
                            =Text(Sum(formData_new,'Giá đã giảm' * 'Số lượng'),"#,### VNĐ")
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =200
                        Wrap: =true
                        X: =180
                        Y: =42
                        ZIndex: =3

                    TextCanvas_khachhang_25 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(53, 61, 63, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingLeft: =15
                        PaddingTop: =5
                        Size: =16
                        TabIndex: =0
                        Text: |-
                            ="Tổng GTGT: "
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Semibold
                        Width: =152
                        Wrap: =true
                        X: =0
                        Y: =72
                        ZIndex: =4

                    TextCanvas_khachhang_26 As Text:
                        Align: ='TextCanvas.Align'.Start
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(53, 61, 63, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingLeft: =5
                        PaddingRight: =10
                        PaddingTop: =5
                        Size: =16
                        TabIndex: =0
                        Text: |-
                            =Text(Sum(formData_new,GTGT),"#,### VNĐ")
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =200
                        Wrap: =true
                        X: =108
                        Y: =72
                        ZIndex: =5

                    TextCanvas_khachhang_27 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(51, 82, 183, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingBottom: =5
                        PaddingLeft: =15
                        Size: =18
                        TabIndex: =0
                        Text: |-
                            ="Tổng thanh toán: "
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =180
                        Wrap: =true
                        X: =0
                        Y: =117
                        ZIndex: =6

                    Rectangle4_1 As rectangle:
                        BorderColor: =App.Theme.Colors.Darker40
                        Fill: =RGBA(191, 219, 254, 1)
                        Height: =1
                        Width: =Parent.Width - 30
                        X: =Parent.X
                        Y: =111
                        ZIndex: =7

                    TextCanvas_khachhang_29 As Text:
                        Align: ="Start"
                        AutoHeight: =false
                        BorderColor: =
                        BorderStyle: =""
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Fill: =
                        Font: =Font.'Open Sans'
                        FontColor: =RGBA(51, 82, 183, 1)
                        FontItalic: =false
                        FontStrikethrough: =false
                        FontUnderline: =false
                        Height: =30
                        PaddingBottom: =5
                        PaddingLeft: =5
                        Size: =18
                        TabIndex: =0
                        Text: |-
                            =Text(Sum(formData_new,'Tổng tiền'),"#,### VNĐ")
                        Tooltip: =""
                        VerticalAlign: =VerticalAlign.Middle
                        Visible: =true
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =300
                        Wrap: =true
                        X: =176
                        Y: =117
                        ZIndex: =9

                Button_ThemGioHangSO_1 As button:
                    BorderColor: =RGBA(16, 185, 129, 1)
                    Color: =App.Theme.Colors.PrimaryForeground
                    DisabledBorderColor: =RGBA(244, 244, 244, 1)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    DisabledFill: =RGBA(244, 244, 244, 1)
                    DisplayMode: |-
                        =If(
                            CountRows(formData_new) > 0,
                            DisplayMode.Edit,
                            DisplayMode.Disabled
                        )
                    Fill: =RGBA(16,185,129,1)
                    Font: =App.Theme.Font
                    FontWeight: =FontWeight.Bold
                    Height: =50
                    HoverBorderColor: =
                    HoverColor: =App.Theme.Colors.PrimaryForeground
                    HoverFill: =
                    OnSelect: |
                        =UpdateContext({record_MaDH_selected: cb_donhang_SO_new.Selected});
                        If(
                           false,//(IsBlank(var_KenhTiepNhan) And !var_kenhtiepnhan_isSelected) And var_selected_khachhang.'Ngành nghề text' = "5. Shop bán lẻ",
                            Notify("Vui lòng chọn kênh tiếp nhận",NotificationType.Warning,3000),
                            Set(
                                khachhang_selected,
                                cb_khach_hang_SO_new.Selected
                            );
                            Set(
                                var_check_promotion_SOD,
                                IsEmpty(
                                    Filter(
                                        formData_new,
                                        !IsBlank(PromotionRecord)
                                    )
                                )
                            );
                            If(
                                Dropdown_KhoDapUngSO.DisplayMode = DisplayMode.Edit,
                                Patch(
                                    Sale_Orders,
                                    LookUp(
                                        Sale_Orders,
                                        'Mã Đơn Hàng' = record_MaDH_selected.'Mã Đơn Hàng'
                                    ),
                                    {'Vị trí kho': Dropdown_KhoDapUngSO.Selected}
                                )
                            );
                            If(
                                var_selected_khachhang.'Ngành nghề text' = "5. Shop bán lẻ",
                                Patch(
                                    Sale_Orders,
                                    record_MaDH_selected,
                                    {'Kênh tiếp nhận': Dropdown_KenhTiepNhanSO.Selected.Value}
                                );
                            );
                            ForAll(
                                formData_new,
                                With(
                                    {
                                        existingRecord: formData_new[@'Record SOD3'],
                                        expectedDeliveryDate: If(
                                            cb_khach_hang_SO_new.Selected.'Ngành nghề text' = "5. Shop bán lẻ",
                                            formData_new[@'Ngày giao'],
                                            formData_new[@'Ngày giao NM']
                                        ),
                                        mappedVAT: LookUp(
                                            Table(
                                                {
                                                    VAT: 10,
                                                    Value: 'Thuế GTGT'.'10%'
                                                },
                                                {
                                                    VAT: 8,
                                                    Value: 'Thuế GTGT'.'8%'
                                                },
                                                {
                                                    VAT: 5,
                                                    Value: 'Thuế GTGT'.'5%'
                                                },
                                                {
                                                    VAT: 0,
                                                    Value: 'Thuế GTGT'.'0%'
                                                }
                                            ),
                                            VAT = formData_new[@VAT],
                                            Value
                                        ),
                                        mappedApproval: LookUp(
                                            var_table_duyetgia,
                                            Name = formData_new[@duyet_gia],
                                            Value
                                        ),
                                        approvedPriceSUP: If(
                                            !IsBlank(formData_new[@id_duyetgiaSUP]),
                                            LookUp(
                                                'Duyệt giá',
                                                Status = 'Status (Duyệt giá)'.Active And ID = formData_new[@id_duyetgiaSUP]
                                            )
                                        )
                                    },
                                    Patch(
                                        'Sale Order Details',
                                        Coalesce(
                                            existingRecord,
                                            Defaults('Sale Order Details')
                                        ),
                                        {
                                            'Mã đơn hàng': record_MaDH_selected,
                                            'Tên sản phẩm': formData_new[@'Record sản phẩm'],
                                            ID_Unit_Sp: formData_new[@'Record Đơn vị'],
                                            'Số lượng': Value(formData_new[@'Số lượng']),
                                            Giá: If(
                                                var_Nganh_nghe = "Shop",
                                                Value(formData_new[@'Giá đã giảm']),
                                                Value(formData_new[@Giá])
                                            ),
                                            'Giá gốc': Value(formData_new[@Giá]),
                                            Thuế: Value(formData_new[@GTGT]),
                                            'Stt đơn': formData_new[@STT],
                                            'Ngày dự kiến giao': expectedDeliveryDate,
                                            'Điều chỉnh GTGT': mappedVAT,
                                            'Ghi chú': formData_new[@GhiChu],
                                            'Đơn hàng gấp': formData_new[@DonhangGap],
                                            'Duyệt giá (crdfd_duyetgia)': mappedApproval,
                                            'Chiết khấu %': formData_new[@Chietkhauphantram],
                                            'Chiết khấu VNĐ': formData_new[@Chietkhautien],
                                            'Promotion text': formData_new[@promotiontext],
                                            Promotion: formData_new[@PromotionRecord],
                                            'Duyệt giá sup': approvedPriceSUP,
                                            'Chiết khấu 2 (%)': 0,
                                            Ca: If(
                                                formData_new[@Ca] = "Ca sáng",
                                                'Ca (Sale Order Details)'.'Ca sáng',
                                                'Ca (Sale Order Details)'.'Ca chiều'
                                            ),
                                            'Phụ phí hoá đơn (%)': formData_new[@'Phụ phí hoá đơn']
                                        }
                                    )
                                )
                            );
                            Patch(
                                Sale_Orders,
                                record_MaDH_selected,
                                {
                                    'Số đơn hàng chi tiết': CountRows(formData_new),
                                    'Số đơn chi tiết có Promotion': CountRows(
                                        Filter(
                                            formData_new,
                                            !IsBlank(PromotionRecord) And "Thanh toán sau khi nhận hàng" in DKTT
                                        )
                                    )
                                }
                            );
                            Notify(
                                "Tạo đơn bán chi tiết thành công!",
                                NotificationType.Success,
                                2000
                            );
                            Set(
                                Total_Order,
                                Sum(
                                    formData_new,
                                    'Tổng tiền'
                                )
                            );
                            Set(
                                var_table_SP,
                                Split(
                                    Concat(
                                        ShowColumns(
                                            formData_new,
                                            'Mã sản phẩm'
                                        ),
                                        'Mã sản phẩm',
                                        ","
                                    ),
                                    ","
                                )
                            );
                            Set(
                                var_table_NSP,
                                Split(
                                    Concat(
                                        ShowColumns(
                                            formData_new,
                                            'Mã nhóm SP'
                                        ),
                                        'Mã nhóm SP',
                                        ","
                                    ),
                                    ","
                                )
                            );
                            Set(
                                var_count_notIn_Promotions,
                                CountRows(
                                    Filter(
                                        formData_new As item,
                                        CountRows(
                                            Filter(
                                                ListPromotion_Order As PromotionM,
                                                PromotionM.'Chiết khấu 2' = 'Chiết khấu 2 (Promotion)'.Yes && (item.'Mã sản phẩm' in PromotionM.Ma_SP || item.'Mã nhóm SP' in PromotionM.Ma_NSP)
                                            )
                                        ) = 0
                                    )
                                )
                            );
                            Set(
                                var_dieukhoanthanhtoan,
                                record_MaDH_selected.'Điều khoản thanh toán CAL'
                            );
                            ClearCollect(
                                OrderxPromotion_Order,
                                Filter(
                                    'Orders x Promotion',
                                    Status = 'Status (Orders x Promotion)'.Active,
                                    SO.Id = record_MaDH_selected.Id,
                                    'Type cal' = "Order"
                                )
                            );
                            UpdateContext({showLoading: false});
                            UpdateContext({Popup_PromotionOrder: true});
                            //UpdateContext({var_kenhtiepnhan_isSelected: false});
                            Clear(formData_new);
                            Reset(cb_khach_hang_SO_new);
                        );
                    PressedBorderColor: =
                    PressedColor: =Self.Color
                    PressedFill: =RGBA(16, 143, 100, 1)
                    Size: =14
                    Text: ="Tạo đơn hàng"
                    Width: =459
                    X: =15
                    Y: =508
                    ZIndex: =5

                IconFontAwesome_ThemGioHangSO_1 As IconFontAwesome:
                    ContentLanguage: =""
                    DisplayMode: =DisplayMode.Edit
                    Height: =26
                    iconHtml: |-
                        ="<i class='fa-solid fa-check' style='color: #ffffff;'></i>"
                    iconSize: =30
                    OnChange: =false
                    TabIndex: =0
                    Tooltip: ="IconFontAwesome description"
                    Visible: =true
                    Width: =41
                    X: =142
                    Y: =518
                    ZIndex: =6

                Button_ThemGioHangSO_2 As button:
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =0
                    Color: =App.Theme.Colors.PrimaryForeground
                    DisabledBorderColor: =RGBA(244, 244, 244, 1)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    DisabledFill: =RGBA(244, 244, 244, 1)
                    DisplayMode: |-
                        =If(
                            !IsBlank(Table_GioHang.Selected),
                            DisplayMode.Edit,
                            DisplayMode.Disabled
                        )
                    Fill: =RGBA(184, 26, 28, 1)
                    Font: =App.Theme.Font
                    FontWeight: =FontWeight.Bold
                    Height: =50
                    HoverBorderColor: =
                    HoverColor: =RGBA(255, 255, 255, 1)
                    HoverFill: =RGBA(184, 26, 28, 1)
                    OnSelect: |
                        =UpdateContext({formdata_selected: Table_GioHang.Selected});
                        If(
                            !IsBlank(formdata_selected.'ID đơn hàng'),
                            UpdateContext({ShowPopup_HuyDon: true});
                            Reset(input_lydohuydon);
                            Reset(dr_lydohuy),
                            UpdateContext({ShowPopup_HuyDon: false});
                            RemoveIf(
                                formData_new,
                                STT = formdata_selected.STT
                            );
                            UpdateContext(
                                {
                                    data_muakem: Filter(
                                        Promotion,
                                        (formdata_selected.'Mã sản phẩm' in 'Mã sản phẩm (mua kèm)' || formdata_selected.'Mã nhóm SP' in 'Mã nhóm sp (Mua kèm)') && Status = 'Status (Promotion)'.Active
                                    )
                                }
                            );
                            ForAll(
                                data_muakem As data_muakem,
                                If(
                                    (CountIf(
                                        List_Ma_SP_formdata,
                                        Text(Value) in data_muakem.'Mã sản phẩm (mua kèm)'
                                    ) = 0 And !IsBlank(data_muakem.'Mã sản phẩm (mua kèm)')) || (CountIf(
                                        List_Ma_NSP_formdata,
                                        Text(Value) in data_muakem.'Mã nhóm sp (Mua kèm)'
                                    ) = 0 And !IsBlank(data_muakem.'Mã nhóm sp (Mua kèm)')),
                                    With(
                                        {
                                            heSoVAT: If(
                                                cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' && cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT',
                                                1.015,
                                                1
                                            )
                                        },
                                        ForAll(
                                            Filter(
                                                formData_new,
                                                PromotionRecord.ID = data_muakem.ID
                                            ),
                                            Patch(
                                                formData_new,
                                                ThisRecord,
                                                {
                                                    PromotionRecord: Blank(),
                                                    'Giá đã giảm': ThisRecord.Giá * heSoVAT,
                                                    'Tổng tiền': ThisRecord.Giá * heSoVAT * (1 + ThisRecord.VAT),
                                                    '% Giảm giá': 0,
                                                    Chietkhauphantram: 0,
                                                    Chietkhautien: 0
                                                }
                                            );
                                        );
                                    )
                                )
                            );
                            // Update record collection với giá trị mới với trường hợp cộng dồn
                        With(
                                {
                                    value: Sum(
                                        Filter(
                                            formData_new,
                                            PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes
                                        ),
                                        'Số lượng'
                                    )
                                },
                                UpdateIf(
                                    formData_new,
                                    ThisRecord.PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes,
                                    With(
                                        {
                                            promoValue: If(
                                                !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3' = var_selected_dieukhoanthanhtoan_choice),
                                                ThisRecord.PromotionRecord.'Value 3',
                                                If(
                                                    !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2' = var_selected_dieukhoanthanhtoan_choice),
                                                    ThisRecord.PromotionRecord.'Value 2',
                                                    ThisRecord.PromotionRecord.Value
                                                )
                                            ),
                                            Record: ThisRecord
                                        },
                                        With(
                                            {
                                                PPHD: If(
                                                    cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT',
                                                    1.015,
                                                    1
                                                ),
                                                Gia_da_chietkhau: If(
                                                    Record.PromotionRecord.'VNĐ/% Text' = "VNĐ",
                                                    Record.Giá - promoValue,
                                                    Record.Giá * (1 - promoValue / 100)
                                                )
                                            },
                                            {
                                                '% Giảm giá': If(
                                                    Record.PromotionRecord.'VNĐ/% Text' = "%",
                                                    promoValue / 100,
                                                    promoValue
                                                ),
                                                'Giá đã giảm': Gia_da_chietkhau * PPHD,
                                                'Tổng tiền': (Record.'Số lượng' * (Gia_da_chietkhau * PPHD)) + Record.VAT,
                                                Chietkhauphantram: If(
                                                    Record.PromotionRecord.'VNĐ/% Text' = "%" && var_Nganh_nghe = "Shop",
                                                    promoValue / 100,
                                                    0
                                                ),
                                                Chietkhautien: If(
                                                    Record.PromotionRecord.'VNĐ/% Text' = "VNĐ" && var_Nganh_nghe = "Shop",
                                                    promoValue,
                                                    0
                                                )
                                            }
                                        )
                                    )
                                );
                                RemoveIf(
                                    formData_new,
                                    CountIf(
                                        List_Ma_SP_formdata,
                                        Text(Value) in formdata_selected.PromotionRecord.'Mã sản phẩm (mua kèm)'
                                    ) > 0
                                )
                            );
                            If(
                                var_Nganh_nghe = "Shop",
                                UpdateIf(
                                    Filter(
                                        formData_new,
                                        'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị nước" || 'Record sản phẩm'.'Cấp 4' = "Ống cứng PVC"
                                    ),
                                    var_sum_thiet_bi_nuoc < 200000000 || var_sum_ong_cung < 200000000,
                                    {
                                        'Ngày giao': If(
                                            var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,
                                            DateTimeValue(ngay_giao_SOBG),
                                            If(
                                                var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,
                                                DateAdd(
                                                    DateTimeValue(ngay_giao_SOBG),
                                                    12,
                                                    TimeUnit.Hours
                                                ),
                                                DateTimeValue(ngay_giao_SOBG)
                                            )
                                        ),
                                        Ca: If(
                                            Hour(
                                                If(
                                                    var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,
                                                    DateTimeValue(ngay_giao_SOBG),
                                                    If(
                                                        var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao_SOBG),
                                                            12,
                                                            TimeUnit.Hours
                                                        ),
                                                        DateTimeValue(ngay_giao_SOBG)
                                                    )
                                                )
                                            ) >= 0 && Hour(
                                                If(
                                                    var_count_thiet_bi_nuoc < 50 || var_sum_ong_cung < 100000000,
                                                    DateTimeValue(ngay_giao_SOBG),
                                                    If(
                                                        var_count_thiet_bi_nuoc >= 50 && var_sum_thiet_bi_nuoc >= 100000000,
                                                        DateAdd(
                                                            DateTimeValue(ngay_giao_SOBG),
                                                            12,
                                                            TimeUnit.Hours
                                                        ),
                                                        DateTimeValue(ngay_giao_SOBG)
                                                    )
                                                )
                                            ) <= 12,
                                            'Ca (SOD báo giá)'.'Ca sáng',
                                            'Ca (SOD báo giá)'.'Ca chiều'
                                        )
                                    }
                                );
                                UpdateIf(
                                    Filter(
                                        formData_new,
                                        'Record sản phẩm'.'Cấp 2 NHSP' = "Thiết bị điện"
                                    ),
                                    var_sum_thiet_bi_dien < 200000000,
                                    {
                                        'Ngày giao': DateTimeValue(ngay_giao),
                                        Ca: If(
                                            var_Ca,
                                            'Ca (SOD báo giá)'.'Ca sáng',
                                            'Ca (SOD báo giá)'.'Ca chiều'
                                        )
                                    }
                                );
                                UpdateIf(
                                    Filter(
                                        formData_new,
                                        'Record sản phẩm'.'Cấp 2 NHSP' = "Vật tư kim khí"
                                    ),
                                    var_count_kim_khi < 100,
                                    {
                                        'Ngày giao': DateAdd(
                                            DateTimeValue(ngay_giao),
                                            0,
                                            TimeUnit.Hours
                                        ),
                                        Ca: If(
                                            var_Ca,
                                            'Ca (SOD báo giá)'.'Ca sáng',
                                            'Ca (SOD báo giá)'.'Ca chiều'
                                        )
                                    }
                                );
                            );
                            ClearCollect(
                                formData_new,
                                ForAll(
                                    Sequence(
                                        CountRows(
                                            Sort(
                                                formData_new,
                                                STT,
                                                SortOrder.Ascending
                                            )
                                        )
                                    ),
                                    Patch(
                                        Last(
                                            FirstN(
                                                Sort(
                                                    formData_new,
                                                    STT,
                                                    SortOrder.Ascending
                                                ),
                                                Value
                                            )
                                        ),
                                        {STT: Value}
                                    )
                                )
                            );
                            Notify(
                                "Cập nhật thành công",
                                NotificationType.Success,
                                2000
                            );
                            
                        );
                        Clear(TanSuatKho);
                        ForAll(
                            formData_new As ColData,
                            ForAll(
                                var_filterkho As Kho,
                                If(
                                    CountRows(
                                        Filter(
                                            'Kho Bình Định',
                                            'Vị trí kho'.'Tên kho' = Kho.'Tên kho' && 'Tên sản phẩm'.'Tên sản phẩm' = ColData.'Tên sản phẩm' && 'Tồn kho lý thuyết - Bỏ mua' >= ColData.'Số lượng'
                                        )
                                    ) > 0,
                                    Collect(
                                        TanSuatKho,
                                        {
                                            TênSảnPhẩm: ColData.'Tên sản phẩm',
                                            SốLượng: ColData.'Số lượng',
                                            Kho: Kho.'Tên kho'
                                        }
                                    )
                                )
                            )
                        );
                        With(
                            {tempData: formData_new},
                            ForAll(
                                tempData As ColData,
                                Patch(
                                    formData_new,
                                    LookUp(
                                        formData_new,
                                        'Tên sản phẩm' = ColData.'Tên sản phẩm'
                                    ),
                                    {
                                        'Kho đáp ứng': LookUp(
                                            TanSuatKho,
                                            TênSảnPhẩm = ColData.'Tên sản phẩm',
                                            Kho
                                        )
                                    }
                                )
                            )
                        );
                    PressedBorderColor: =
                    PressedColor: =Self.Color
                    PressedFill: =RGBA(255, 184, 174, 1)
                    Size: =14
                    Text: ="Hủy sản phẩm"
                    Width: =229
                    X: =486
                    Y: =508
                    ZIndex: =7

                IconFontAwesome_ThemGioHangSO_2 As IconFontAwesome:
                    ContentLanguage: =""
                    DisplayMode: =DisplayMode.Edit
                    Height: =26
                    iconHtml: |-
                        ="<i class='fa-solid fa-trash-can' style='color: #ffffff;'></i>"
                    iconSize: =30
                    OnChange: =false
                    TabIndex: =0
                    Tooltip: ="IconFontAwesome description"
                    Visible: =true
                    Width: =41
                    X: =502
                    Y: =518
                    ZIndex: =8

    "'Container Header_1' As groupContainer.manualLayoutContainer":
        DropShadow: =DropShadow.Light
        Height: =74
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =1366
        ZIndex: =2

        Group9_1 As group:
            Height: =5
            minimumHeight: =5
            minimumWidth: =5
            Visible: =true
            Width: =5
            X: =0
            Y: =0
            ZIndex: =0

            IconBell_1 As IconFontAwesome:
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Height: =40
                iconHtml: ="<i class='fa-regular fa-bell'></i>"
                iconSize: =30
                OnChange: =false
                TabIndex: =0
                Tooltip: ="IconFontAwesome description"
                Visible: =true
                Width: =27
                X: =1091
                Y: =24
                ZIndex: =2

            TextNameUser_2 As Text:
                Align: ='TextCanvas.Align'.Start
                AutoHeight: =false
                BorderColor: =
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Fill: =
                Font: =Font.'Open Sans'
                FontColor: =
                FontItalic: =false
                FontStrikethrough: =false
                FontUnderline: =false
                Height: =73
                Size: =20
                TabIndex: =0
                Text: =User().FullName
                Tooltip: =""
                VerticalAlign: =VerticalAlign.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Regular
                Width: =171
                Wrap: =false
                X: =1192
                Y: =0
                ZIndex: =3

            Avatar1_1 As Avatar:
                AccessibleLabel: =""
                Appearance: ='Avatar.Appearance'.Brand
                Badge: ="Available"
                BasePaletteColor: =
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =""
                FontColor: =
                FontItalic: =false
                FontSize: =0
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =""
                Height: =50
                Image: =User().Image
                Name: =User().FullName
                OutOfOffice: =false
                Shape: ='Avatar.Shape'.Circular
                TabIndex: =0
                Tooltip: =""
                Visible: =true
                Width: =50
                X: =1130
                Y: =11
                ZIndex: =6

        IconFontAwesome1_11 As IconFontAwesome:
            ContentLanguage: =""
            DisplayMode: =DisplayMode.Edit
            Height: =59
            iconHtml: |-
                ="<i class='fa-solid fa-store' style='color: #04a1b3;'></i>"
            iconSize: =45
            OnChange: =false
            TabIndex: =0
            Tooltip: ="IconFontAwesome description"
            Visible: =true
            Width: =31
            X: =20
            Y: =12
            ZIndex: =1

        Dropdown1_4 As dropdown:
            BorderColor: =App.Theme.Colors.Darker40
            BorderStyle: =BorderStyle.None
            BorderThickness: =0
            ChevronBackground: =
            ChevronDisabledBackground: =RGBA(166, 166, 166, 1)
            ChevronDisabledFill: =RGBA(244, 244, 244, 1)
            ChevronFill: =App.Theme.Colors.PrimaryForeground
            ChevronHoverBackground: =
            ChevronHoverFill: =App.Theme.Colors.PrimaryForeground
            Default: ="SO New"
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            Font: =App.Theme.Font
            FontWeight: =FontWeight.Bold
            Height: =50
            HoverBorderColor: =
            HoverColor: =RGBA(0, 0, 0, 1)
            HoverFill: =
            Items: =Screen_Admin
            OnChange: |-
                =Navigate(Dropdown1_4.Selected.Value,ScreenTransition.CoverRight); 
                Reset(Dropdown1_4); 
                Reset(cb_khach_hang_SO_new);
            PressedColor: =App.Theme.Colors.PrimaryForeground
            PressedFill: =
            Reset: =
            SelectionColor: =App.Theme.Colors.PrimaryForeground
            SelectionFill: =RGBA(180, 214, 250, 1)
            Size: =22
            X: =79
            Y: =5
            ZIndex: =4

        TextNameUser_3 As Text:
            Align: ='TextCanvas.Align'.Start
            AutoHeight: =false
            BorderColor: =
            BorderStyle: =""
            ContentLanguage: =""
            DisplayMode: =DisplayMode.Edit
            Fill: =
            Font: =Font.'Open Sans'
            FontColor: =
            FontItalic: =false
            FontStrikethrough: =false
            FontUnderline: =false
            Height: =30
            PaddingRight: =5
            Size: =16
            TabIndex: =0
            Text: ="V1.0.12"
            Tooltip: =""
            VerticalAlign: =VerticalAlign.Middle
            Visible: =true
            Weight: ='TextCanvas.Weight'.Regular
            Width: =100
            Wrap: =false
            X: =93
            Y: =44
            ZIndex: =5

    C_showPopupPromotionOrder_3 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =RGBA(189, 189, 189, 0.67)
        Height: =900
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =Popup_PromotionOrder 
        Width: =1366
        ZIndex: =3

        "'Deactive Promotion Order_1' As group":
            Height: =5
            minimumHeight: =5
            minimumWidth: =5
            Visible: =true
            Width: =5
            X: =0
            Y: =0
            ZIndex: =0

            Button_Nền_1 As button:
                BorderColor: =App.Theme.Colors.Primary
                BorderThickness: =0
                Color: =App.Theme.Colors.PrimaryForeground
                DisabledBorderColor: =RGBA(244, 244, 244, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =DisplayMode.View
                Fill: =RGBA(255, 255, 255, 1)
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                Height: =324
                HoverBorderColor: =App.Theme.Colors.Darker10
                HoverColor: =App.Theme.Colors.PrimaryForeground
                HoverFill: =App.Theme.Colors.Darker10
                PressedBorderColor: =App.Theme.Colors.Darker40
                PressedColor: =Self.Color
                PressedFill: =App.Theme.Colors.Darker40
                RadiusBottomLeft: =30
                RadiusBottomRight: =30
                RadiusTopLeft: =30
                RadiusTopRight: =30
                Size: =15
                Text: ="Button"
                Visible: =CountIf(OrderxPromotion_Order,true) > 0
                Width: =720
                X: =327
                Y: =232
                ZIndex: =6

            Xong_1 As Button:
                AcceptsFocus: =true
                AccessibleLabel: =""
                Align: =""
                Appearance: ="Primary"
                BasePaletteColor: =
                BorderColor: =
                BorderRadius: =10
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =""
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =""
                Height: =40
                Icon: =""
                IconRotation: =0
                IconStyle: ="Outline"
                Layout: ="Icon before"
                OnSelect: |-
                    =
                    Clear(OrderxPromotion_Order);
                TabIndex: =0
                Text: ="Save"
                Tooltip: =""
                VerticalAlign: =""
                Visible: =CountIf(OrderxPromotion_Order,true) > 0
                Width: =160
                X: =774
                Y: =489
                ZIndex: =8

            "'Deactive-Promotion_1' As Button":
                AcceptsFocus: =true
                AccessibleLabel: =""
                Align: =""
                Appearance: ="Primary"
                BasePaletteColor: =RGBA(189, 178, 176, 1)
                BorderColor: =
                BorderRadius: =10
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =""
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =""
                Height: =40
                Icon: =""
                IconRotation: =0
                IconStyle: ="Outline"
                Layout: ="Icon before"
                OnSelect: |
                    =Patch(
                        'Orders x Promotion',
                        PromotiOnder_1.Selected,
                        {Status: 'Status (Orders x Promotion)'.Inactive}
                    );
                    Notify(
                        "Deactive thành công",
                        NotificationType.Success,
                        2000
                    );
                    ClearCollect(
                        OrderxPromotion_Order,
                        Filter(
                            'Orders x Promotion',
                            Status = 'Status (Orders x Promotion)'.Active,
                            SO.Id = record_MaDH_selected.Id,
                            'Type cal' = "Order"
                        )
                    );
                TabIndex: =0
                Text: ="Deactive"
                Tooltip: =""
                VerticalAlign: =""
                Visible: =CountIf(OrderxPromotion_Order,true) > 0
                Width: =160
                X: =431
                Y: =489
                ZIndex: =9

        "'Add promotion Order_2' As group":
            Height: =5
            minimumHeight: =5
            minimumWidth: =5
            Visible: =true
            Width: =5
            X: =0
            Y: =0
            ZIndex: =0

            Nền_4 As button:
                BorderColor: =App.Theme.Colors.Primary
                Color: =App.Theme.Colors.PrimaryForeground
                DisabledBorderColor: =RGBA(244, 244, 244, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =DisplayMode.View
                Fill: =RGBA(255, 255, 255, 0.95)
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                Height: =234
                HoverBorderColor: =App.Theme.Colors.Darker10
                HoverColor: =App.Theme.Colors.PrimaryForeground
                HoverFill: =App.Theme.Colors.Darker10
                PressedBorderColor: =App.Theme.Colors.Darker40
                PressedColor: =Self.Color
                PressedFill: =App.Theme.Colors.Darker40
                RadiusBottomLeft: =30
                RadiusBottomRight: =30
                RadiusTopLeft: =30
                RadiusTopRight: =30
                Size: =15
                Text: =
                Visible: =CountIf(OrderxPromotion_Order,true) = 0
                Width: =556
                X: =387
                Y: =267
                ZIndex: =1

            bt_huy_4 As Button:
                AcceptsFocus: =true
                AccessibleLabel: =""
                Align: =""
                Appearance: =
                BasePaletteColor: =RGBA(189, 178, 176, 1)
                BorderColor: =
                BorderRadius: =10
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Arial
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =FontWeight.Semibold
                Height: =40
                Icon: =""
                IconRotation: =0
                IconStyle: ="Outline"
                Layout: ="Icon before"
                OnSelect: |-
                    =UpdateContext({Popup_PromotionOrder:false});
                    Reset(Combobox_PromotionOrder_3);
                TabIndex: =0
                Text: ="Huỷ"
                Tooltip: =""
                VerticalAlign: =""
                Visible: =CountIf(OrderxPromotion_Order,true) = 0
                Width: =160
                X: =713
                Y: =428
                ZIndex: =2

            Label_lydohuy_7 As label:
                BorderColor: =App.Theme.Colors.Darker40
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                Height: =35
                Size: =18
                Text: ="Promotion Order"
                Visible: =CountIf(OrderxPromotion_Order,true) = 0
                Width: =500
                X: =419
                Y: =274
                ZIndex: =3

            Combobox_PromotionOrder_3 As Combobox.pcfdataset:
                AccessibleLabel: =""
                Appearance: ="FilledDarker"
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Arial
                FontItalic: =false
                FontSize: =18
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =FontWeight.Normal
                Height: =49
                InputTextPlaceholder: ="Promotion Order"
                IsSearchable: =false
                Items: =Promotion_Order_Max
                MultiValueDelimiter: =", "
                OnChange: =
                Required: =false
                SelectMultiple: =true
                TabIndex: =0
                Tooltip: =""
                TriggerOutput: ="Keypress"
                ValidationState: ="None"
                Visible: =CountIf(OrderxPromotion_Order,true) = 0
                Width: =468
                X: =431
                Y: =339
                ZIndex: =4

                NamePromotion1_3 As PowerApps_CoreControls_ComboboxCanvasTemplate_dataField.textualColumn:
                    FieldDisplayName: ="NamePromotion"
                    FieldName: ="NamePromotion"
                    FieldType: ="s"
                    Order: =1
                    Type: ="s"
                    ZIndex: =1

            Timer_Promotion_3 As timer:
                AutoPause: =false
                BorderColor: =App.Theme.Colors.Primary
                Color: =App.Theme.Colors.PrimaryForeground
                DisabledBorderColor: =RGBA(244, 244, 244, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =If(!IsBlank(Combobox_PromotionOrder_3.Selected), DisplayMode.Edit,DisplayMode.Disabled)
                Fill: =App.Theme.Colors.Primary
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                HoverBorderColor: =App.Theme.Colors.Darker10
                HoverColor: =App.Theme.Colors.PrimaryForeground
                HoverFill: =App.Theme.Colors.Darker10
                OnTimerEnd: |-
                    =UpdateContext({showLoading: false});
                    ForAll(
                        Combobox_PromotionOrder_3.SelectedItems As This,
                        Patch(
                            'Orders x Promotion',
                            Defaults('Orders x Promotion'),
                            {
                                Promotion: LookUp(Promotion,ID = This.crdfd_promotionid),
                                SO: record_MaDH_selected,
                                Type:"Order",
                                Loại: If(This.VND_Percent='VNĐ/% (Promotion)'.VNĐ,"Tiền","Phần trăm"),
                                'Chiết khấu':If(This.VND_Percent='VNĐ/% (Promotion)'.VNĐ,This.ValuePromotion,This.ValuePromotion/100)
                            }
                        )
                    );
                    Reset(Combobox_PromotionOrder_3);
                    Notify("Áp dụng thành công",NotificationType.Success,5000);
                    UpdateContext({Popup_PromotionOrder:false});
                OnTimerStart: |-
                    =UpdateContext({showLoading: true});
                PressedBorderColor: =App.Theme.Colors.Darker40
                PressedColor: =Self.Color
                PressedFill: =App.Theme.Colors.Darker40
                RadiusBottomLeft: =15
                RadiusBottomRight: =15
                RadiusTopLeft: =15
                RadiusTopRight: =15
                Reset: =true
                Size: =14
                Start: =true
                Text: |-
                    =If(!IsBlank(Combobox_PromotionOrder_3.Selected) And showLoading ,Text(Time(0, 0, Round((Self.Duration - Self.Value) / 1000, 0)), "mm:ss"), "Xác nhận")
                Visible: =CountIf(OrderxPromotion_Order,true) = 0
                X: =448
                Y: =428
                ZIndex: =5

    C_showPopupHuyDon_1 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =RGBA(189, 189, 189, 0.67)
        Height: =900
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =ShowPopup_HuyDon
        Width: =1366
        ZIndex: =4

        Group6_1 As group:
            Height: =5
            minimumHeight: =5
            minimumWidth: =5
            Visible: =true
            Width: =5
            X: =0
            Y: =0
            ZIndex: =0

            Button1_1 As button:
                BorderColor: =App.Theme.Colors.Primary
                Color: =App.Theme.Colors.PrimaryForeground
                DisabledBorderColor: =RGBA(244, 244, 244, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =DisplayMode.View
                Fill: =RGBA(255, 255, 255, 0.95)
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                Height: =234
                HoverBorderColor: =App.Theme.Colors.Darker10
                HoverColor: =App.Theme.Colors.PrimaryForeground
                HoverFill: =App.Theme.Colors.Darker10
                PressedBorderColor: =App.Theme.Colors.Darker40
                PressedColor: =Self.Color
                PressedFill: =App.Theme.Colors.Darker40
                RadiusBottomLeft: =30
                RadiusBottomRight: =30
                RadiusTopLeft: =30
                RadiusTopRight: =30
                Size: =15
                Text: =
                Width: =556
                X: =387
                Y: =267
                ZIndex: =1

            Label_lydohuy_8 As label:
                BorderColor: =App.Theme.Colors.Darker40
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =App.Theme.Font
                Height: =35
                Size: =16
                Text: ="Lý do huỷ"
                Width: =200
                X: =426
                Y: =310
                ZIndex: =2

            dr_lydohuy_1 As Dropdown.pcfdataset:
                AccessibleLabel: =""
                Appearance: ='DropdownCanvas.Appearance'.FilledDarker
                BorderStyle: =""
                ContentLanguage: =""
                DefaultSelectedItems: =First(Choices('Lý do chốt đơn (Sale Order Details)'))
                DisplayMode: =DisplayMode.Edit
                FontSize: =16
                Height: =40
                Items: =Choices('Lý do chốt đơn (Sale Order Details)')
                OnChange: =Reset(input_lydohuydon_1)
                Required: =true
                TabIndex: =0
                Tooltip: =""
                ValidationState: ="None"
                Visible: =true
                Width: =465
                X: =426
                Y: =353
                ZIndex: =3

            bt_xacnhan_1 As Button:
                AcceptsFocus: =true
                AccessibleLabel: =""
                Align: =""
                Appearance: ="Primary"
                BasePaletteColor: =
                BorderColor: =
                BorderRadius: =10
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =If(dr_lydohuy_1.Selected.Value = 'Lý do chốt đơn (Sale Order Details)'.'Lý do khác' And IsBlank(input_lydohuydon_1.Value),DisplayMode.Disabled,DisplayMode.Edit)
                Font: =Font.Arial
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =FontWeight.Semibold
                Height: =32
                Icon: =""
                IconRotation: =0
                IconStyle: ="Outline"
                Layout: ="Icon before"
                OnSelect: |-
                    =If(
                        formdata_selected.'Record SOD3'.'Trạng thái đơn hàng' = 'Trạng thái đơn hàng'.'Đơn hàng đã soạn',
                        Notify(
                            "Đơn hàng đã soạn không thể chốt đơn",
                            NotificationType.Error,
                            3000
                        ),
                        UpdateContext({ShowPopup_HuyDon: false});
                        //Update record collection 
                    RemoveIf(
                            formData_new,
                            STT = formdata_selected.STT
                        );
                        //deactive
                    Patch(
                            'Sale Order Details',
                            formdata_selected.'Record SOD3',
                            {
                                Status: 'Status (Sale Order Details)'.Inactive,
                                'Lý do chốt đơn': dr_lydohuy_1.Selected.Value,
                                'Ghi chú - chốt đơn': input_lydohuydon_1.Value
                            }
                        );
                        UpdateContext(
                            {
                                data_muakem: Filter(
                                    Promotion,
                                    (formdata_selected.'Mã sản phẩm' in 'Mã sản phẩm (mua kèm)' || formdata_selected.'Mã nhóm SP' in 'Mã nhóm sp (Mua kèm)') && Status = 'Status (Promotion)'.Active
                                )
                            }
                        );
                        ForAll(
                            data_muakem As data_muakem,
                            If(
                                (CountIf(
                                    List_Ma_SP_formdata,
                                    Text(Value) in data_muakem.'Mã sản phẩm (mua kèm)'
                                ) = 0 And !IsBlank(data_muakem.'Mã sản phẩm (mua kèm)')) || (CountIf(
                                    List_Ma_NSP_formdata,
                                    Text(Value) in data_muakem.'Mã nhóm sp (Mua kèm)'
                                ) = 0 And !IsBlank(data_muakem.'Mã nhóm sp (Mua kèm)')),
                                ForAll(
                                    Filter(
                                        formData_new,
                                        PromotionRecord.ID = data_muakem.ID
                                    ),
                                    Patch(
                                        formData_new,
                                        ThisRecord,
                                        {
                                            PromotionRecord: Blank(),
                                            'Giá đã giảm': ThisRecord.Giá,
                                            'Tổng tiền': ThisRecord.Giá + (ThisRecord.Giá * ThisRecord.VAT),
                                            '% Giảm giá': 0,
                                            Chietkhauphantram: 0,
                                            Chietkhautien: 0
                                        }
                                    );
                                );
                            )
                        );
                        // Update record collection với giá trị mới với trường hợp cộng dồn
                    With(
                            {
                                value: Sum(
                                    Filter(
                                        formData_new,
                                        PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes
                                    ),
                                    'Số lượng'
                                )
                            },
                            UpdateIf(
                                formData_new,
                                ThisRecord.PromotionRecord.'Promotion type (text)' = formdata_selected.PromotionRecord.'Promotion type (text)' && ThisRecord.PromotionRecord.'Cộng dồn số lượng' = 'Cộng dồn số lượng (Promotion)'.Yes,
                                With(
                                    {
                                        promoValue: If(
                                            !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng mức 3' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 3' = var_selected_dieukhoanthanhtoan_choice),
                                            ThisRecord.PromotionRecord.'Value 3',
                                            If(
                                                !IsBlank(ThisRecord.PromotionRecord.'Số lượng áp dụng') && value >= ThisRecord.PromotionRecord.'Số lượng áp dụng' && (IsBlank(ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2') Or ThisRecord.PromotionRecord.'Điều khoản thanh toán áp dụng mức 2' = var_selected_dieukhoanthanhtoan_choice),
                                                ThisRecord.PromotionRecord.'Value 2',
                                                ThisRecord.PromotionRecord.Value
                                            )
                                        ),
                                        Record: ThisRecord
                                    },
                                    With(
                                        {
                                            PPHD: If(
                                                cb_donhang_SO_new.Selected.'Loại hóa đơn' = 'Loại hóa đơn (Sale_Orders)'.'Hộ kinh doanh' And cb_donhang_SO_new.Selected.VAT = VAT_choice.'Không VAT',
                                                1.015,
                                                1
                                            ),
                                            Gia_da_chietkhau: If(
                                                Record.PromotionRecord.'VNĐ/% Text' = "VNĐ",
                                                Record.Giá - promoValue,
                                                Record.Giá * (1 - promoValue / 100)
                                            )
                                        },
                                        {
                                            '% Giảm giá': If(
                                                Record.PromotionRecord.'VNĐ/% Text' = "%",
                                                promoValue / 100,
                                                promoValue
                                            ),
                                            'Giá đã giảm': Gia_da_chietkhau * PPHD,
                                            'Tổng tiền': (Record.'Số lượng' * (Gia_da_chietkhau * PPHD)) + Record.VAT,
                                            Chietkhauphantram: If(
                                                Record.PromotionRecord.'VNĐ/% Text' = "%" && var_Nganh_nghe = "Shop",
                                                promoValue / 100,
                                                0
                                            ),
                                            Chietkhautien: If(
                                                Record.PromotionRecord.'VNĐ/% Text' = "VNĐ" && var_Nganh_nghe = "Shop",
                                                promoValue,
                                                0
                                            )
                                        }
                                    )
                                )
                            )
                        );
                        ClearCollect(
                            formData_new,
                            ForAll(
                                Sequence(
                                    CountRows(
                                        Sort(
                                            formData_new,
                                            STT,
                                            SortOrder.Ascending
                                        )
                                    )
                                ),
                                Patch(
                                    Last(
                                        FirstN(
                                            Sort(
                                                formData_new,
                                                STT,
                                                SortOrder.Ascending
                                            ),
                                            Value
                                        )
                                    ),
                                    {STT: Value}
                                )
                            )
                        );
                        //Lưu dataverse với giá mới
                    ForAll(
                            formData_new,
                            Patch(
                                'Sale Order Details',
                                formData_new[@'Record SOD3'],
                                {
                                    Giá: If(
                                        var_Nganh_nghe = "Shop",
                                        formData_new[@'Giá đã giảm'],
                                        formData_new[@Giá]
                                    ),
                                    //'Giá gốc': Value(formData_new[@Giá]),
                                    'Stt đơn': formData_new[@STT],
                                    'Chiết khấu %': formData_new[@Chietkhauphantram],
                                    'Chiết khấu VNĐ': formData_new[@Chietkhautien]
                                }
                            )
                        );
                        Notify(
                            "Cập nhật thành công",
                            NotificationType.Success,
                            2000
                        );
                        Clear(TanSuatKho);
                        ForAll(
                            formData_new As ColData,
                            ForAll(
                                var_filterkho As Kho,
                                If(
                                    CountRows(
                                        Filter(
                                            'Kho Bình Định',
                                            'Vị trí kho'.'Tên kho' = Kho.'Tên kho' && 'Tên sản phẩm'.'Tên sản phẩm' = ColData.'Tên sản phẩm' && 'Tồn kho lý thuyết - Bỏ mua' >= ColData.'Số lượng'
                                        )
                                    ) > 0,
                                    Collect(
                                        TanSuatKho,
                                        {
                                            TênSảnPhẩm: ColData.'Tên sản phẩm',
                                            SốLượng: ColData.'Số lượng',
                                            Kho: Kho.'Tên kho'
                                        }
                                    )
                                )
                            )
                        );
                        With(
                            {tempData: formData_new},
                            ForAll(
                                tempData As ColData,
                                Patch(
                                    formData_new,
                                    LookUp(
                                        formData_new,
                                        'Tên sản phẩm' = ColData.'Tên sản phẩm'
                                    ),
                                    {
                                        'Kho đáp ứng': LookUp(
                                            TanSuatKho,
                                            TênSảnPhẩm = ColData.'Tên sản phẩm',
                                            Kho
                                        )
                                    }
                                )
                            )
                        );
                        Reset(dr_lydohuy_1);
                        
                    )
                TabIndex: =0
                Text: ="Xác nhận"
                Tooltip: =""
                VerticalAlign: =""
                Visible: =true
                Width: =126
                X: =472 
                Y: =449
                ZIndex: =4

            bt_huy_5 As Button:
                AcceptsFocus: =true
                AccessibleLabel: =""
                Align: =""
                Appearance: =
                BasePaletteColor: =RGBA(189, 178, 176, 1)
                BorderColor: =
                BorderRadius: =10
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Arial
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =FontWeight.Semibold
                Height: =32
                Icon: =""
                IconRotation: =0
                IconStyle: ="Outline"
                Layout: ="Icon before"
                OnSelect: |-
                    =UpdateContext({ShowPopup_HuyDon:false});
                    Reset(dr_lydohuy_1);
                    Reset(input_lydohuydon_1);
                TabIndex: =0
                Text: ="Huỷ"
                Tooltip: =""
                VerticalAlign: =""
                Visible: =true
                Width: =126
                X: =726
                Y: =449
                ZIndex: =5

            "input_lydohuydon_1 As 'Text input'":
                AccessibleLabel: =""
                Align: =""
                Appearance: ="FilledDarker"
                BasePaletteColor: =
                BorderColor: =
                BorderStyle: =""
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Fill: =
                Font: =""
                FontColor: =
                FontItalic: =false
                FontSize: =16
                FontStrikethrough: =false
                FontUnderline: =false
                FontWeight: =""
                Height: =40
                MaxLength: =-1
                Mode: ="SingleLine"
                OnChange: =false
                Placeholder: ="Mô tả lý do"
                Required: =false
                TabIndex: =0
                Tooltip: =""
                TriggerOutput: ='TextInputCanvas.TriggerOutput'.Keypress
                Type: ="Text"
                ValidationState: ="None"
                Value: =""
                Visible: =If(dr_lydohuy_1.Selected.Value = 191920007,true,false)
                Width: =465
                X: =426
                Y: =400
                ZIndex: =6

            Label_lydohuy_9 As label:
                BorderColor: =App.Theme.Colors.Darker40
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =App.Theme.Font
                FontWeight: =FontWeight.Semibold
                Height: =35
                Size: =18
                Text: =formdata_selected.'Tên sản phẩm'
                Width: =500
                X: =419
                Y: =274
                ZIndex: =7

    PromotiOnder_1 As dataTable.datatable:
        BorderColor: =App.Theme.Colors.Darker40
        BorderStyle: =BorderStyle.Solid
        BorderThickness: =0
        Color: =RGBA(0, 0, 0, 1)
        ContentLanguage: =""
        DisabledColor: =RGBA(166, 166, 166, 1)
        DisplayMode: =DisplayMode.Edit
        Fill: =RGBA(255, 255, 255, 1)
        Font: =App.Theme.Font
        FontWeight: =FontWeight.Normal
        HeadingColor: =App.Theme.Colors.PrimaryForeground
        HeadingFill: =RGBA(4, 161, 179, 1)
        HeadingFont: =App.Theme.Font
        HeadingFontWeight: =FontWeight.Normal
        HeadingSize: =13
        Height: =213
        HoverColor: =RGBA(0, 0, 0, 1)
        HoverFill: =App.Theme.Colors.Lighter80
        InputFill: =RGBA(255, 255, 255, 1)
        InvertedColor: =App.Theme.Colors.PrimaryForeground
        Items: =OrderxPromotion_Order
        LinkColor: =App.Theme.Colors.Lighter10
        maximumHeight: =7680
        maximumWidth: =1366
        minimumHeight: =20
        minimumWidth: =20
        NoDataText: ="We didn't find any data to show at this time"
        PrimaryColor1: =App.Theme.Colors.Primary
        PrimaryColor2: =App.Theme.Colors.Darker30
        PrimaryColor3: =App.Theme.Colors.Lighter70
        SelectedColor: =RGBA(0, 0, 0, 1)
        SelectedFill: =App.Theme.Colors.Lighter70
        Size: =13
        UsePhoneLayout: =0
        Visible: =CountIf(OrderxPromotion_Order,true) > 0
        Width: =690
        X: =342
        Y: =246
        ZIndex: =7

        crdfd_promotiontext_Column2_1 As dataTableColumn.textualColumn:
            AutoWidth: =true
            ContentLanguage: =""
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Promotion"
            FieldName: ="crdfd_promotiontext"
            Height: =Parent.Height
            IsHyperlink: =false
            LayoutHeight: =Parent.Height
            LayoutWidth: =0
            LayoutX: =0
            LayoutY: =0
            OnSelect: =false
            Order: =1
            Text: =ThisItem.'Promotion text'
            Type: ="s"
            Visible: =true
            Width: =100
            X: =0
            Y: =0
            ZIndex: =1

        crdfd_chieckhau_Column2_1 As dataTableColumn.textualColumn:
            AutoWidth: =true
            ContentLanguage: =""
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Chiết khấu"
            FieldName: ="crdfd_chieckhau"
            Height: =Parent.Height
            IsHyperlink: =false
            LayoutHeight: =Parent.Height
            LayoutWidth: =0
            LayoutX: =0
            LayoutY: =0
            OnSelect: =false
            Order: =2
            Text: =ThisItem.'Chiết khấu cal'
            Type: ="s"
            Visible: =true
            Width: =100
            X: =0
            Y: =0
            ZIndex: =2

        crdfd_loaical_Column2_1 As dataTableColumn.textualColumn:
            AutoWidth: =true
            ContentLanguage: =""
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Loại"
            FieldName: ="crdfd_loaical"
            Height: =Parent.Height
            IsHyperlink: =false
            LayoutHeight: =Parent.Height
            LayoutWidth: =0
            LayoutX: =0
            LayoutY: =0
            OnSelect: =false
            Order: =3
            Text: =ThisItem.'Loại cal'
            Type: ="s"
            Visible: =true
            Width: =100
            X: =0
            Y: =0
            ZIndex: =3

