# Wecare E-commerce - Si√™u th·ªã c√¥ng nghi·ªáp

## üìã T·ªïng quan d·ª± √°n

Wecare E-commerce l√† m·ªôt h·ªá th·ªëng th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠ B2B chuy√™n bi·ªát d√†nh cho ng√†nh c√¥ng nghi·ªáp, ƒë∆∞·ª£c x√¢y d·ª±ng b·∫±ng **Next.js 14** v·ªõi **TypeScript**. H·ªá th·ªëng cung c·∫•p n·ªÅn t·∫£ng mua s·∫Øm tr·ª±c tuy·∫øn cho c√°c doanh nghi·ªáp v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng qu·∫£n l√Ω s·∫£n ph·∫©m, ƒë∆°n h√†ng, khuy·∫øn m√£i v√† h·ªá th·ªëng ph√¢n quy·ªÅn ng∆∞·ªùi d√πng ph·ª©c t·∫°p.

## üöÄ T√≠nh nƒÉng ch√≠nh

### üõçÔ∏è **E-commerce Core**
- **Catalog s·∫£n ph·∫©m**: Hi·ªÉn th·ªã danh m·ª•c s·∫£n ph·∫©m theo nh√≥m ng√†nh h√†ng
- **T√¨m ki·∫øm th√¥ng minh**: T√¨m ki·∫øm s·∫£n ph·∫©m v·ªõi autocomplete v√† filter
- **Gi·ªè h√†ng**: Qu·∫£n l√Ω gi·ªè h√†ng v·ªõi t√≠nh nƒÉng th√™m/x√≥a/c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
- **ƒê·∫∑t h√†ng**: H·ªá th·ªëng ƒë·∫∑t h√†ng v·ªõi x√°c nh·∫≠n v√† theo d√µi tr·∫°ng th√°i
- **Khuy·∫øn m√£i**: Qu·∫£n l√Ω v√† √°p d·ª•ng c√°c ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i

### üë• **Qu·∫£n l√Ω ng∆∞·ªùi d√πng**
- **ƒêƒÉng nh·∫≠p/ƒêƒÉng xu·∫•t**: X√°c th·ª±c ng∆∞·ªùi d√πng v·ªõi Microsoft Azure AD
- **Ph√¢n quy·ªÅn**: H·ªá th·ªëng ph√¢n quy·ªÅn ph·ª©c t·∫°p theo ch·ª©c v·ª• v√† ph√≤ng ban
- **Profile kh√°ch h√†ng**: Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n v√† l·ªãch s·ª≠ mua h√†ng

### üìä **Dashboard & Analytics**
- **L·ªãch s·ª≠ ƒë∆°n h√†ng**: Theo d√µi ƒë∆°n h√†ng ƒë√£ ƒë·∫∑t
- **L·ªãch s·ª≠ thanh to√°n**: Qu·∫£n l√Ω th√¥ng tin thanh to√°n
- **B√°o c√°o**: Dashboard cho nh√¢n vi√™n kinh doanh

### üéì **H·ªá th·ªëng ƒë√†o t·∫°o**
- **Qu·∫£n l√Ω kh√≥a h·ªçc**: T·∫°o v√† qu·∫£n l√Ω c√°c kh√≥a ƒë√†o t·∫°o
- **ƒê√°nh gi√°**: H·ªá th·ªëng ƒë√°nh gi√° v√† ch·∫•m ƒëi·ªÉm
- **Theo d√µi ti·∫øn ƒë·ªô**: Gi√°m s√°t qu√° tr√¨nh h·ªçc t·∫≠p
- **Training Auth Guard**: B·∫£o v·ªá c√°c trang ƒë√†o t·∫°o
- **Training Login Form**: Form ƒëƒÉng nh·∫≠p ri√™ng cho ƒë√†o t·∫°o

### üîç **T√¨m ki·∫øm n√¢ng cao**
- **T√¨m ki·∫øm b·∫±ng h√¨nh ·∫£nh**: Upload h√¨nh ·∫£nh ƒë·ªÉ t√¨m s·∫£n ph·∫©m t∆∞∆°ng t·ª±
- **T√¨m ki·∫øm t·ª´ kh√≥a**: T√¨m ki·∫øm th√¥ng minh v·ªõi autocomplete
- **T√¨m ki·∫øm theo URL**: T√¨m s·∫£n ph·∫©m t·ª´ URL
- **Vector Database**: H·ªó tr·ª£ t√¨m ki·∫øm semantic

### üì± **T√≠nh nƒÉng UI/UX**
- **Responsive Design**: T·ªëi ∆∞u cho m·ªçi thi·∫øt b·ªã
- **Dark/Light Mode**: Ch·∫ø ƒë·ªô s√°ng/t·ªëi
- **Toast Notifications**: Th√¥ng b√°o real-time
- **Loading States**: Tr·∫°ng th√°i loading m∆∞·ª£t m√†
- **Error Boundaries**: X·ª≠ l√Ω l·ªói graceful
- **Floating Zalo**: Widget chat Zalo
- **Google Tag Manager**: Analytics v√† tracking

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

### **Frontend Stack**
- **Next.js 14.2.7**: Framework React v·ªõi App Router
- **TypeScript 5.8.2**: Type-safe development
- **Tailwind CSS 3.4.1**: Utility-first CSS framework
- **Material-UI 5.15.11**: Component library
- **Framer Motion 12.15.0**: Animation library
- **React 18**: UI library
- **Styled Components 6.1.13**: CSS-in-JS styling
- **React Icons 5.5.0**: Icon library
- **Lucide React 0.344.0**: Modern icon set
- **Heroicons 2.2.0**: Tailwind icon library

### **Backend Integration**
- **Microsoft Dynamics CRM**: H·ªá th·ªëng qu·∫£n l√Ω kh√°ch h√†ng
- **Azure Blob Storage 12.26.0**: L∆∞u tr·ªØ file v√† h√¨nh ·∫£nh
- **Azure AD (MSAL) 2.13.0**: X√°c th·ª±c v√† ph√¢n quy·ªÅn
- **Axios 1.7.7**: HTTP client
- **Pino 9.4.0**: Structured logging
- **Multer 2.0.2**: File upload handling

### **State Management & Performance**
- **React Context**: Global state management
- **Local Storage**: Client-side data persistence
- **LRU Cache 11.0.2**: In-memory caching
- **Node Cache 5.1.2**: Server-side caching
- **P-limit 6.1.0**: Concurrency control
- **Use Debounce 10.0.4**: Input debouncing

## üìÅ C·∫•u tr√∫c d·ª± √°n

```
wecare-ecommerce/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                          # App Router (Next.js 14)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [...slug]/               # Dynamic catch-all routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [masanpham]/             # Product detail pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                     # API routes (Next.js 14)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customer/                # Customer management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daotao/                  # Training system
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ debug-info/              # Debug information
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ demo/                    # Demo pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history-order/           # Order history
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history-payment/         # Payment history
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image-filter-demo/       # Image filtering demo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/                   # Authentication
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ new-arrivals/            # New products
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post/                    # Blog posts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ price-by-customer/       # Customer pricing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product-catalog/         # Product catalog
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product-list/            # Product listing (26 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product-list-example/    # Product list examples
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile-customer/        # Customer profile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promotion/               # Promotions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sale-orders/             # Sales orders
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ san-pham/                # Product pages (9 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-siderbar/           # Sidebar testing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ thong-tin-thanh-toan-cong-ty/ # Company payment info
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tim-kiem-bang-hinh-anh/  # Image search
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ top-san-pham-ban-chay/   # Top selling products
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tuyen-dung/              # Recruitment
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.ts                # App configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css              # Global styles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Root layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loading.tsx              # Loading component
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ not-found.tsx            # 404 page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                 # Home page
‚îÇ   ‚îú‚îÄ‚îÄ assets/                      # Static assets
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img/                     # Images (15 files)
‚îÇ   ‚îú‚îÄ‚îÄ components/                   # Reusable components (68 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ component_Header/        # Header components (8 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shadcn/                  # Shadcn UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                      # UI components (13 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddToCartWithPromotion.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BusinessOpportunitySection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CartGlobalManager.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CartManager.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategorySection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EvaluationForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FloatingZalo.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ footer.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GTMAlternative.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HeroSection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LatestProductsSection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PermissionGuard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromotionPopup.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromotionsSection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ToastManager.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (other components)
‚îÇ   ‚îú‚îÄ‚îÄ constants/                   # Application constants
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.ts
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                       # Custom hooks (8 files)
‚îÇ   ‚îú‚îÄ‚îÄ lib/                         # Utility libraries
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gtm.ts                   # Google Tag Manager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware.ts                # Next.js middleware
‚îÇ   ‚îú‚îÄ‚îÄ model/                       # Data models & interfaces (45 files)
‚îÇ   ‚îú‚îÄ‚îÄ types/                       # TypeScript type definitions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toast.ts
‚îÇ   ‚îî‚îÄ‚îÄ utils/                       # Helper functions (16 files)
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ api/                         # Legacy API routes (40+ endpoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                    # Authentication APIs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trainingLogin.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productGroups/           # Product group APIs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ getCustomerData.ts       # Customer data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ getProductData.ts        # Product data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ getPromotionData.ts      # Promotion data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ searchProductsByImage.ts # Image search
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uploadFile.ts            # File upload
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (other API endpoints)
‚îÇ   ‚îî‚îÄ‚îÄ test-upload.tsx              # Upload testing
‚îú‚îÄ‚îÄ public/                          # Static assets
‚îÇ   ‚îú‚îÄ‚îÄ images/                      # Image assets
‚îÇ   ‚îú‚îÄ‚îÄ pdfjs/                       # PDF.js library
‚îÇ   ‚îú‚îÄ‚îÄ Logo-Wecare.png
‚îÇ   ‚îú‚îÄ‚îÄ logo.svg
‚îÇ   ‚îî‚îÄ‚îÄ ... (other static files)
‚îú‚îÄ‚îÄ components/                      # Legacy components
‚îÇ   ‚îú‚îÄ‚îÄ TrainingAuthGuard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ TrainingLoginForm.tsx
‚îú‚îÄ‚îÄ data/                            # Data storage
‚îÇ   ‚îî‚îÄ‚îÄ vector-db/                   # Vector database
‚îú‚îÄ‚îÄ docker-compose.yml               # Docker configuration
‚îú‚îÄ‚îÄ Dockerfile                       # Docker image
‚îú‚îÄ‚îÄ next.config.mjs                  # Next.js configuration
‚îú‚îÄ‚îÄ package.json                     # Dependencies
‚îú‚îÄ‚îÄ tailwind.config.ts               # Tailwind CSS config
‚îú‚îÄ‚îÄ tsconfig.json                    # TypeScript config
‚îî‚îÄ‚îÄ README.md                        # This file
```

## üîß API Endpoints

### **S·∫£n ph·∫©m & Catalog**
- `GET /api/getProductData` - L·∫•y danh s√°ch s·∫£n ph·∫©m
- `GET /api/getProductGroup` - L·∫•y nh√≥m s·∫£n ph·∫©m
- `GET /api/getProductsByGroupCode` - S·∫£n ph·∫©m theo nh√≥m
- `GET /api/getTop30ProductsWithPromotion` - Top s·∫£n ph·∫©m khuy·∫øn m√£i

### **Kh√°ch h√†ng & ƒê∆°n h√†ng**
- `GET /api/getCustomerData` - Th√¥ng tin kh√°ch h√†ng
- `GET /api/getDataDathangSO` - L·ªãch s·ª≠ ƒë·∫∑t h√†ng
- `POST /api/postDataDathangSO` - T·∫°o ƒë∆°n h√†ng m·ªõi
- `GET /api/getSaleOrdersData` - D·ªØ li·ªáu ƒë∆°n b√°n h√†ng

### **Khuy·∫øn m√£i**
- `GET /api/getAllPromotions` - T·∫•t c·∫£ khuy·∫øn m√£i
- `GET /api/getPromotionData` - Chi ti·∫øt khuy·∫øn m√£i
- `GET /api/getPromotionProducts` - S·∫£n ph·∫©m khuy·∫øn m√£i

### **Nh√¢n vi√™n & Ph√¢n quy·ªÅn**
- `GET /api/getEmployeData` - Th√¥ng tin nh√¢n vi√™n
- `POST /api/auth/trainingLogin` - ƒêƒÉng nh·∫≠p ƒë√†o t·∫°o

### **ƒê√†o t·∫°o**
- `GET /api/getDaoTaoData` - D·ªØ li·ªáu ƒë√†o t·∫°o
- `GET /api/getDanhSachHocVien` - Danh s√°ch h·ªçc vi√™n
- `POST /api/submitEvaluation` - N·ªôp b√†i ƒë√°nh gi√°

### **Tuy·ªÉn d·ª•ng**
- `GET /api/getPositionData` - V·ªã tr√≠ tuy·ªÉn d·ª•ng
- `POST /api/submitApplication` - N·ªôp ƒë∆°n ·ª©ng tuy·ªÉn

### **File & Upload**
- `POST /api/uploadFile` - Upload file l√™n Azure Blob
- `DELETE /api/deleteFile` - X√≥a file

### **T√¨m ki·∫øm & AI**
- `POST /api/searchProductsByImage` - T√¨m ki·∫øm s·∫£n ph·∫©m b·∫±ng h√¨nh ·∫£nh
- `GET /api/searchProductsByKeywords` - T√¨m ki·∫øm s·∫£n ph·∫©m b·∫±ng t·ª´ kh√≥a
- `GET /api/searchProductByUrl` - T√¨m ki·∫øm s·∫£n ph·∫©m theo URL
- `GET /api/testNilonSearch` - Test t√¨m ki·∫øm Nilon
- `GET /api/testSynonymsSearch` - Test t√¨m ki·∫øm t·ª´ ƒë·ªìng nghƒ©a

### **Debug & Testing**
- `GET /api/debugProductGroup` - Debug th√¥ng tin nh√≥m s·∫£n ph·∫©m
- `GET /api/testProducts` - Test API s·∫£n ph·∫©m
- `GET /api/testSearch` - Test t√¨m ki·∫øm
- `GET /api/countCustomer` - ƒê·∫øm s·ªë l∆∞·ª£ng kh√°ch h√†ng
- `GET /api/countProducts` - ƒê·∫øm s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
- `GET /api/countProductGroups` - ƒê·∫øm s·ªë l∆∞·ª£ng nh√≥m s·∫£n ph·∫©m
- `GET /api/checkDuplicate` - Ki·ªÉm tra tr√πng l·∫∑p

## üîê H·ªá th·ªëng ph√¢n quy·ªÅn

H·ªá th·ªëng s·ª≠ d·ª•ng ph√¢n quy·ªÅn d·ª±a tr√™n **ch·ª©c v·ª•** v√† **ph√≤ng ban**:

### **Permission Types**
- **ONLINE**: Ch·ªâ xem gi√°, kh√¥ng ƒë·∫∑t h√†ng
- **DIRECT**: Xem gi√° v√† ƒë·∫∑t h√†ng
- **NONE**: Kh√¥ng c√≥ quy·ªÅn ƒë·∫∑c bi·ªát

### **Sales Flow**
- **ITEM_PRICE_BY_CUSTOMER**: Lu·ªìng xem gi√° theo kh√°ch h√†ng
- **SALE_ORDER**: Lu·ªìng ƒë·∫∑t h√†ng tr·ª±c ti·∫øp

### **Ch·ª©c v·ª• c√≥ quy·ªÅn ƒë·∫∑c bi·ªát**

#### **Online Permission (283640045)**
- Tr∆∞·ªüng ph√≤ng Ph√°t tri·ªÉn Kinh doanh (283640049)
- Tr∆∞·ªüng nh√≥m Kinh doanh Online (283640073)
- Gi√°m s√°t Kinh doanh Online (283640051)
- Chuy√™n vi√™n Kinh doanh Online (283640056)
- **Nh√¢n vi√™n Kinh doanh Online (283640045)**
- Sales Admin Kinh doanh Online (283640072)

#### **Direct Permission**
- Tr∆∞·ªüng nh√≥m khu v·ª±c Kinh doanh b√°n l·∫ª (283640032)
- Gi√°m s√°t v√πng Kinh doanh b√°n l·∫ª (283640033)
- Nh√¢n vi√™n Kinh doanh b√°n l·∫ª (283640034)
- Qu·∫£n l√Ω ƒê·ªôi ng≈© hi·ªán tr∆∞·ªùng (283640089)

### **Permission Logic Flow**
```typescript
// Lu·ªìng ki·ªÉm tra permission
const permission = getPermissionByChucVu(chucVuVi);

if (chucVuVi === 283640045) {
  // Nh√¢n vi√™n Kinh doanh Online -> Price by Customer
  return {
    type: 'ONLINE',
    canViewPrice: true,
    canCreateOrder: false,
    salesFlow: 'ITEM_PRICE_BY_CUSTOMER'
  };
} else if (directPermissionRoles.includes(chucVuVi)) {
  // Nh√¢n vi√™n b√°n l·∫ª -> Sale Order
  return {
    type: 'DIRECT', 
    canViewPrice: true,
    canCreateOrder: true,
    salesFlow: 'SALE_ORDER'
  };
}
```

Chi ti·∫øt xem file: [PERMISSION_SYSTEM.md](./PERMISSION_SYSTEM.md)

## üîÑ Lu·ªìng nghi·ªáp v·ª• ch√≠nh

### **1. Lu·ªìng ƒêƒÉng nh·∫≠p & X√°c th·ª±c**

```mermaid
graph TD
    A[User truy c·∫≠p /login] --> B[Nh·∫≠p email + password]
    B --> C{Ki·ªÉm tra email format}
    C -->|Email| D[G·ªçi API /getEmployeData]
    C -->|Kh√¥ng ph·∫£i email| E[G·ªçi API /getCustomerData]
    
    D --> F{Password = phone?}
    F -->|ƒê√∫ng| G[L∆∞u th√¥ng tin sale v√†o localStorage]
    F -->|Sai| H[Hi·ªÉn th·ªã l·ªói]
    
    E --> I{Password ƒë√∫ng?}
    I -->|ƒê√∫ng| J[L∆∞u th√¥ng tin customer v√†o localStorage]
    I -->|Sai| H
    
    G --> K{Ki·ªÉm tra ph√≤ng ban ƒë·∫∑c bi·ªát?}
    K -->|C√≥| L[√Åp d·ª•ng permission ƒë·∫∑c bi·ªát]
    K -->|Kh√¥ng| M[Permission m·∫∑c ƒë·ªãnh]
    
    L --> N[Redirect v·ªÅ trang ch·ªß]
    M --> N
    J --> N
```

### **2. Lu·ªìng Ph√¢n quy·ªÅn Truy c·∫≠p**

```mermaid
graph TD
    A[User ƒë√£ ƒëƒÉng nh·∫≠p] --> B{Ki·ªÉm tra userType}
    B -->|sale| C{Ki·ªÉm tra departmentId}
    B -->|customer| D[Quy·ªÅn customer th∆∞·ªùng]
    
    C -->|191920005| E{Ki·ªÉm tra chucVuVi}
    C -->|Kh√°c| F[Quy·ªÅn sale th∆∞·ªùng]
    
    E -->|283640045| G[ONLINE Permission]
    E -->|283640032,33,34,89| H[DIRECT Permission] 
    E -->|Kh√°c| I[ONLINE Permission kh√°c]
    
    G --> J[Ch·ªâ xem gi√° - Price by Customer]
    H --> K[Xem gi√° + ƒê·∫∑t h√†ng - Sale Order]
    I --> J
    
    J --> L[Redirect /price-by-customer]
    K --> M[Redirect /sale-orders]
```

### **3. Lu·ªìng Mua s·∫Øm E-commerce**

```mermaid
graph TD
    A[Trang ch·ªß] --> B[Duy·ªát danh m·ª•c s·∫£n ph·∫©m]
    B --> C[Ch·ªçn nh√≥m s·∫£n ph·∫©m]
    C --> D[Xem danh s√°ch s·∫£n ph·∫©m]
    D --> E[Xem chi ti·∫øt s·∫£n ph·∫©m]
    
    E --> F{Th√™m v√†o gi·ªè h√†ng}
    F -->|C√≥| G[C·∫≠p nh·∫≠t gi·ªè h√†ng]
    F -->|Kh√¥ng| H[Ti·∫øp t·ª•c mua s·∫Øm]
    
    G --> I[Xem gi·ªè h√†ng]
    I --> J{Checkout}
    J -->|Customer| K[T·∫°o ƒë∆°n h√†ng tr·ª±c ti·∫øp]
    J -->|Sale Online| L[G·ª≠i y√™u c·∫ßu b√°o gi√°]
    J -->|Sale Direct| K
    
    K --> M[X√°c nh·∫≠n ƒë∆°n h√†ng]
    L --> N[Ch·ªù ph√™ duy·ªát gi√°]
    
    M --> O[Theo d√µi ƒë∆°n h√†ng]
    N --> P[Ph√™ duy·ªát gi√°] --> M
```

### **4. Lu·ªìng Qu·∫£n l√Ω ƒê∆°n h√†ng (Sale)**

```mermaid
graph TD
    A[Sale ƒëƒÉng nh·∫≠p] --> B{Permission type}
    B -->|ONLINE| C[Truy c·∫≠p Price by Customer]
    B -->|DIRECT| D[Truy c·∫≠p Sale Orders]
    
    C --> E[Ch·ªçn kh√°ch h√†ng]
    E --> F[Xem gi√° s·∫£n ph·∫©m theo kh√°ch h√†ng]
    F --> G[T∆∞ v·∫•n gi√° cho kh√°ch h√†ng]
    
    D --> H[Tab Sale Order]
    D --> I[Tab Sale Confirm]
    
    H --> J[Ch·ªçn kh√°ch h√†ng]
    J --> K[T·∫°o ƒë∆°n h√†ng]
    K --> L[Th√™m s·∫£n ph·∫©m v√†o ƒë∆°n]
    L --> M[G·ª≠i ƒë∆°n h√†ng]
    
    I --> N[Xem ƒë∆°n h√†ng ch·ªù x√°c nh·∫≠n]
    N --> O[Duy·ªát/T·ª´ ch·ªëi ƒë∆°n h√†ng]
    O --> P[C·∫≠p nh·∫≠t tr·∫°ng th√°i]
```

### **5. Lu·ªìng Khuy·∫øn m√£i & T√≠nh gi√° chi ti·∫øt**

```mermaid
graph TD
    A[H·ªá th·ªëng t·∫£i khuy·∫øn m√£i] --> B[L∆∞u cache promotionData]
    B --> C[User xem s·∫£n ph·∫©m]
    C --> D{S·∫£n ph·∫©m c√≥ khuy·∫øn m√£i?}
    
    D -->|C√≥| E[Hi·ªÉn th·ªã badge khuy·∫øn m√£i]
    D -->|Kh√¥ng| F[Hi·ªÉn th·ªã gi√° th∆∞·ªùng]
    
    E --> G[Click xem chi ti·∫øt KM]
    G --> H[Modal hi·ªÉn th·ªã th√¥ng tin KM]
    H --> I{Th√™m v√†o gi·ªè h√†ng}
    
    I -->|C√≥| J[√Åp d·ª•ng gi√° khuy·∫øn m√£i]
    I -->|Kh√¥ng| K[ƒê√≥ng modal]
    
    J --> L[T√≠nh to√°n gi√° cu·ªëi]
    L --> M[Hi·ªÉn th·ªã trong gi·ªè h√†ng]
```

#### **üéØ C√°c lo·∫°i Khuy·∫øn m√£i (Chi ti·∫øt ƒë·∫ßy ƒë·ªß)**

**1. Khuy·∫øn m√£i theo S·ªë l∆∞·ª£ng (Quantity-based) - 3 m·ª©c**
```typescript
interface QuantityPromotion {
  // C·∫•u h√¨nh c∆° b·∫£n
  crdfd_name: string,                    // T√™n khuy·∫øn m√£i
  crdfd_conditions?: string,             // ƒêi·ªÅu ki·ªán khuy·∫øn m√£i
  congdonsoluong: true,                  // C√≥ c·ªông d·ªìn s·ªë l∆∞·ª£ng
  
  // 3 m·ª©c gi√° khuy·∫øn m√£i
  value: number,                         // Gi√° tr·ªã KM m·ª©c 1 (m·∫∑c ƒë·ªãnh)
  value2: number,                        // Gi√° tr·ªã KM m·ª©c 2
  value3?: number,                       // Gi√° tr·ªã KM m·ª©c 3 (t√πy ch·ªçn)
  
  // ƒêi·ªÅu ki·ªán s·ªë l∆∞·ª£ng
  soluongapdung: number,                 // S·ªë l∆∞·ª£ng ƒë·ªÉ l√™n m·ª©c 2
  soluongapdungmuc3?: number,            // S·ªë l∆∞·ª£ng ƒë·ªÉ l√™n m·ª©c 3
  
  // Lo·∫°i gi·∫£m gi√°
  vn: "191920000" | "191920001",         // 191920000=%, 191920001=ti·ªÅn
  
  // Th·ªùi gian hi·ªáu l·ª±c
  crdfd_start_date: string,              // Ng√†y b·∫Øt ƒë·∫ßu
  crdfd_end_date: string,                // Ng√†y k·∫øt th√∫c
  
  // √Åp d·ª•ng cho s·∫£n ph·∫©m/nh√≥m
  crdfd_masanpham_multiple?: string,     // Danh s√°ch m√£ SP (ph√¢n c√°ch b·∫±ng ,)
  crdfd_multiple_manhomsp?: string,      // Danh s√°ch m√£ nh√≥m SP
}

// Logic √°p d·ª•ng chi ti·∫øt:
const calculateQuantityBasedPromotion = (promotion, totalQuantity) => {
  let appliedValue, level;
  
  if (promotion.value3 && totalQuantity >= promotion.soluongapdungmuc3) {
    appliedValue = promotion.value3;
    level = 3;
    status = `ƒê·∫°t m·ª©c 3: Mua t·ª´ ${promotion.soluongapdungmuc3} s·∫£n ph·∫©m`;
  } else if (promotion.value2 && totalQuantity >= promotion.soluongapdung) {
    appliedValue = promotion.value2;
    level = 2;
    const nextLevel = promotion.soluongapdungmuc3 - totalQuantity;
    status = `ƒê·∫°t m·ª©c 2: Mua th√™m ${nextLevel} ƒë·ªÉ l√™n m·ª©c 3`;
  } else {
    appliedValue = promotion.value;
    level = 1;
    const nextLevel = promotion.soluongapdung - totalQuantity;
    status = `M·ª©c 1: Mua th√™m ${nextLevel} ƒë·ªÉ l√™n m·ª©c 2`;
  }
  
  return { appliedValue, level, status };
};
```

**2. Khuy·∫øn m√£i theo T·ªïng ti·ªÅn (Amount-based)**
```typescript
interface AmountPromotion {
  // ƒêi·ªÅu ki·ªán t·ªïng ti·ªÅn
  tongTienApDung: number,                // T·ªïng ti·ªÅn t·ªëi thi·ªÉu (VND)
  productCodes: string[],                // Danh s√°ch m√£ SP √°p d·ª•ng
  
  // 2 m·ª©c gi√°
  value: number,                         // Gi√° tr·ªã KM khi < tongTienApDung
  value2: number,                        // Gi√° tr·ªã KM khi >= tongTienApDung
  
  // Lo·∫°i gi·∫£m gi√°
  vn: "191920000" | "191920001",         // % ho·∫∑c ti·ªÅn
  
  // Th√¥ng tin b·ªï sung
  crdfd_conditions: string,              // M√¥ t·∫£ ƒëi·ªÅu ki·ªán
  crdfd_name: string,                    // T√™n khuy·∫øn m√£i
}

// Logic t√≠nh to√°n:
const calculateAmountBasedPromotion = (promotion, cartItems) => {
  // T√≠nh t·ªïng ti·ªÅn c·ªßa c√°c s·∫£n ph·∫©m trong danh s√°ch
  const applicableItems = cartItems.filter(item => 
    promotion.productCodes.includes(item.productId)
  );
  
  const totalAmount = applicableItems.reduce((sum, item) => 
    sum + (parseFloat(item.price) * item.quantity), 0
  );
  
  // X√°c ƒë·ªãnh m·ª©c gi·∫£m gi√°
  const isLevel2 = totalAmount >= promotion.tongTienApDung;
  const appliedValue = isLevel2 ? promotion.value2 : promotion.value;
  
  // T√≠nh progress
  const progress = Math.min((totalAmount / promotion.tongTienApDung) * 100, 100);
  const remainingAmount = Math.max(promotion.tongTienApDung - totalAmount, 0);
  
  return {
    appliedValue,
    level: isLevel2 ? 2 : 1,
    totalAmount,
    progress,
    remainingAmount,
    status: isLevel2 
      ? `ƒê·∫°t m·ª©c 2: T·ªïng ti·ªÅn ${totalAmount.toLocaleString()} VND`
      : `M·ª©c 1: Mua th√™m ${remainingAmount.toLocaleString()} VND ƒë·ªÉ l√™n m·ª©c 2`
  };
};
```

**3. Khuy·∫øn m√£i Mua k√®m (Bundle Promotion)**
```typescript
interface BundlePromotion {
  // S·∫£n ph·∫©m ch√≠nh (ƒë∆∞·ª£c gi·∫£m gi√°)
  crdfd_masanpham_multiple: string,      // M√£ s·∫£n ph·∫©m ch√≠nh
  crdfd_tensanpham_multiple: string,     // T√™n s·∫£n ph·∫©m ch√≠nh
  
  // S·∫£n ph·∫©m mua k√®m (ƒëi·ªÅu ki·ªán)
  maSanPhamMuaKem: string,               // M√£ SP ph·∫£i mua k√®m
  tenSanPhamMuaKem: string,              // T√™n SP mua k√®m
  maNhomSPMuaKem?: string,               // Ho·∫∑c m√£ nh√≥m SP mua k√®m
  tenNhomSPMuaKem?: string,              // T√™n nh√≥m SP mua k√®m
  
  // Gi√° tr·ªã khuy·∫øn m√£i
  value: number,                         // Gi√° tr·ªã gi·∫£m cho SP ch√≠nh
  vn: "191920000" | "191920001",         // % ho·∫∑c ti·ªÅn
  
  // Th√¥ng tin khuy·∫øn m√£i
  crdfd_name: string,                    // T√™n KM
  crdfd_conditions: string,              // ƒêi·ªÅu ki·ªán chi ti·∫øt
}

// Logic ki·ªÉm tra ph·ª©c t·∫°p:
const checkBundlePromotion = (promotion, cartItems, mainProductId) => {
  // 1. Ki·ªÉm tra s·∫£n ph·∫©m ch√≠nh c√≥ trong gi·ªè kh√¥ng
  const mainProduct = cartItems.find(item => 
    item.productId === mainProductId
  );
  
  if (!mainProduct) return { eligible: false, reason: "Kh√¥ng c√≥ s·∫£n ph·∫©m ch√≠nh" };
  
  // 2. Ki·ªÉm tra s·∫£n ph·∫©m mua k√®m
  const requiredProducts = promotion.maSanPhamMuaKem.split(',').map(code => code.trim());
  const requiredGroups = promotion.maNhomSPMuaKem?.split(',').map(code => code.trim()) || [];
  
  const hasBundledProduct = cartItems.some(item => {
    // Ki·ªÉm tra theo m√£ s·∫£n ph·∫©m
    if (requiredProducts.includes(item.productId)) return true;
    
    // Ki·ªÉm tra theo nh√≥m s·∫£n ph·∫©m
    if (requiredGroups.includes(item.productGroupCode)) return true;
    
    return false;
  });
  
  if (!hasBundledProduct) {
    return { 
      eligible: false, 
      reason: `C·∫ßn mua k√®m: ${promotion.tenSanPhamMuaKem}`,
      requiredProducts: promotion.tenSanPhamMuaKem
    };
  }
  
  return { eligible: true, appliedValue: promotion.value };
};
```

**4. Khuy·∫øn m√£i theo Nh√≥m kh√°ch h√†ng (Customer Group)**
```typescript
interface CustomerGroupPromotion {
  // Nh√≥m kh√°ch h√†ng
  _crdfd_customergroup_value: string,    // ID nh√≥m kh√°ch h√†ng
  crdfd_customergrouptext: string,       // T√™n nh√≥m kh√°ch h√†ng
  
  // Kh√°ch h√†ng c·ª• th·ªÉ (t√πy ch·ªçn)
  cr3b9_ma_khachhang_apdung?: string,    // Danh s√°ch m√£ KH (ph√¢n c√°ch b·∫±ng ,)
  
  // ƒêi·ªÅu ki·ªán thanh to√°n
  ieuKhoanThanhToanApDung?: string,      // ƒêi·ªÅu ki·ªán thanh to√°n
  
  // Gi√° tr·ªã khuy·∫øn m√£i
  value: number,
  vn: "191920000" | "191920001",
  
  // Lo·∫°i khuy·∫øn m√£i
  crdfd_type: "Product" | "Order" | "Revenue",
}

// Logic ki·ªÉm tra quy·ªÅn:
const checkCustomerEligibility = async (customerId, promotion) => {
  // 1. L·∫•y th√¥ng tin nh√≥m kh√°ch h√†ng
  const customerGroups = await getCustomerGroups(customerId);
  const customerGroupIds = customerGroups.map(g => g.customerGroupId);
  
  // 2. Ki·ªÉm tra nh√≥m kh√°ch h√†ng
  const isGroupEligible = !promotion._crdfd_customergroup_value || 
    customerGroupIds.includes(promotion._crdfd_customergroup_value);
  
  // 3. Ki·ªÉm tra kh√°ch h√†ng c·ª• th·ªÉ (n·∫øu c√≥)
  let isCustomerSpecific = true;
  if (promotion.cr3b9_ma_khachhang_apdung) {
    const allowedCustomers = promotion.cr3b9_ma_khachhang_apdung.split(',')
      .map(code => code.trim());
    const customerCode = await getCustomerCode(customerId);
    isCustomerSpecific = allowedCustomers.includes(customerCode);
  }
  
  return {
    eligible: isGroupEligible && isCustomerSpecific,
    customerGroups,
    reason: !isGroupEligible ? "Nh√≥m kh√°ch h√†ng kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán" :
            !isCustomerSpecific ? "Kh√°ch h√†ng kh√¥ng trong danh s√°ch √°p d·ª•ng" : null
  };
};
```

**5. Khuy·∫øn m√£i c√≥ ƒêi·ªÅu ki·ªán ƒë·∫∑c bi·ªát**
```typescript
interface ConditionalPromotion {
  // ƒêi·ªÅu ki·ªán lo·∫°i b·ªè
  cr3b9_loaibopromotionname?: "yes" | "no", // Lo·∫°i b·ªè promotion
  
  // ƒêi·ªÅu ki·ªán th·ªùi gian
  crdfd_start_date: string,                 // Ng√†y b·∫Øt ƒë·∫ßu
  crdfd_end_date: string,                   // Ng√†y k·∫øt th√∫c
  
  // Tr·∫°ng th√°i
  statecode: 0 | 1,                         // 0=Active, 1=Inactive
  crdfd_promotion_deactive: "Active" | "Inactive",
  
  // Lo·∫°i khuy·∫øn m√£i
  crdfd_type: "Product" | "Order" | "Revenue",
  
  // ƒêi·ªÅu ki·ªán t√πy ch·ªânh
  crdfd_conditions?: string,                // M√¥ t·∫£ ƒëi·ªÅu ki·ªán
  
  // ∆Øu ti√™n
  crdfd_priority?: number,                  // ƒê·ªô ∆∞u ti√™n (s·ªë cao h∆°n = ∆∞u ti√™n h∆°n)
}

// Logic ki·ªÉm tra ƒëi·ªÅu ki·ªán:
const validatePromotionConditions = (promotion, context) => {
  // 1. Ki·ªÉm tra lo·∫°i b·ªè promotion
  if (context.productPricing?.some(p => p.cr3b9_loaibopromotionname === "yes")) {
    return { valid: false, reason: "S·∫£n ph·∫©m ƒë∆∞·ª£c lo·∫°i b·ªè kh·ªèi khuy·∫øn m√£i" };
  }
  
  // 2. Ki·ªÉm tra th·ªùi gian
  const now = new Date();
  const startDate = new Date(promotion.crdfd_start_date);
  const endDate = new Date(promotion.crdfd_end_date);
  
  if (now < startDate) {
    return { valid: false, reason: "Khuy·∫øn m√£i ch∆∞a b·∫Øt ƒë·∫ßu" };
  }
  
  if (now > endDate) {
    return { valid: false, reason: "Khuy·∫øn m√£i ƒë√£ k·∫øt th√∫c" };
  }
  
  // 3. Ki·ªÉm tra tr·∫°ng th√°i
  if (promotion.statecode !== 0 || promotion.crdfd_promotion_deactive !== "Active") {
    return { valid: false, reason: "Khuy·∫øn m√£i kh√¥ng ho·∫°t ƒë·ªông" };
  }
  
  // 4. Ki·ªÉm tra lo·∫°i khuy·∫øn m√£i
  if (promotion.crdfd_type === "Order" && context.orderType !== "sale_order") {
    return { valid: false, reason: "Khuy·∫øn m√£i ch·ªâ √°p d·ª•ng cho ƒë∆°n h√†ng" };
  }
  
  return { valid: true };
};
```

#### **üí∞ Logic t√≠nh gi√° Khuy·∫øn m√£i**

```typescript
// H√†m t√≠nh gi√° ch√≠nh
const calculatePromotionPrice = (
  originalPrice: number,
  promotion: Promotion,
  totalQuantity: number,
  cartItems?: CartItem[]
) => {
  // 1. ∆Øu ti√™n ki·ªÉm tra tongTienApDung
  if (promotion.tongTienApDung && promotion.productCodes) {
    const totalValue = cartItems
      .filter(item => promotion.productCodes.includes(item.productId))
      .reduce((sum, item) => sum + (item.price * item.quantity), 0);
    
    const appliedValue = totalValue >= promotion.tongTienApDung 
      ? promotion.value2 
      : promotion.value;
    
    return applyDiscountValue(originalPrice, appliedValue, promotion.vn);
  }

  // 2. Ki·ªÉm tra s·∫£n ph·∫©m mua k√®m
  if (promotion.maSanPhamMuaKem) {
    const hasBundledProduct = cartItems?.some(item => 
      promotion.maSanPhamMuaKem.includes(item.productId)
    );
    
    if (!hasBundledProduct) {
      return originalPrice; // Kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán
    }
  }

  // 3. Logic theo s·ªë l∆∞·ª£ng (3 m·ª©c)
  let appliedValue;
  if (promotion.value3 && totalQuantity >= promotion.soluongapdungmuc3) {
    appliedValue = promotion.value3;  // M·ª©c 3
  } else if (promotion.value2 && totalQuantity >= promotion.soluongapdung) {
    appliedValue = promotion.value2;  // M·ª©c 2
  } else {
    appliedValue = promotion.value;   // M·ª©c 1
  }

  return applyDiscountValue(originalPrice, appliedValue, promotion.vn);
};

// H√†m √°p d·ª•ng gi·∫£m gi√°
const applyDiscountValue = (
  price: number, 
  value: number, 
  type: "191920000" | "191920001"
) => {
  if (type === "191920000") {
    // Gi·∫£m theo ph·∫ßn trƒÉm
    return Math.max(0, price * (1 - value / 100));
  } else {
    // Gi·∫£m theo s·ªë ti·ªÅn c·ªë ƒë·ªãnh
    return Math.max(0, price - value);
  }
};
```

#### **üîÑ Workflow x·ª≠ l√Ω Promotion (Chi ti·∫øt ƒë·∫ßy ƒë·ªß)**

**B∆∞·ªõc 1: Fetch Promotions t·ª´ CRM v·ªõi Customer Context**
```typescript
// API: /api/getPromotionDataNewVersion
const fetchPromotionsWithCustomerContext = async (customerId, productCodes, productGroupCodes) => {
  // 1. L·∫•y th√¥ng tin nh√≥m kh√°ch h√†ng
  const customerGroups = await getCustomerGroups(customerId);
  const customerGroupIds = customerGroups.map(g => g.customerGroupId);
  
  // 2. X√¢y d·ª±ng filter ph·ª©c t·∫°p
  const promotionFilter = customerGroupIds.map(id => 
    `statecode eq 0 and _crdfd_customergroup_value eq '${id}' or _crdfd_customergroup_value eq null`
  ).join(' or ');
  
  // 3. Filter theo s·∫£n ph·∫©m v√† nh√≥m s·∫£n ph·∫©m
  let additionalFilters = [];
  
  if (productCodes) {
    const productFilter = productCodes.map(code => 
      `contains(crdfd_masanpham_multiple,'${code}')`
    ).join(' or ');
    additionalFilters.push(`(${productFilter})`);
  }
  
  if (productGroupCodes) {
    const groupFilter = productGroupCodes.map(code => 
      `contains(crdfd_multiple_manhomsp,'${code}')`
    ).join(' or ');
    additionalFilters.push(`(${groupFilter})`);
  }
  
  // 4. Filter theo m√£ kh√°ch h√†ng c·ª• th·ªÉ
  const customerCode = await getCustomerCode(customerId);
  const customerSpecificFilter = `
    (startswith(cr3b9_ma_khachhang_apdung,'${customerCode},') or 
     endswith(cr3b9_ma_khachhang_apdung,',${customerCode}') or 
     contains(cr3b9_ma_khachhang_apdung,',${customerCode},') or 
     cr3b9_ma_khachhang_apdung eq '${customerCode}')
  `;
  
  // 5. Combine t·∫•t c·∫£ filters
  const finalFilter = [
    `(${promotionFilter})`,
    'statecode eq 0',
    'crdfd_promotion_deactive eq \'Active\'',
    `crdfd_start_date le ${new Date().toISOString()}`,
    `crdfd_end_date ge ${new Date().toISOString()}`,
    ...additionalFilters,
    `(${customerSpecificFilter})`
  ].join(' and ');
  
  return await fetchPromotions(finalFilter);
};
```

**B∆∞·ªõc 2: Advanced Promotion Matching**
```typescript
const findBestPromotion = (promotions, productCode, productGroupCode, pricing) => {
  // 1. Ki·ªÉm tra lo·∫°i b·ªè promotion
  if (pricing?.some(p => p.cr3b9_loaibopromotionname === "yes")) {
    return null;
  }
  
  // 2. T√¨m promotions theo m√£ s·∫£n ph·∫©m (∆∞u ti√™n cao nh·∫•t)
  const productPromotions = promotions.filter(promo => {
    if (!promo.crdfd_masanpham_multiple) return false;
    
    const codes = promo.crdfd_masanpham_multiple
      .split(/,\s*/)
      .map(code => code.trim().toLowerCase());
    
    return codes.includes(productCode.toLowerCase());
  });
  
  // 3. T√¨m promotions theo nh√≥m s·∫£n ph·∫©m
  const groupPromotions = promotions.filter(promo => {
    if (!promo.crdfd_multiple_manhomsp) return false;
    
    const groupCodes = promo.crdfd_multiple_manhomsp
      .split(/,\s*/)
      .map(code => code.trim().toLowerCase());
    
    return groupCodes.includes(productGroupCode.toLowerCase());
  });
  
  // 4. Ch·ªçn promotion t·ªët nh·∫•t (gi√° tr·ªã cao nh·∫•t)
  const allApplicablePromotions = [...productPromotions, ...groupPromotions];
  
  if (allApplicablePromotions.length === 0) return null;
  
  // S·∫Øp x·∫øp theo ƒë·ªô ∆∞u ti√™n v√† gi√° tr·ªã
  return allApplicablePromotions.reduce((best, current) => {
    const bestValue = parseFloat(best.crdfd_value || "0");
    const currentValue = parseFloat(current.crdfd_value || "0");
    
    // ∆Øu ti√™n promotion theo s·∫£n ph·∫©m tr∆∞·ªõc
    if (productPromotions.includes(current) && !productPromotions.includes(best)) {
      return current;
    }
    
    // N·∫øu c√πng lo·∫°i, ch·ªçn gi√° tr·ªã cao h∆°n
    return currentValue > bestValue ? current : best;
  });
};
```

**B∆∞·ªõc 3: Complex Price Calculation Engine**
```typescript
const calculateComplexPromotionPrice = (
  originalPrice: number,
  promotion: any,
  cartItems: CartItem[],
  customerId: string
) => {
  // 1. Validate promotion conditions
  const conditionCheck = validatePromotionConditions(promotion, {
    customerId,
    cartItems,
    currentDate: new Date()
  });
  
  if (!conditionCheck.valid) {
    return {
      finalPrice: originalPrice,
      appliedDiscount: 0,
      reason: conditionCheck.reason,
      promotionApplied: false
    };
  }
  
  // 2. X·ª≠ l√Ω theo lo·∫°i promotion
  let calculationResult;
  
  if (promotion.tongTienApDung) {
    // Amount-based promotion
    calculationResult = calculateAmountBasedPromotion(promotion, cartItems);
  } else if (promotion.maSanPhamMuaKem) {
    // Bundle promotion
    const bundleCheck = checkBundlePromotion(promotion, cartItems);
    if (!bundleCheck.eligible) {
      return {
        finalPrice: originalPrice,
        appliedDiscount: 0,
        reason: bundleCheck.reason,
        promotionApplied: false,
        requiredProducts: bundleCheck.requiredProducts
      };
    }
    calculationResult = { appliedValue: bundleCheck.appliedValue, level: 1 };
  } else {
    // Quantity-based promotion
    const totalQuantity = getTotalQuantityByPromotion(cartItems, promotion.promotionId);
    calculationResult = calculateQuantityBasedPromotion(promotion, totalQuantity);
  }
  
  // 3. √Åp d·ª•ng gi·∫£m gi√°
  const finalPrice = applyDiscountValue(
    originalPrice, 
    calculationResult.appliedValue, 
    promotion.vn
  );
  
  // 4. T√≠nh to√°n th√¥ng tin b·ªï sung
  const appliedDiscount = originalPrice - finalPrice;
  const discountPercentage = (appliedDiscount / originalPrice) * 100;
  
  return {
    finalPrice: Math.max(0, Math.round(finalPrice)),
    originalPrice,
    appliedDiscount: Math.round(appliedDiscount),
    discountPercentage: Math.round(discountPercentage * 100) / 100,
    promotionLevel: calculationResult.level,
    promotionName: promotion.crdfd_name,
    promotionConditions: promotion.crdfd_conditions,
    status: calculationResult.status,
    progress: calculationResult.progress,
    nextLevelInfo: calculationResult.nextLevel,
    promotionApplied: true
  };
};
```

**B∆∞·ªõc 4: Real-time Cart Synchronization**
```typescript
const synchronizeCartPromotions = (cartItems: CartItem[]) => {
  // 1. Group items by promotion
  const promotionGroups = new Map();
  
  cartItems.forEach(item => {
    if (item.promotion?.promotionId) {
      const promotionId = item.promotion.promotionId;
      if (!promotionGroups.has(promotionId)) {
        promotionGroups.set(promotionId, []);
      }
      promotionGroups.get(promotionId).push(item);
    }
  });
  
  // 2. Recalculate prices for each promotion group
  const updatedItems = cartItems.map(item => {
    if (!item.promotion) return item;
    
    const promotionItems = promotionGroups.get(item.promotion.promotionId) || [item];
    
    // Calculate total quantity and amount for this promotion
    const totalQuantity = promotionItems.reduce((sum, pItem) => sum + pItem.quantity, 0);
    const totalAmount = promotionItems.reduce((sum, pItem) => 
      sum + (parseFloat(pItem.regularPrice) * pItem.quantity), 0
    );
    
    // Recalculate price
    const priceCalculation = calculateComplexPromotionPrice(
      parseFloat(item.regularPrice),
      item.promotion,
      cartItems,
      item.customerId
    );
    
    return {
      ...item,
      finalPrice: priceCalculation.finalPrice,
      appliedDiscount: priceCalculation.appliedDiscount,
      discountPercentage: priceCalculation.discountPercentage,
      promotionLevel: priceCalculation.promotionLevel,
      promotionStatus: priceCalculation.status,
      promotionProgress: priceCalculation.progress,
      nextLevelInfo: priceCalculation.nextLevelInfo,
      // Update promotion metadata
      promotion: {
        ...item.promotion,
        isValue2Applied: priceCalculation.promotionLevel === 2,
        isValue3Applied: priceCalculation.promotionLevel === 3,
        appliedValue: priceCalculation.appliedDiscount.toString(),
        currentLevel: priceCalculation.promotionLevel,
        totalQuantity,
        totalAmount
      }
    };
  });
  
  // 3. Validate cross-promotion dependencies
  return validateCrossPromotionDependencies(updatedItems);
};
```

**B∆∞·ªõc 5: Advanced Display & UX Logic**
```typescript
const generatePromotionDisplayInfo = (item: CartItem) => {
  if (!item.promotion || !item.promotionApplied) {
    return { hasPromotion: false };
  }
  
  const promotion = item.promotion;
  const currentLevel = promotion.currentLevel || 1;
  
  // Generate progress bar info
  let progressInfo = {};
  
  if (promotion.tongTienApDung) {
    // Amount-based progress
    const progress = Math.min((promotion.totalAmount / promotion.tongTienApDung) * 100, 100);
    const remaining = Math.max(promotion.tongTienApDung - promotion.totalAmount, 0);
    
    progressInfo = {
      type: 'amount',
      current: promotion.totalAmount,
      target: promotion.tongTienApDung,
      progress,
      remaining,
      unit: 'VND',
      message: remaining > 0 
        ? `Mua th√™m ${remaining.toLocaleString()} VND ƒë·ªÉ ƒë∆∞·ª£c gi·∫£m gi√° cao h∆°n`
        : 'ƒê√£ ƒë·∫°t m·ª©c gi·∫£m gi√° t·ªëi ƒëa'
    };
  } else {
    // Quantity-based progress
    const currentTarget = currentLevel === 1 ? promotion.soluongapdung : promotion.soluongapdungmuc3;
    const progress = Math.min((promotion.totalQuantity / currentTarget) * 100, 100);
    const remaining = Math.max(currentTarget - promotion.totalQuantity, 0);
    
    progressInfo = {
      type: 'quantity',
      current: promotion.totalQuantity,
      target: currentTarget,
      progress,
      remaining,
      unit: 's·∫£n ph·∫©m',
      message: remaining > 0 
        ? `Mua th√™m ${remaining} s·∫£n ph·∫©m ƒë·ªÉ ƒë∆∞·ª£c gi·∫£m gi√° cao h∆°n`
        : 'ƒê√£ ƒë·∫°t m·ª©c gi·∫£m gi√° t·ªëi ƒëa'
    };
  }
  
  // Generate badge info
  const badgeInfo = {
    text: `Gi·∫£m ${item.discountPercentage}%`,
    color: currentLevel === 3 ? 'gold' : currentLevel === 2 ? 'silver' : 'bronze',
    level: currentLevel,
    savings: `Ti·∫øt ki·ªám ${item.appliedDiscount.toLocaleString()} VND`
  };
  
  // Generate tooltip info
  const tooltipInfo = {
    title: promotion.name,
    conditions: promotion.conditions,
    currentLevel: `ƒêang ·ªü m·ª©c ${currentLevel}`,
    appliedDiscount: `Gi·∫£m ${item.discountPercentage}%`,
    originalPrice: `Gi√° g·ªëc: ${item.originalPrice.toLocaleString()} VND`,
    finalPrice: `Gi√° sau KM: ${item.finalPrice.toLocaleString()} VND`
  };
  
  return {
    hasPromotion: true,
    progressInfo,
    badgeInfo,
    tooltipInfo,
    canUpgrade: progressInfo.remaining > 0,
    maxLevel: promotion.value3 ? 3 : (promotion.value2 ? 2 : 1)
  };
};
```

### **6. Lu·ªìng ƒê√†o t·∫°o**

```mermaid
graph TD
    A[Truy c·∫≠p /training] --> B[ƒêƒÉng nh·∫≠p training]
    B --> C[API trainingLogin]
    C --> D{X√°c th·ª±c th√†nh c√¥ng?}
    
    D -->|C√≥| E[Hi·ªÉn th·ªã danh s√°ch kh√≥a h·ªçc]
    D -->|Kh√¥ng| F[L·ªói ƒëƒÉng nh·∫≠p]
    
    E --> G[Ch·ªçn kh√≥a h·ªçc]
    G --> H[Xem n·ªôi dung b√†i h·ªçc]
    H --> I[Ho√†n th√†nh b√†i h·ªçc]
    
    I --> J{C√≥ b√†i ki·ªÉm tra?}
    J -->|C√≥| K[L√†m b√†i ki·ªÉm tra]
    J -->|Kh√¥ng| L[Chuy·ªÉn b√†i ti·∫øp theo]
    
    K --> M[N·ªôp b√†i]
    M --> N[Ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông]
    N --> O{ƒê·∫°t ƒëi·ªÉm t·ªëi thi·ªÉu?}
    
    O -->|C√≥| P[C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô]
    O -->|Kh√¥ng| Q[L√†m l·∫°i b√†i ki·ªÉm tra]
    
    P --> L
```

### **7. Lu·ªìng Tuy·ªÉn d·ª•ng**

```mermaid
graph TD
    A[Truy c·∫≠p /tuyen-dung] --> B[Xem danh s√°ch v·ªã tr√≠ tuy·ªÉn d·ª•ng]
    B --> C[API getPositionData]
    C --> D[Hi·ªÉn th·ªã c√°c v·ªã tr√≠ ƒëang m·ªü]
    
    D --> E[Click "·ª®ng tuy·ªÉn"]
    E --> F[ƒêi·ªÅn form ·ª©ng tuy·ªÉn]
    F --> G[Upload CV/Documents]
    G --> H[API uploadFile]
    
    H --> I[API submitApplication]
    I --> J{G·ª≠i th√†nh c√¥ng?}
    
    J -->|C√≥| K[Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng]
    J -->|Kh√¥ng| L[Hi·ªÉn th·ªã l·ªói]
    
    K --> M[Email x√°c nh·∫≠n g·ª≠i cho ·ª©ng vi√™n]
    M --> N[HR nh·∫≠n th√¥ng b√°o c√≥ ƒë∆°n m·ªõi]
```

## ‚öôÔ∏è C√†i ƒë·∫∑t v√† ch·∫°y d·ª± √°n

### **Y√™u c·∫ßu h·ªá th·ªëng**
- Node.js >= 18.0.0
- npm >= 8.0.0
- TypeScript >= 5.8.2
- Docker (optional) >= 20.0.0
- Git >= 2.30.0

### **C√†i ƒë·∫∑t dependencies**
```bash
# Clone repository
git clone <repository-url>
cd wecare-ecommerce

# Install dependencies
npm install

# Ho·∫∑c s·ª≠ d·ª•ng yarn
yarn install

# Ho·∫∑c s·ª≠ d·ª•ng pnpm
pnpm install
```

### **C·∫•u h√¨nh m√¥i tr∆∞·ªùng**
T·∫°o file `.env.local`:
```env
# Azure Configuration
AZURE_CLIENT_ID=your_client_id
AZURE_CLIENT_SECRET=your_client_secret
AZURE_TENANT_ID=your_tenant_id

# Dynamics CRM
CRM_BASE_URL=https://wecare-ii.crm5.dynamics.com
CRM_API_VERSION=v9.2

# Azure Blob Storage
AZURE_STORAGE_ACCOUNT=your_storage_account
AZURE_STORAGE_KEY=your_storage_key
AZURE_STORAGE_CONTAINER=your_container_name

# Application Configuration
NEXT_PUBLIC_API_BASE_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_nextauth_secret

# Cache Configuration (Optional)
REDIS_URL=redis://localhost:6379
CACHE_TTL=3600

# Cloudinary (for image optimization)
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Development/Production flags
NODE_ENV=development
NEXT_PUBLIC_ENV=development
```

### **C·∫•u h√¨nh chi ti·∫øt**

#### **1. Azure AD Authentication**
```javascript
// config/azure.js
export const azureConfig = {
  clientId: process.env.AZURE_CLIENT_ID,
  clientSecret: process.env.AZURE_CLIENT_SECRET,
  tenantId: process.env.AZURE_TENANT_ID,
  scope: 'https://graph.microsoft.com/.default',
  authority: `https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}`
};
```

#### **2. Dynamics CRM Configuration**
```javascript
// config/crm.js
export const crmConfig = {
  baseUrl: 'https://wecare-ii.crm5.dynamics.com',
  apiVersion: 'v9.2',
  endpoints: {
    customers: '/api/data/v9.2/contacts',
    products: '/api/data/v9.2/crdfd_productss',
    orders: '/api/data/v9.2/crdfd_athangsos',
    employees: '/api/data/v9.2/crdfd_employees',
    promotions: '/api/data/v9.2/crdfd_promotions'
  }
};
```

#### **3. Cache Strategy**
```javascript
// config/cache.js
export const cacheConfig = {
  defaultTTL: 3600, // 1 hour
  strategies: {
    products: { ttl: 1800 },      // 30 minutes
    promotions: { ttl: 900 },     // 15 minutes
    customers: { ttl: 3600 },     // 1 hour
    static: { ttl: 86400 }        // 24 hours
  }
};
```

### **Ch·∫°y development server**
```bash
npm run dev
```

M·ªü [http://localhost:3000](http://localhost:3000) ƒë·ªÉ xem k·∫øt qu·∫£.

### **Build production**
```bash
npm run build
npm start
```

### **Available Scripts**
```bash
# Development
npm run dev          # Start development server
npm run build        # Build for production
npm run start        # Start production server
npm run lint         # Run ESLint

# Type checking
npx tsc --noEmit     # Check TypeScript without emitting files

# Docker commands
docker build -t wecare-ecommerce .     # Build Docker image
docker-compose up -d                   # Start with Docker Compose
docker-compose logs -f wecare-ecommerce # View logs
```

## üê≥ Docker & Containerization

### **Docker Configuration**
```dockerfile
# Dockerfile (khuy·∫øn ngh·ªã)
FROM node:18-alpine AS base
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM base AS build
RUN npm ci
COPY . .
RUN npm run build

FROM base AS runtime
COPY --from=build /app/.next ./.next
COPY --from=build /app/public ./public
EXPOSE 3000
CMD ["npm", "start"]
```

### **Docker Compose Setup**
```yaml
# docker-compose.yml (hi·ªán t·∫°i)
version: "3.8"
services:
  wecare-ecommerce:
    image: wecare-ecommerce:latest
    hostname: wecare.com.vn
    ports:
      - "3000:3000"
    restart: always
    volumes:
      - "./public:/app/public"
      - "./src:/app/src"
    networks:
      - dev
```

### **Production Docker Compose**
```yaml
# docker-compose.prod.yml (khuy·∫øn ngh·ªã)
version: "3.8"
services:
  wecare-ecommerce:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_ENV=production
    restart: unless-stopped
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - wecare-ecommerce
```

### **Commands**
```bash
# Build Docker image
docker build -t wecare-ecommerce .

# Run development
docker-compose up -d

# Run production
docker-compose -f docker-compose.prod.yml up -d

# View logs
docker-compose logs -f wecare-ecommerce

# Scale service
docker-compose up -d --scale wecare-ecommerce=3
```

## üì± Responsive Design

H·ªá th·ªëng ƒë∆∞·ª£c thi·∫øt k·∫ø responsive v·ªõi:
- **Mobile-first approach**
- **Breakpoints**: sm (640px), md (768px), lg (1024px), xl (1280px)
- **Touch-friendly interface** cho mobile
- **Desktop optimized layout** cho m√†n h√¨nh l·ªõn

## üé® Styling & Design System

### **Color Palette**
```typescript
// Primary Colors
primaryColor: {
  light: "#FFE1E6",
  main: "rgb(2 132 199)",      // Cyan-600
  dark: "#4F4CB6",
  text: "#ffffff",
  500: "#D23F57",              // Red accent
}

// Secondary Colors  
secondaryColor: {
  main: "rgba(15, 52, 96, 1)",  // Dark blue
  light: "rgba(15, 52, 96, 0.2)",
  text: "#ffffff",
}

// Gray Scale
gray: {
  900: "#2B3445",              // Main text
  800: "#373F50",              // Paragraph  
  700: "#4B566B",
  600: "#7D879C",              // Low priority text
  500: "#AEB4BE",
  400: "#DAE1E7",              // Border
  300: "#E3E9EF", 
  200: "#F3F5F9",              // Line stroke
  100: "#F6F9FC",
  white: "#FFFFFF",
}

// Status Colors
successColor: { 
  main: "rgba(51, 208, 103, 1)", 
  light: "rgba(51, 208, 103, 0.15)" 
}
errorColor: { 
  main: "#E94560", 
  light: "#FFE1E6" 
}
warningColor: { 
  main: "#FFCD4E" 
}

// Custom Brand Colors
customBlue: "#3899B4"          // Wecare brand blue
```

### **Typography System**
```css
/* Font Family */
font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
             Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 
             'Helvetica Neue', sans-serif;

/* Font Sizes */
text-xs: 12px     /* Small labels */
text-sm: 14px     /* Body text */
text-base: 16px   /* Default */
text-lg: 18px     /* Subheadings */
text-xl: 20px     /* Card titles */
text-2xl: 24px    /* Section headers */
text-3xl: 30px    /* Page titles */
```

### **Spacing & Layout**
```css
/* Custom Spacing */
padding: {
  '50': '50px',
  '68': '68px', 
  '100': '100px'
}

/* Layout Constants */
headerHeight: "140px"
mobileHeaderHeight: "64px"
containerWidth: "1200px"
sidenavWidth: "280px"
```

### **Breakpoints**
```typescript
screens: {
  'xs': '425px',    // Extra small devices
  'sm': '640px',    // Small devices (phones)
  'md': '768px',    // Medium devices (tablets)
  'lg': '1024px',   // Large devices (desktops)
  'xl': '1280px',   // Extra large devices
}
```

### **Animations & Effects**
```css
/* Custom Keyframes */
@keyframes bounce-gentle {
  0%, 100% { transform: translateY(-5%) }
  50% { transform: translateY(0) }
}

@keyframes shine {
  0% { left: '-100%' }
  50%, 100% { left: '100%' }
}

/* Animation Classes */
.animate-bounce-gentle: 2s ease-in-out infinite
.animate-shine: 2s forwards linear infinite
.animate-spin-fast: 0.6s linear infinite

/* Hover Effects */
.hover-lift:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
}

/* Glass Effect */
.glass-effect {
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.18);
}
```

### **Component Styling**
- **Material-UI**: Customized theme v·ªõi Wecare colors
- **Tailwind CSS**: Utility-first styling v·ªõi custom extensions
- **Styled Components**: Dynamic styling cho complex components
- **CSS Modules**: Scoped styles cho specific components

## üîí Security & Performance

### **Security Measures**
```typescript
// API Security
- Rate limiting: express-rate-limit (7.4.1)
- Input validation: Required fields validation
- Duplicate prevention: checkDuplicateApplication()
- Access token management: Secure token caching
- Permission-based access control
- CORS configuration
- SQL injection prevention (OData filters)

// Client-side Security
- Secure localStorage: SecureStorage utility
- Permission guards: PermissionGuard components
- Route protection: Middleware validation
- XSS prevention: React built-in protection
```

### **Performance Optimizations**
```typescript
// Caching Strategy
const CACHE_CONFIG = {
  accessToken: { ttl: 3300000 },    // 55 minutes
  productData: { ttl: 1800000 },    // 30 minutes
  customerData: { ttl: 3600000 },   // 1 hour
  pricingData: { ttl: 1800000 },    // 30 minutes
};

// Connection Pooling
- HTTP Keep-Alive: 50 seconds
- Max Sockets: 50
- Concurrent Requests: 3 (p-limit)
- Batch Processing: 100 items per batch

// Memory Management
- LRU Cache: Automatic cleanup
- Circuit Breaker: Fault tolerance
- Memory monitoring: checkMemoryUsage()
```

### **Monitoring & Logging**
```typescript
// Structured Logging (Pino)
logger.error("Error in API:", {
  error: { message, stack, name },
  query: req.query,
  timestamp: new Date().toISOString(),
});

// Performance Monitoring
- Memory usage tracking
- API response times
- Cache hit/miss rates
- Error rate monitoring
```

## üîç SEO & Performance

### **SEO Features**
- **Meta tags** t·ªëi ∆∞u
- **Open Graph** tags
- **JSON-LD** structured data
- **Sitemap** t·ª± ƒë·ªông
- **Robot.txt** configuration

### **Performance Optimizations**
- **Image optimization** v·ªõi Next.js Image
- **Code splitting** t·ª± ƒë·ªông
- **Lazy loading** components
- **Caching strategy** v·ªõi Redis
- **CDN** integration

## üß™ Testing & Quality Assurance

### **Testing Stack**
```json
// Hi·ªán t·∫°i ch∆∞a c√≥ test setup trong package.json
// Khuy·∫øn ngh·ªã th√™m:
{
  "devDependencies": {
    "jest": "^29.0.0",
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^6.0.0",
    "cypress": "^13.0.0",
    "@types/jest": "^29.0.0"
  },
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:e2e": "cypress run",
    "test:e2e:open": "cypress open"
  }
}
```

### **Code Quality Tools**
```bash
# ESLint (ƒë√£ c√≥)
npm run lint

# Prettier (khuy·∫øn ngh·ªã th√™m)
npm run format

# TypeScript check
npx tsc --noEmit

# Bundle analyzer
npm run analyze
```

### **Error Handling Patterns**
```typescript
// API Error Handling
const handleError = (res: NextApiResponse, error: AxiosError) => {
  if (error.response) {
    return res.status(error.response.status).json({
      error: error.response.data,
      message: "API request failed",
    });
  }
  // Network errors, timeout errors, etc.
};

// Client Error Boundaries
<ErrorBoundary fallback={<ErrorFallback />}>
  <MyComponent />
</ErrorBoundary>
```

### **Data Validation**
```typescript
// Server-side validation
if (!applicationData.crdfd_hovaten || !applicationData.crdfd_sdt) {
  return res.status(400).json({ 
    error: "Missing required fields",
    receivedData: applicationData 
  });
}

// Duplicate checking
const isDuplicate = await checkDuplicateApplication(
  token, hovaten, sdt, yeucautuyendungid
);
```

## üìà Monitoring & Analytics

### **Performance Monitoring**
- Next.js Analytics
- Web Vitals tracking
- Error boundary implementation

### **User Analytics**
- Google Analytics integration
- Custom event tracking
- User behavior analysis

## üöÄ Deployment

### **Vercel (Recommended)**
```bash
npm install -g vercel
vercel
```

### **Manual Deployment**
1. Build the project: `npm run build`
2. Start production server: `npm start`
3. Configure reverse proxy (nginx/apache)
4. Set up SSL certificate

### **Environment Variables**
ƒê·∫£m b·∫£o c·∫•u h√¨nh ƒë√∫ng c√°c bi·∫øn m√¥i tr∆∞·ªùng trong production.

## ü§ù Contributing

### **Development Workflow**
1. Fork repository
2. T·∫°o feature branch: `git checkout -b feature/amazing-feature`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push to branch: `git push origin feature/amazing-feature`
5. T·∫°o Pull Request

### **Development Best Practices**
```bash
# Pre-commit checks
npm run lint                    # Check code style
npx tsc --noEmit               # Type check
npm run build                  # Ensure build works

# Git workflow
git checkout -b feature/name   # Create feature branch
git add .                      # Stage changes
git commit -m "feat: add feature"  # Commit with conventional format
git push origin feature/name   # Push to remote

# Code formatting
# Use Prettier (recommended)
npx prettier --write "src/**/*.{ts,tsx,js,jsx,json,css,md}"

# Component development
# Use Storybook for component development
npm run storybook
```

### **Code Standards**
- ESLint configuration
- Prettier formatting
- TypeScript strict mode
- Conventional commits

## üìö Documentation

### **API Documentation**
- Swagger/OpenAPI specs trong `/docs/api`
- Postman collection c√≥ s·∫µn

### **Component Documentation**
- Storybook cho UI components
- JSDoc comments trong code

### **Lu·ªìng nghi·ªáp v·ª• chi ti·∫øt**

#### **Authentication Flow**
1. **Customer Login**: Username + Password ‚Üí `/api/getCustomerData`
2. **Sale Login**: Email + Phone ‚Üí `/api/getEmployeData`  
3. **Training Login**: Email + Phone ‚Üí `/api/auth/trainingLogin`
4. **Permission Check**: Department + Role ‚Üí Permission assignment
5. **Session Management**: LocalStorage + Token validation

#### **E-commerce Flow**
1. **Product Discovery**: Category ‚Üí Product Group ‚Üí Product List
2. **Product Details**: Specifications + Pricing + Promotions
3. **Cart Management**: Add/Update/Remove items
4. **Checkout Process**: Customer selection ‚Üí Order creation
5. **Order Tracking**: Status updates + History

#### **Sales Management Flow**
1. **Price by Customer**: Customer selection ‚Üí Price lookup
2. **Sale Order**: Customer ‚Üí Products ‚Üí Order creation
3. **Sale Confirm**: Order approval ‚Üí Status update
4. **Reporting**: Sales data + Analytics

#### **Content Management Flow**
1. **News/Articles**: CRM content ‚Üí Website display
2. **Promotions**: Campaign setup ‚Üí Product application
3. **Training Materials**: Course creation ‚Üí Progress tracking
4. **Job Postings**: Position creation ‚Üí Application handling

## üîß Database Schema & Data Models

### **Microsoft Dynamics CRM Entities**
```typescript
// Core Entities
- contacts: Kh√°ch h√†ng (customers)
- crdfd_productss: S·∫£n ph·∫©m (products)
- crdfd_athangsos: ƒê∆°n h√†ng (sale orders)
- crdfd_employees: Nh√¢n vi√™n (employees)
- crdfd_promotions: Khuy·∫øn m√£i (promotions)
- crdfd_yeucautuyendungs: Y√™u c·∫ßu tuy·ªÉn d·ª•ng (job requirements)
- crdfd_thongtinungviens: Th√¥ng tin ·ª©ng vi√™n (applicants)
- cr1bb_data_website_ecommerces: N·ªôi dung website (content)

// Key Fields
interface Product {
  crdfd_productsid: string;          // Product ID
  crdfd_name: string;                // Product name
  crdfd_masanpham: string;           // Product code
  cr1bb_giaban: number;              // Selling price
  crdfd_thuonghieu: string;          // Brand
  crdfd_quycach: string;             // Specifications
  _crdfd_productgroup_value: string; // Product group ID
}

interface Customer {
  contactid: string;                 // Customer ID
  fullname: string;                  // Full name
  cr44a_makhachhang: string;         // Customer code
  emailaddress1: string;             // Email
  telephone1: string;                // Phone
}
```

### **Data Flow Architecture**
```mermaid
graph TD
    A[Next.js Frontend] --> B[API Routes]
    B --> C[Access Token Service]
    C --> D[Microsoft Dynamics CRM]
    
    B --> E[LRU Cache Layer]
    E --> F[Memory Management]
    
    B --> G[Azure Blob Storage]
    G --> H[File Upload/Download]
    
    D --> I[OData API v9.2]
    I --> J[Entity Framework]
```

## üêõ Troubleshooting & Debugging

### **Common Issues**

**1. Build errors**
```bash
# Clear cache
rm -rf .next node_modules
npm install
npm run build

# TypeScript errors
npx tsc --noEmit
```

**2. Authentication issues**
```bash
# Check environment variables
echo $AZURE_CLIENT_ID
echo $AZURE_CLIENT_SECRET

# Verify token expiration
# Token TTL: 55 minutes (3300000ms)
```

**3. API connection errors**
```bash
# Test CRM connectivity
curl -H "Authorization: Bearer $TOKEN" \
  "https://wecare-ii.crm5.dynamics.com/api/data/v9.2/contacts"

# Check rate limiting
# express-rate-limit: 100 requests per 15 minutes
```

**4. Memory issues**
```typescript
// Monitor memory usage
function checkMemoryUsage() {
  const used = process.memoryUsage();
  console.log('Memory Usage:', {
    rss: Math.round(used.rss / 1024 / 1024) + ' MB',
    heapTotal: Math.round(used.heapTotal / 1024 / 1024) + ' MB',
    heapUsed: Math.round(used.heapUsed / 1024 / 1024) + ' MB'
  });
}
```

**5. Cache issues**
```bash
# Clear application cache
# LRU Cache auto-cleanup based on TTL
# Manual cleanup: cleanupCaches()

# Redis cache (if using)
redis-cli FLUSHALL
```

**6. Image optimization issues**
```bash
# Clear Next.js image cache
rm -rf .next/cache/images

# Check image optimization settings
# next.config.mjs - images.remotePatterns
```

**7. TypeScript compilation errors**
```bash
# Clear TypeScript cache
rm -rf .next
rm -rf node_modules/.cache

# Check TypeScript configuration
npx tsc --showConfig
```

**8. Middleware issues**
```bash
# Check middleware configuration
# src/middleware.ts - matcher patterns
# Verify route matching logic
```

### **Debug Mode**
```bash
# Enable debug logging
DEBUG=* npm run dev

# Next.js debug
NEXT_DEBUG=1 npm run dev

# API debug
NODE_ENV=development npm run dev
```

## üìû Support

### **Technical Support**
- Email: support@wecare.com.vn
- Documentation: [Wiki](./docs/)
- Issue tracking: GitHub Issues

### **Business Support**
- Sales: sales@wecare.com.vn
- Phone: +84 xxx xxx xxx

## üìÑ License

D·ª± √°n n√†y thu·ªôc b·∫£n quy·ªÅn c·ªßa **Wecare Corporation**. Vui l√≤ng li√™n h·ªá ƒë·ªÉ bi·∫øt th√™m th√¥ng tin v·ªÅ license.

## üôè Acknowledgments

- **Next.js Team** - Awesome framework
- **Vercel** - Deployment platform
- **Microsoft** - Azure services
- **Tailwind CSS** - Styling framework
- **Material-UI** - Component library

## üìã Development Roadmap

### **Phase 1: Current (v0.1.0)**
- ‚úÖ Core E-commerce functionality
- ‚úÖ Permission system implementation
- ‚úÖ Training module
- ‚úÖ Recruitment system
- ‚úÖ Basic performance optimizations

### **Phase 2: Planned (v0.2.0)**
- üîÑ Testing framework implementation
- üîÑ Advanced analytics dashboard
- üîÑ Mobile app development
- üîÑ Advanced caching with Redis
- üîÑ CI/CD pipeline setup

### **Phase 3: Future (v1.0.0)**
- üîÆ Microservices architecture
- üîÆ Real-time notifications
- üîÆ Advanced AI recommendations
- üîÆ Multi-language support
- üîÆ Advanced reporting system

## üìä Project Metrics

### **Codebase Stats**
- **Total Files**: ~200+ files
- **Lines of Code**: ~50,000+ lines
- **API Endpoints**: 40+ endpoints
- **Components**: 68+ React components
- **Dependencies**: 70+ packages
- **TypeScript Files**: 100% TypeScript coverage
- **Test Coverage**: TBD (testing framework to be implemented)

### **Performance Benchmarks**
- **First Contentful Paint**: < 1.5s
- **Largest Contentful Paint**: < 2.5s
- **Time to Interactive**: < 3.0s
- **Cumulative Layout Shift**: < 0.1
- **Cache Hit Rate**: ~85%

---

**Phi√™n b·∫£n**: v0.1.0  
**C·∫≠p nh·∫≠t l·∫ßn cu·ªëi**: 2024-12-19  
**T√°c gi·∫£**: Wecare Development Team  
**Repository**: wecare-ecommerce  
**License**: Proprietary - Wecare Corporation  
**Documentation**: Comprehensive README with detailed setup, API docs, and troubleshooting guides